{"title": "Python连接Oracle - Tony Output ", "index": "python2.7,oracle,cx_oracle,python", "content": "Python连接Oracle\n\n当前环境：Linux Centos 7\n1. 下载安装包cx_Oracle\n\n由于我本地Python版本是2.7,所以选择是2.7版本\nwget https://pypi.python.org/packages/e1/18/00987c6a9af9568ee87d1fcba877407684a3f1b87515e5eb82d5d5acb9ff/cx_Oracle-6.0rc1-py27-1.x86_64.rpm#md5=ff8f5cce07bd5ec8ed3ce5c79d451474\n参考:\n\npython-cx_Oracle\n安装包列表\n\n2. 安装cx_Oracle\n\n安装：\nrpm -ivh cx_Oracle-6.0rc1-py27-1.x86_64.rpm\n查看当前python引入模块库的路径\n[root ~]# python\nPython 2.7.5 (default, Nov  6 2016, 00:28:07) \n[GCC 4.8.5 20150623 (Red Hat 4.8.5-11)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import sys\n>>> print sys.path\n['', '/usr/lib/python2.7/site-packages/AliyunUtil-0.0.1-py2.7.egg', '/usr/lib/python2.7/site-packages/cloud_init-0.7.6-py2.7.egg', '/usr/lib64/python27.zip', '/usr/lib64/python2.7', '/usr/lib64/python2.7/plat-linux2', '/usr/lib64/python2.7/lib-tk', '/usr/lib64/python2.7/lib-old', '/usr/lib64/python2.7/lib-dynload', '/usr/lib64/python2.7/site-packages', '/usr/lib/python2.7/site-packages']\n检查安装路径，如果cx_Oracle.so文件不在以上python引入路径内需要将该文件拷贝到以上python引入路径,所以我这里不需要进行拷贝操作\n[root ~]# rpm -qa | grep cx_Oracle | xargs rpm -ql\n/usr/lib64/python2.7/site-packages/cx_Oracle-6.0rc1-py2.7.egg-info\n/usr/lib64/python2.7/site-packages/cx_Oracle-6.0rc1-py2.7.egg-info/PKG-INFO\n/usr/lib64/python2.7/site-packages/cx_Oracle-6.0rc1-py2.7.egg-info/SOURCES.txt\n/usr/lib64/python2.7/site-packages/cx_Oracle-6.0rc1-py2.7.egg-info/dependency_links.txt\n/usr/lib64/python2.7/site-packages/cx_Oracle-6.0rc1-py2.7.egg-info/top_level.txt\n/usr/lib64/python2.7/site-packages/cx_Oracle.so\n3. 下载Oracle Library\n\n由于Oracle官网下载东西存在Auth认证，所以简单点就点击选中的rpm包保存在windows上，然后上传到linux上即可注意：\n\n下载的版本要和连接的Oracle基本一致，我需要连接的Oracle版本是11.2，所以我下载的是oracle-instantclient11.2-basic-11.2.0.3.0-1.x86_64.rpm\n\n\n操作系统要和之前下载的cx_Oracle要一致，这很重要！！！我在这个上面栽了跟头，花了比较多的时间。。。所以我需要下载64位的\n在Oracle官网下载东西你得先勾选Accept License Agreement，否则你下载不了\n其次你得有Oracle的账号\n\n4. 安装Oracle Library\n\nrpm -ivh oracle-instantclient11.2-basic-11.2.0.3.0-1.x86_64.rpm\n5. 配置环境变量\n\n修改Oracle安装路径将client64改为client，至于为什么要改暂时还不清楚，只知道不改的话会报错Oracle Client library cannot be loaded: libclntsh.so: cannot open shared object file: No such file or directory\n\ncd /usr/lib/oracle/11.2/\nmv client64 client\n打开~/.bashrc,追加环境变量路径\nvim ~/.bashrc\n配置环境变量\n// 查看Oracle安装路径\n[root@iZbp180vortqapb7yf8217Z ~]# rpm -qa | grep oracle | xargs rpm -ql\n/usr/lib/oracle/11.2/client64/bin/adrci\n/usr/lib/oracle/11.2/client64/bin/genezi\n/usr/lib/oracle/11.2/client64/lib/libclntsh.so.11.1\n/usr/lib/oracle/11.2/client64/lib/libnnz11.so\n/usr/lib/oracle/11.2/client64/lib/libocci.so.11.1\n/usr/lib/oracle/11.2/client64/lib/libociei.so\n/usr/lib/oracle/11.2/client64/lib/libocijdbc11.so\n/usr/lib/oracle/11.2/client64/lib/ojdbc5.jar\n/usr/lib/oracle/11.2/client64/lib/ojdbc6.jar\n/usr/lib/oracle/11.2/client64/lib/xstreams.jar\n// 追加ORACLE_HOME环境变量路径\nexport ORACLE_HOME=/usr/lib/oracle/11.2/client\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME/lib\n生效配置\nsource ~/.bashrc\n6. 检查是否可以引入cx_Oracle\n\nimport没有报错，说明之前的辛苦没有白费\n[root client64]# python\nPython 2.7.5 (default, Nov  6 2016, 00:28:07) \n[GCC 4.8.5 20150623 (Red Hat 4.8.5-11)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import cx_Oracle\n>>>\n7. 连接Oracle\n\n一个插入n条数据的Python脚本：\n#!/usr/bin/python\n# -*- coding: UTF-8 -*-\nimport sys\nimport cx_Oracle\nimport time\n\nrows = int(sys.argv[1])\ncon = cx_Oracle.connect('test/test@sampledb')\ncur = con.cursor()\ncur.execute(\"SELECT MAX(ID) FROM PTTEST\")\nmax_id = cur.fetchone()[0] or 0\n\nstart_id = max_id + 1\nfor i in xrange(rows):\n    cur.execute(\"INSERT INTO PTTEST (ID, NAME, AGE, GENDER, SALARY)VALUES(%d, 'pt', 15, 'male', 50000)\" % int(i + start_id))\n    if i % 100 == 0:\n        time.sleep(3)\n        print 'Insert rows [%d]:%d' % (int(time.time()), i)\n        con.commit()\ncur.close()\ncon.close()\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "3"}