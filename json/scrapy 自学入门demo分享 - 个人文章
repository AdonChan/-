{"title": " scrapy 自学入门demo分享 - 个人文章 ", "index": "scrapy,python", "content": "本文基于python 3.7.0，win10平台； 2018-08完整项目代码：https://github.com/NameHewei/python-scrapy\n\n安装\n安装python\n\n官网下载 https://www.python.org/\n\n注意环境变量是否配置成功\n\n安装scrapy\n为了安装顺利，请备好梯子\npip install Scrapy\n安装过程中注意以下报错信息：\nMicrosoft Visual C++ 14.0 is required. Get it with \"Microsoft Visual C++ Build Tools\" \n解决办法：\n\n\nhttps://www.lfd.uci.edu/~gohl... 下载对应版本twisted的whl文件\ncp：表示python版本\namd64：表示64位\n下载后在文件目录下执行： pip install Twisted-18.7.0-cp37-cp37m-win_amd64.whl(文件名)\n\n创建项目\n\n创建scrapy：scrapy startproject youName\n创建spider：scrapy genspider <name> <domain> // 在项目跟目录执行\n\n配置settings.py文件\n\n如果抓取的内容包含中文可配置：FEED_EXPORT_ENCODING = 'utf-8'\n报错误信息403：把USER_AGENT加上（可在网站请求头信息中查看）\n\n编写items.py文件\nimport scrapy\n\nclass NovelItem(scrapy.Item):\n    title = scrapy.Field()\n    content = scrapy.Field()\n这些即你需要保存的字段名\n编写spider\nimport scrapy\n\n# 引入自定义的items\nfrom myTest.items import NovelItem\n\n# # 继承scrapy.Spider\nclass NovelSpider(scrapy.Spider):\n    # 爬虫名\n    name = 'novel_spider'\n    # 允许的域名\n    allowed_domains = ['http://www.danmeila.com']\n    # 入口url 扔到调度器里面去\n    start_urls = ['http://www.danmeila.com/chapter/20180406/29649.html']\n\n\n    def parse(self, response):\n        movieList = response.xpath('//*[@id=\"container\"]/div[3]/div[2]/div[2]/div/div/ul/li')\n        novelContent = NovelItem()\n        for item in movieList:\n            u = 'http://www.danmeila.com' + item.xpath('.//a/@href').extract_first()\n            \n            yield scrapy.Request(u, callback= self.content_a, meta= { 'nc': novelContent }, dont_filter = True)\n            # 放到管道里否则 pipeline获取不到\n            # 如果你发现拿到的内容一直为空，注意是否被过滤了，即dont_filter没有设置\n\n\n    def content_a(self, response):\n        novelContent = response.meta['nc']\n        novelContent['title'] = response.xpath('//*[@id=\"J_article\"]/div[1]/h1/text()').extract_first()\n\n        yield novelContent\n注意以下几点：\n\n采用xpath编写，在浏览器中可以直接查看元素，找到要爬取内容的标签，右键选copy xpath\nextract_first()的使用；text() 获取文本；@属性名  获取属性值\n在父节点下使用xpath路径前要加./\n去除换行空格用 xpath('normalize-space('.//div/text()')')\n\n执行\n导出为json： scrapy crawl your-spider-name -o test.json\n如果出现报错信息：\n\nasync语法错误，把用到该名称作为参数的文件全部作修改 把这个参数名改为其它即可\n报错 No module named 'win32api'： 到https://pypi.org/project/pypi...（下载文件pypiwin32-223-py3-none-any.whl 执行 pip install pypiwin32-223-py3-none-any.whl ）\n\n若有疑问或错误，请留言，谢谢！Github blog issues\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "0"}