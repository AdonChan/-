{"title": "【python socket编程】—— 2.解析http请求头 - 个人文章 ", "index": "python,socket", "content": "前文：【python socket编程】—— 1.初探\n在上一篇文章中我们知道，socket.accept()接受的数据是请求头，请求头格式是这样的：\nPOST /login HTTP/1.1\nHost: 127.0.0.1:1207\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: http://127.0.0.1:1207/login\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 27\nCookie: D9zb2HfPUf8RI7AOwsUZpiBq\nConnection: keep-alive\nUpgrade-Insecure-Requests: 1\n\nusername=Harp&password=1234\n这是一个POST请求，请求头第一行是POST /login HTTP/1.1，以空格划分，分别是请求方法、路径和协议，之后则是key: value形式的各种数据组成的header，我们暂且不管每一行分别是什么意思，然后是空行，结尾的username=Harp&password=1234是body部分，表单通过POST方法提交的数据（如账号密码）就在这里，GET请求则没有body部分。请求头的换行使用的是'/r/n'。\n\n编写一个Request类，来解析请求的方法、路径、header和body，如下：\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n# contact: liutao25@baidu.com\n\nfrom urllib.parse import unquote, quote\n\n\nclass Request:\n    def __init__(self, r):\n        self.content = r\n        self.method = r.split()[0]\n        self.path = r.split()[1]\n        self.body = r.split('\\r\\n\\r\\n', 1)[1]\n\n    def form_body(self):\n        return self._parse_parameter(self.body)\n\n    def parse_path(self):\n        index = self.path.find('?')\n        if index == -1:\n            return self.path, {}\n        else:\n            path, query_string = self.path.split('?', 1)\n            query = self._parse_parameter(query_string)\n            return path, query\n\n    @property\n    def headers(self):\n        header_content = self.content.split('\\r\\n\\r\\n', 1)[0].split('\\r\\n')[1:]\n        result = {}\n        for line in header_content:\n            k, v = line.split(': ')\n            result[quote(k)] = quote(v)\n        return result\n\n    @staticmethod\n    def _parse_parameter(parameters):\n        args = parameters.split('&')\n        query = {}\n        for arg in args:\n            k, v = arg.split('=')\n            query[k] = unquote(v)\n        return query\n\n下一篇文章：【python socket编程】—— 3.响应\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}