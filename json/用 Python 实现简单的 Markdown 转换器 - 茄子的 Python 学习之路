{"title": "用 Python 实现简单的 Markdown 转换器 - 茄子的 Python 学习之路 ", "index": "markdown,python", "content": "今天心血来潮，写了一个 Markdown 转换器。\nimport os, re,webbrowser\ntext = '''\n# TextHeader\n    ## Header1\n        List\n            - 1 \n            - 2\n            - 3\n        > **quote**\n        》 quote2\n    ## Header2\n        1. *斜体*\n        2. [@以茄之名](https://www.zhihu.com/people/e4f87c3476a926c1e2ef51b4fcd18fa3)\n        3、 ![](https://pic4.zhimg.com/v2-8560440c136c746730a63813ed701f52_is.jpg)\n        \n    ## Header3 \n        `*[文章地址](https://zhuanlan.zhihu.com/p/39742445)*`\n        ·**code1**·\n        - [x]是否点赞\n'''\n\n程序开头先处理一些行内的语法，比如 code、strong、i 等，用正则直接替换：\ntext = re.sub(re.compile('([\\`·])([^`·]+)[\\`·]'), r'<code>\\2</code>', text)\ntext = re.sub(re.compile('\\*\\*([^\\*]+)\\*\\*'), r'<strong>\\1</strong>', text)\ntext = re.sub(re.compile('([^\\*])\\*([^\\*]+)\\*'), r'\\1<i>\\2</i>', text)\n\n接着是复杂一点的图片和链接：\ntext = re.sub(re.compile('([^\\!])\\[([^\\]]+)\\]\\(([^)]+)\\)'),\n              r'\\1<a href=\"\\3\" target=\"_blank\">\\2</a>', text)\ntext = re.sub(re.compile('\\!\\[([^\\]]*)\\]\\(([^)]+)\\)'),\n              r'<img src=\"\\2\" >', text)\n\n接着就处理其他的语法，先把文本按每一行分开：\nlines = text.split('\\n')\nhtml = ''\nlist_flag = ''\n\n处理列表和待办事项的问题：\nfor line in lines:\n    line = line.strip(' ')\n    if re.match('- \\[[ x]\\]', line):\n        print('matched')\n        p_html = ''\n        if re.match('- \\[x\\]', line):\n            p_html = ' checked=\"checked\"'\n        line = re.sub('- \\[[ x]\\]', '', line)\n        html += '''<label class=\"cssCheckbox\">\n        <input type=\"checkbox\" %s  />\n        <span></span>%s\n        </label>''' % (p_html, line)\n因为有序列表和无序列表的区别是头尾的ol和ul，所以要用 list_flag 变量来判断\nelif re.match('[\\+\\-\\*] ', line):\n    if list_flag == '':\n        html += '<ul>\\n'\n        list_flag = 'ul'\n    line = re.sub('[\\+\\-\\*] ', '', line)\n    html += '<li>%s</li>\\n' % (line)\nelif re.match('[\\d]+[.、] ', line):\n    if list_flag == '':\n        list_flag = 'ol'\n        html += '<ol>\\n'\n    line = re.sub('[\\d]+[.、] ', '', line)\n    html += '<li>%s</li>\\n' % (line)\n\n处理完后处理其他的语法：\nelse:\n        if list_flag != '':\n            html += '</%s>\\n' % list_flag\n            list_flag = ''\n        if re.match('\\#+', line):\n            well = re.match('\\#+', line).group().count('#')\n            line = re.sub('\\#+', '', line)\n            html += '<h%i>%s</h%i>\\n' % (well, line, well)\n        elif re.match('[>》 ]', line):\n            line = re.sub('^\\s*[>》 ]', '', line)\n            html += '<blockquote>%s</blockquote>\\n' % (line)\n\n        # elif re.match('[>》 ]', line):\n        #     line = re.sub('^\\s*[>》 ]', '', line)\n        #     html += '<blockquote>%s</blockquote>\\n' % (line)\n        else:\n            html += line\n\n这里我稍微修改了一点，让 > 和 》 都可以转换成引用，主要是切换中英文标点太难了。\n然后就是添加 CSS，自己改了一点马克飞象的进去，因为他的引用做得很漂亮：\nwith open('markdown.html', 'w', encoding='utf-8')as f:\n    f.write('''\n<html>\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n<style>body{\n    margin: 0 auto;\n    font-family: \"ubuntu\", \"Tahoma\", \"Microsoft YaHei\", arial,sans-serif;\n    color: #444444;\n    line-height: 1;\n    padding: 30px;\n} \ninput[type='checkbox']+span::before {\n  content:' ';/*不换行空格*/\n  display: inline-block;\n  vertical-align: 0.2em;\n  width:0.8em;\n  height:0.8em;\n  margin-right: .2em;\n  border-radius:.2em;\n  background: silver;/*复选框的背景色*/\n  text-indent:0.15em;\n  line-height: 0.65;\n}\ninput[type='checkbox'] {\n  /*隐藏掉原先实际的 checkbox 框，之所以没用 display:none; 这种简单直接的方式，是因为这种方法会把它从键盘 tab 键切换焦点的队列中完全删除*/\n \n  position: absolute;\n  clip:rect(0,0,0,0);\n}\ninput[type='checkbox']:checked+span::before {\n  content:'\\u221a'; /*对号的 Unicode字符*/\n  background: yellowgreen;/*对号的颜色*/\n}\nimg {\n    max-width: 100%;\n}\n@media screen and (min-width: 1000px) {\n    body {\n        width: 842px;\n        margin: 10px auto;\n    }\n\n    \n}\nh1, h2, h3, h4 {\n    color: #111111;\n    font-weight: 400;\n    margin-top: 1em;\n}\n\nh1, h2, h3, h4, h5 {\n    font-family: Georgia, Palatino, serif;\n}\nh1, h2, h3, h4, h5, dl{\n    margin-bottom: 16px;\n    padding: 0;\n}\n\np {\n    margin-top: 8px;\n    margin-bottom: 3px;\n}\nh1 {\n    font-size: 48px;\n    line-height: 54px;\n}\nh2 {\n    font-size: 36px;\n    line-height: 42px;\n}\nh1, h2 {\n    border-bottom: 1px solid #EFEAEA;\n    padding-bottom: 10px;\n}\nh3 {\n    font-size: 24px;\n    line-height: 30px;\n}\nh4 {\n    font-size: 21px;\n    line-height: 26px;\n}\nh5 {\n    font-size: 18px;\n    line-height: 23px;\n}\na {\n    color: #0099ff;\n    margin: 0 2px;\n    padding: 0;\n    vertical-align: baseline;\n    text-decoration: none;\n}\na:hover {\n    text-decoration: none;\n    color: #ff6600;\n}\na:visited {\n    /*color: purple;*/\n}\nul, ol {\n    padding: 0;\n    padding-left: 18px;\n    margin: 0;\n}\nli {\n    line-height: 24px;\n}\np, ul, ol {\n    font-size: 16px;\n    line-height: 24px;\n}\n\nol ol, ul ol {\n    list-style-type: lower-roman;\n}\n\ncode, pre {\n    font-family: Consolas, Monaco, Andale Mono, monospace;\n    background-color:#f7f7f7;\n    color: inherit;\n}\n\ncode {\n    font-family: Consolas, Monaco, Andale Mono, monospace;\n    margin: 0 2px;\n}\n\npre {\n    font-family: Consolas, Monaco, Andale Mono, monospace;\n    line-height: 1.7em;\n    overflow: auto;\n    padding: 6px 10px;\n    border-left: 5px solid #6CE26C;\n}\n\npre > code {\n    font-family: Consolas, Monaco, Andale Mono, monospace;\n    border: 0;\n    display: inline;\n    max-width: initial;\n    padding: 0;\n    margin: 0;\n    overflow: initial;\n    line-height: 1.6em;\n    font-size: .95em;\n    white-space: pre;\n    background: 0 0;\n\n}\n\ncode {\n    color: #666555;\n}\n\naside {\n    display: block;\n    float: right;\n    width: 390px;\n}\nblockquote {\n    border-left-width: 10px;\n    background-color: rgba(102,128,153,0.05);\n    border-top-right-radius: 5px;\n    border-bottom-right-radius: 5px;\n    padding: 15px 20px;\n}\nblockquote  cite {\n    font-size:14px;\n    line-height:20px;\n    color:#bfbfbf;\n}\nblockquote cite:before {\n    content: '\\2014 \\00A0';\n}\n\nblockquote p {\n    color: #666;\n}\nhr {\n    text-align: left;\n    color: #999;\n    height: 2px;\n    padding: 0;\n    margin: 16px 0;\n    background-color: #e7e7e7;\n    border: 0 none;\n}\n\ndl {\n    padding: 0;\n}\n\ndl dt {\n    padding: 10px 0;\n    margin-top: 16px;\n    font-size: 1em;\n    font-style: italic;\n    font-weight: bold;\n}\n\ndl dd {\n    padding: 0 16px;\n    margin-bottom: 16px;\n}\n\ndd {\n    margin-left: 0;\n}\n\ntable {\n    *border-collapse: collapse; /* IE7 and lower */\n    border-spacing: 0;\n    width: 100%;\n}\ntable {\n    border: solid #ccc 1px;\n}\n\ntable thead {\n    background: #f7f7f7;\n}\n\ntable thead tr:hover {\n    background: #f7f7f7\n}\ntable tr:hover {\n    background: #fbf8e9;\n    -o-transition: all 0.1s ease-in-out;\n    -webkit-transition: all 0.1s ease-in-out;\n    -moz-transition: all 0.1s ease-in-out;\n    -ms-transition: all 0.1s ease-in-out;\n    transition: all 0.1s ease-in-out;\n}\ntable td, .table th {\n    border-left: 1px solid #ccc;\n    border-top: 1px solid #ccc;\n    padding: 10px;\n    text-align: left;\n}\n\ntable th {\n    border-top: none;\n    text-shadow: 0 1px 0 rgba(255,255,255,.5);\n    padding: 5px;\n    border-left: 1px solid #ccc;\n}\n\ntable td:first-child, table th:first-child {\n    border-left: none;\n}</style></head>''')\n    f.write(html)\n    f.write('</html>')\n\n用 Chrome 打开网页：\nwebbrowser.get('C:/Program Files (x86)/CentBrowser/Application/chrome.exe %s').open(\n    'file:///'+os.getcwd()+'/markdown.html')\n\n话说这里也是个坑，系统自带的 Edge 一直打开失败，用那个注册器注册 Chrome 也没办法用 ，最后还是在外网找到了解决方案。\n最后的效果：\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}