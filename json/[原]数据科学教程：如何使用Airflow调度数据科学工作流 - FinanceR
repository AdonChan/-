{"title": "[原]数据科学教程：如何使用Airflow调度数据科学工作流 - FinanceR ", "index": "data-scientist,flask,python,airflow", "content": "\n概述\nAirflow 是一个我们正在用的工作流调度器，相对于传统的crontab任务管理，Airflow很好的为我们理清了复杂的任务依赖关系、监控任务执行的情况。我们喜欢它是因为它写代码太容易了，也便于调试、维护和继承重用，而不是像xml那样的配置文件用来描述DAG。\n\n通过SQL和HQL的临时查询，我们还可以快速生成前端图表，而且顺带连数据的API接口也都生成了，这几乎要让的Web开发工程师失业了。\n当然Airflow还支持移动端显示，只要收藏页面，我们就可以实现\"移动监控\"。\n\n功能总览\n1. 任务调度系统：DAGs\n强大的任务调度与管理\n\n调度代码一览无余\n\n2. 数据剖析\n\n配置 SQL 语句，以及作图的option\n\n图表自动生成\n\nAPI数据自动生成\n将当前的图表地址 http://localhost:8080/admin/airflow/chart?chart_id=2&iteration_no=40替换成 http://localhost:8080/admin/airflow/chart_data?chart_id=2&iteration_no=40即可返回json数据\n\n如果对 API数据自动生成不够满意，还可以轻松地对源代码自行定制。\n3. 监控管理\n任务日志\n\n任务监控\n\n调度配置化\n\n4. 权限管理\n系统配置\n\n用户管理\n\n数据源管理\n\n实战\n步骤一：安装Airflow\n如果通过 docker\ndocker pull airflow\n如果通过 pip\npip install -i https://pypi.tuna.tsinghua.edu.cn/simple airflow\n步骤二：修改默认路径\n这里如果不修改路径，默认的配置就是 ~/airflow\n临时修改 AIRFLOW_HOME 环境变量, 这里的 /home/airflow 可以替换成你想要的文件夹目录\nexport AIRFLOW_HOME=/home/airflow\n永久修改环境变量\necho \"export AIRFLOW_HOME=/home/airflow\" >> /etc/profile\nsource /etc/profile\n系统默认的配置文件是从 airflow包的configuration.py文件中获取的，在设置了路径和airflow.cfg之后，配置将由airflow.cfg所替代。\n步骤三：修改默认数据库\n找到配置文件\nvi /home/airflow/airflow.cfg\n修改sql配置\nsql_alchemy_conn = mysql://root:FinanceR@localhost:3306/airflow\n注意到，之前使用的 mysql+driver://root:FinanceR@localhost:3306/airflow的方式是行不通的。\n初始化服务器的数据库\nairflow initdb\nairflow webserver\n就可以开启后台管理界面，默认访问localhost:8080即可。\n步骤四：修改数据源配置\n通过create按钮，添加相应的参数\n\n步骤五：解决中文字符集显示问题\n注意到 airflow 的所有.py文件都声明了 utf-8 字符集\n# -*- coding: utf-8 -*-\n如果需要显示中文，需要在extra选项中添加{\"charset\":\"utf8\"}的配置\n\n参考资料\n\nAirflow 源码\n解密 Airbnb 的数据流编程神器：Airflow 中的技巧和陷阱\nAirflow实战\nAdvanced Airflow\nCSDN: airflow详解\nWork Flow Management for Big Data: Guide to Airflow\nAirflow agari\nAgari使用Airbnb的Airflow实现更智能计划任务的实践\n工作流调研 oozie vs azkaban\nOozie Demo WorkFlow\n\n招聘广告\n\nmobike 招聘 BI数据产品经理 \nmobike 招聘 Data Scienctist\nmobike 招聘 大数据平台架构师 Data Architect\n\n更优阅读体验可直接访问原文地址：https://segmentfault.com/a/11...作为分享主义者(sharism)，本人所有互联网发布的图文均遵从CC版权，转载请保留作者信息并注明作者 Harry Zhu 的 FinanceR专栏:https://segmentfault.com/blog...，如果涉及源代码请注明GitHub地址：https://github.com/harryprince。微信号: harryzhustudio商业使用请联系作者。\n\n                ", "mainLikeNum": ["3 "], "mainBookmarkNum": "22"}