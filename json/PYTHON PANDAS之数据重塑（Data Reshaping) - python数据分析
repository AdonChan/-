{"title": "PYTHON PANDAS之数据重塑（Data Reshaping) - python数据分析 ", "index": "pandas,python", "content": "实际遇到的问题：\n在CSV文件当中或者数据库当的数据通常以长格式或者（stacked)堆叠格式存储，特别是金融数据中出现的时间序列数据，例如：\nIn [1]: df\nOut[1]: \n         date variable     value\n0  2000-01-03        A  0.469112\n1  2000-01-04        A -0.282863\n2  2000-01-05        A -1.509059\n3  2000-01-03        B -1.135632\n4  2000-01-04        B  1.212112\n5  2000-01-05        B -0.173215\n6  2000-01-03        C  0.119209\n7  2000-01-04        C -1.044236\n8  2000-01-05        C -0.861849\n9  2000-01-03        D -2.104569\n10 2000-01-04        D -0.494929\n11 2000-01-05        D  1.071804\n那怎么才能变成以A,B,C,D作为列名，同时日期为索引的dataframe呢？特别需要对A,B,C,D同时进行时间序列分析时，这个需求特别强烈。\n解决方案：这里引出一个重要的概念，data reshaping,即数据重塑，\n选出变量A的所有数据我们只需要如下操作，然后分别选出B,C,D，然后再再水平方向进行concat操作，这样当然也可以得到指定的数据框，但这样无疑编写、执行效率都有点低：\nIn [2]: df[df['variable'] == 'A']\nOut[2]: \n        date variable     value\n0 2000-01-03        A  0.469112\n1 2000-01-04        A -0.282863\n2 2000-01-05        A -1.509059\n但是如果我们希望对变量进行时间序列操作，那么我们可能将需要将每个变量单独作为一列来表示，因此需要使用pivot()函数对数据进行reshape操作：\nIn [3]: df.pivot(index='date', columns='variable', values='value')\nOut[3]: \nvariable           A         B         C         D\ndate                                              \n2000-01-03  0.469112 -1.135632  0.119209 -2.104569\n2000-01-04 -0.282863  1.212112 -1.044236 -0.494929\n2000-01-05 -1.509059 -0.173215 -0.861849  1.071804\n如果上述函数当中的values参数被省略，得到的dataframe就会有带有层次化的列，列的顶层是带每个值列的列名，假如我们现在有value1,value2两列：\nIn [4]: df['value2'] = df['value'] * 2\n\nIn [5]: pivoted = df.pivot('date', 'variable')\n\nIn [6]: pivoted\nOut[6]: \n               value                                  value2            \\\nvariable           A         B         C         D         A         B   \ndate                                                                     \n2000-01-03  0.469112 -1.135632  0.119209 -2.104569  0.938225 -2.271265   \n2000-01-04 -0.282863  1.212112 -1.044236 -0.494929 -0.565727  2.424224   \n2000-01-05 -1.509059 -0.173215 -0.861849  1.071804 -3.018117 -0.346429   \n\n                                \nvariable           C         D  \ndate                            \n2000-01-03  0.238417 -4.209138  \n2000-01-04 -2.088472 -0.989859  \n2000-01-05 -1.723698  2.143608  \n对于以上多层次列数据框，此时也可以只显示value2这一列:\nIn [7]: pivoted['value2']\nOut[7]: \nvariable           A         B         C         D\ndate                                              \n2000-01-03  0.938225 -2.271265  0.238417 -4.209138\n2000-01-04 -0.565727  2.424224 -2.088472 -0.989859\n2000-01-05 -3.018117 -0.346429 -1.723698  2.143608\n可见pivot()函数是一个非常实用的，用来实现数据重塑的方法。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}