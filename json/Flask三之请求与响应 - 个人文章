{"title": "Flask三之请求与响应 - 个人文章 ", "index": "sqlite,centos,linux,flask,python", "content": "二.请求与响应\n1、HTTP方法\nGET: 浏览器告知服务器：只 获取 页面上的信息并发给我。这是最常用的方法。\nPOST: 浏览器告诉服务器：想在 URL 上 发布 新信息。并且，服务器必须确保数\n      据已存储且仅存储一次。这是 HTML 表单通常发送数据到服务器的方法。\n2、程序和请求上下文\n请求上下文：\nfrom flask import request\n@app.route('/useragent/')\ndef userAgent():\n    user_agent = request.headers.get('User-Agent')\n    return '<p>Your browser is %s</p>' % user_agent\n程序上下文：\nfrom flask import current_app\n# print('current_app.name:',current_app.name)\napp_ctx = app.app_context()\napp_ctx.push()\ncurrent_app.name\napp_ctx.pop()\n没激活程序上下文之前就调用 current_app.name 会导致错误，但推送完上下文\n之后就可以调用了。\n注意，在程序实例上调用 app.app_context() 可获得一个程序上下文。也就是说，\n有两种方式来创建程序上下文：\n1.第一种是隐式的：无论何时当一个请求上下文被压栈时， 如果有必要的话一个程\n序上下文会被一起创建。由于这个原因，你可以忽略程序上下文的存在，除非你需\n要它。\n第二种是显式地调用 app_context() 方法：\nfrom flask import Flask, current_app\napp = Flask(__name__)\nwith app.app_context():\n    # within this block, current_app points to app.\n    print current_app.name\n3、响应\nFlask 调用视图函数后，会将其返回值作为响应的内容。\n@app.route('/')\ndef index():\n    return '<h1>Bad Request</h1>', 400\n视图函数返回值即为响应\n如果不想返回一个元组，Flask视图函数还可以返回Response对象。make_response() 函数可接受一或多个参数（和视图函数的返回值一样），并返回一个 Response 对象。有时我们需要在视图函数中进行这种转换，然后在响应对象上调用各种方法，进一步设置响应。下例创建了一个响应对象：\nfrom flask import make_response\n@app.route('/response/')\ndef response():\n    resp = make_response('<h1>Bad Request</h1>',400)\n    return resp\n 响应的两种方法： \n\n视图函数直接返回一个元组 (response, status, headers)\n视图函数返回一个make_resonse()函数产生的响应对象\n\n4、Cookies\ncookies的操作：\n\n通过请求对象的 cookies 属性来访问 Cookies。（请求对象的 cookies 属性是一个内容为客户端提交的所有 Cookies 的字典。）\n通过响应对象的set_cookie方法来设置 Cookies。\n\n@app.route('/cookie/')\ndef cookie():\n    resp = make_response('set cookie')\n    resp.set_cookie('name','myname')\n    return resp\n5、请求钩子\n请求钩子使用修饰器实现。 Flask 支持以下 4 种钩子：\n• before_first_request：注册一个函数，在处理第一个请求之前运行。\n• before_request：注册一个函数，在每次请求之前运行。\n• after_request：注册一个函数，如果没有未处理的异常抛出，在每次请求之后运行。\n• teardown_request：注册一个函数，即使有未处理的异常抛出，也在每次请求之后运行。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}