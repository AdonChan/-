{"title": "Python_selenium_phantomjs动态抓取 - 倚楼听风雨 ", "index": "python,selenium,phantomjs", "content": "selenium:https://github.com/SeleniumHQ...当前版本3.0.1A browser automation framework and ecosystem\nphantomjs:http://phantomjs.org/是一个服务器端的 JavaScript API 的 WebKit。也可以说是无界面浏览器。其支持各种Web标准： DOM 处理, CSS 选择器, JSON, Canvas, 和 SVG.\n大部分的网页抓取用urllib都可以搞定，但是涉及到JavaScript及Ajax渲染的时候，urlopen就完全傻逼了，所以不得不用模拟浏览器，方法也有很多，此处采用的是selenium2+phantomjsselenium2支持所有主流的浏览器和phantomjs这些无界面的浏览器。安装：\npip install selenium\n\nphantomjs不是python程序，去官网下载对应系统版本的安装即可。\nfrom selenium import webdriver\nimport time\n \ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe')\ndriver.get(\"http://pythonscraping.com/pages/javascript/ajaxDemo.html\")\ntime.sleep(3)\nprint(driver.find_element_by_id(\"content\").text)\ndriver.close()\nfrom selenium import webdriver\n \ndriver = webdriver.PhantomJS(executable_path='C:\\Users\\Gentlyguitar\\Desktop\\phantomjs-1.9.7-windows\\phantomjs.exe')\ndriver.set_window_size(1120, 550)\ndriver.get(\"http://duckduckgo.com/\")\ndriver.find_element_by_id('search_form_input_homepage').send_keys(\"Nirvana\")\ndriver.find_element_by_id(\"search_button_homepage\").click()\nprint(driver.current_url)\ndriver.close()\n\nget方法会一直等到页面被完全加载，然后才会继续程序，但是对于ajax是无可奈何的。send_keys就是填充input表单\n等待页面渲染完成\n#等待页面渲染完成\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\nfrom selenium.webdriver.common.desired_capabilities import DesiredCapabilities\n \ndcap = dict(DesiredCapabilities.PHANTOMJS)\ndcap[\"phantomjs.page.settings.userAgent\"] = \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36\"\ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe', desired_capabilities=dcap)\ndriver.get(\"http://pythonscraping.com/pages/javascript/ajaxDemo.html\")\ntry:\n    element = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.ID, \"loadedButton\")))\nfinally:\n    print(driver.find_element_by_id(\"content\").text)\n    driver.close()\n\n处理Javascript重定向\n#处理Javascript重定向\nfrom selenium import webdriver\nimport time\nfrom selenium.webdriver.remote.webelement import WebElement\nfrom selenium.common.exceptions import StaleElementReferenceException\n \ndef waitForLoad(driver):\n    elem = driver.find_element_by_tag_name(\"html\")\n    count = 0\n    while True:\n        count += 1\n        if count > 20:\n            print(\"Timing out after 10 seconds and returning\")\n            return\n        time.sleep(.5)\n        try:\n            elem == driver.find_element_by_tag_name(\"html\")\n        #抛出StaleElementReferenceException异常说明elem元素已经消失了，也就说明页面已经跳转了。\n        except StaleElementReferenceException:  \n            return\n \ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe')\ndriver.get(\"http://pythonscraping.com/pages/javascript/redirectDemo1.html\")\nwaitForLoad(driver)\nprint(driver.page_source)\n\n设置PHANTOMJS的USER-AGENT\n有些网站的WebServer对User-Agent有限制，可能会拒绝不熟悉的User-Agent的访问。设置PhantomJS的user-agent，是要设置“phantomjs.page.settings.userAgent”这个desired_capability.\nfrom selenium import webdriver\nfrom selenium.webdriver.common.desired_capabilities import DesiredCapabilities\n \ndcap = dict(DesiredCapabilities.PHANTOMJS)\ndcap[\"phantomjs.page.settings.userAgent\"] = \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36\"\n \n \ndriver = webdriver.PhantomJS(executable_path='./phantomjs.exe', desired_capabilities=dcap)\ndriver.get(\"http://dianping.com/\")\ncap_dict = driver.desired_capabilities  #查看所有可用的desired_capabilities属性。\nfor key in cap_dict:\n    print '%s: %s' % (key, cap_dict[key])\nprint driver.current_url\ndriver.quit()\n\nDemo\ngithub\n#pip install selenium\n#安装phantomjs\n\nfrom selenium import webdriver\nimport time\nfrom selenium.webdriver.common.desired_capabilities import DesiredCapabilities\n \ndcap = dict(DesiredCapabilities.PHANTOMJS)\ndcap[\"phantomjs.page.settings.userAgent\"] = \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36\"\n\ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe', desired_capabilities=dcap)\ndriver.get(\"http://pythonscraping.com/pages/javascript/ajaxDemo.html\")\ntime.sleep(3)\nprint(driver.find_element_by_id(\"content\").text)\ndriver.close()\n\n#设置PHANTOMJS的USER-AGENT\nfrom selenium import webdriver\nfrom selenium.webdriver.common.desired_capabilities import DesiredCapabilities\n \ndcap = dict(DesiredCapabilities.PHANTOMJS)\ndcap[\"phantomjs.page.settings.userAgent\"] = \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36\"\n\n \ndriver = webdriver.PhantomJS(executable_path='./phantomjs.exe', desired_capabilities=dcap)\ndriver.get(\"http://dianping.com/\")\n\ncap_dict = driver.desired_capabilities  #查看所有可用的desired_capabilities属性。\nfor key in cap_dict:\n    print('%s: %s' % (key, cap_dict[key]))\nprint(driver.current_url)\ndriver.quit()\n\n#等待页面渲染完成\nfrom selenium.webdriver.common.by import By\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver.support import expected_conditions as EC\n\ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe')\ndriver.get(\"http://pythonscraping.com/pages/javascript/ajaxDemo.html\")\ntry:\n    element = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.ID, \"loadedButton\")))\nfinally:\n    print(driver.find_element_by_id(\"content\").text)\n    driver.close()\n\n#处理Javascript重定向\nfrom selenium import webdriver\nimport time\nfrom selenium.webdriver.remote.webelement import WebElement\nfrom selenium.common.exceptions import StaleElementReferenceException\n\ndef waitForLoad(driver):\n    elem = driver.find_element_by_tag_name(\"html\")\n    count = 0\n    while True:\n        count += 1\n        if count > 20:\n            print(\"Timing out after 10 seconds and returning\")\n            return\n        time.sleep(.5)\n        try:\n            elem == driver.find_element_by_tag_name(\"html\")\n        except StaleElementReferenceException:\n            return\n\ndriver = webdriver.PhantomJS(executable_path=r'C:\\Users\\taojw\\Desktop\\pywork\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe')\ndriver.get(\"http://pythonscraping.com/pages/javascript/redirectDemo1.html\")\nwaitForLoad(driver)\nprint(driver.page_source)\n##################################################################################\n#模拟拖拽\nfrom selenium import webdriver\nfrom selenium.webdriver.remote.webelement import WebElement\nfrom selenium.webdriver import ActionChains\n\ndriver = webdriver.PhantomJS(executable_path='phantomjs/bin/phantomjs')\ndriver.get('http://pythonscraping.com/pages/javascript/draggableDemo.html')\n\nprint(driver.find_element_by_id(\"message\").text)\n\nelement = driver.find_element_by_id(\"draggable\")\ntarget = driver.find_element_by_id(\"div2\")\nactions = ActionChains(driver)\nactions.drag_and_drop(element, target).perform()\n\nprint(driver.find_element_by_id(\"message\").text)\n##################################################################################\n#截屏\ndriver.get_screenshot_as_file('tmp/pythonscraping.png')\n\n####\n##################################################################################\n#登陆知乎，然后能自动点击页面下方的“更多”，以载入更多的内容\nfrom selenium import webdriver\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver.support.ui import WebDriverWait\nfrom selenium.webdriver import ActionChains\nimport time\nimport sys\n\ndriver = webdriver.PhantomJS(executable_path='C:\\Users\\Gentlyguitar\\Desktop\\phantomjs-1.9.7-windows\\phantomjs.exe')\ndriver.get(\"http://www.zhihu.com/#signin\")\n#driver.find_element_by_name('email').send_keys('your email')\ndriver.find_element_by_xpath('//input[@name=\"password\"]').send_keys('your password')\n#driver.find_element_by_xpath('//input[@name=\"password\"]').send_keys(Keys.RETURN)\ntime.sleep(2)\ndriver.get_screenshot_as_file('show.png')\n#driver.find_element_by_xpath('//button[@class=\"sign-button\"]').click()\ndriver.find_element_by_xpath('//form[@class=\"zu-side-login-box\"]').submit()\n\ntry:\n    #等待页面加载完毕\n    dr=WebDriverWait(driver,5)\n    dr.until(lambda the_driver:the_driver.find_element_by_xpath('//a[@class=\"zu-top-nav-userinfo \"]').is_displayed())\nexcept:\n    print('登录失败')\n    sys.exit(0)\ndriver.get_screenshot_as_file('show.png')\n#user=driver.find_element_by_class_name('zu-top-nav-userinfo ')\n#webdriver.ActionChains(driver).move_to_element(user).perform() #移动鼠标到我的用户名\nloadmore=driver.find_element_by_xpath('//a[@id=\"zh-load-more\"]')\nactions = ActionChains(driver)\nactions.move_to_element(loadmore)\nactions.click(loadmore)\nactions.perform()\ntime.sleep(2)\ndriver.get_screenshot_as_file('show.png')\nprint(driver.current_url)\nprint(driver.page_source)\ndriver.quit()\n##################################################################################\n\n参考：http://www.cnblogs.com/chenqi...http://www.realpython.com/blo...http://selenium-python.readth...http://www.cnblogs.com/paisen...http://smilejay.com/2013/12/s...更多参考：selenium webdriver的各种driver\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "5"}