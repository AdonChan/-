{"title": "PXE自动化安装系统（一） - 达龙 ", "index": "python,mysql,oracle,nginx,apache", "content": "博文参考\nPXE简介\nPXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client/Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由支持通过网络启动操作系统，再启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP（multicast trivial file transfer protocol）协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如：Windows95/98/2000/windows2003/windows2008/winXP/win7/win8/linux等。\nPXE启动原理\n当计算机引导时，BIOS把PXE Client 调入内存中执行，然后由 PXE Client 将放置在远端的文件通过网络下载到本地运行，工作流程图如下：\n\n1. Client向PXE Server上的DHCP发送IP地址请求消息，DHCP检测Client是否合法（主要是检测Client的网卡MAC地址），如果合法则返回Client的IP地址，同时将启动文件pxelinux.0的位置信息一并传送给Client。\n\n2. Client向PXE Server上的TFTP发送获取pxelinux.0请求消息，TFTP接收到消息之后再向Client发送pxelinux.0大小信息，试探Client是否满意，当TFTP收到Client发回的同意大小信息之后，正式向Client发送pxelinux.0。\n\n3. Client执行接收到的pxelinux.0文件。\n\n4. Client向TFTP发送针对本机的配置信息（记录在TFTP的pxelinux.cfg目录下），TFTP将配置文件发回Client，继而Client根据配置文件执行后续操作。\n\n5. Client向TFTP发送Linux内核请求信息，TFTP接收到消息之后将内核文件发送给Client。\n\n6. Client向TFTP发送根文件请求信息，TFTP接收到消息之后返回Linux根文件系统。\n\n7. Client启动Linux内核（启动参数已经在4中的配置文件中设置好了）。\n\n8. Client通过NFS下载镜像文件，读取autoyast自动化安装脚本。\nPXE安装配置\n涉及的服务：\n安装tftp\n在server172.16.47.101上\n[root@node1~]# yum install tftp tftp-server -y\n[root@node1~]# systemctl start tftp.socket\n[root@node1~]# systemctl enable tftp.socket\ntftp的默认目录为/var/lib/tftpboot/，如下图，拷贝一个文件到该目录下，测试tftp服务是否正常\ntftp> get fstabtftp> quit\n安装DHCP服务\n在server 172.16.47.101上安装dhcp服务，和tftp服务是在同一台机器上(注意:DHCP服务，必须先改配置文件，复制到/etc下，才能启动服务。)\n[root@localhost ~]# yum install dhcpd -y[root@localhost ~]# systemctl start dhcpd[root@localhost ~]# systemctl status dhcpd\nyum源\n挂载光盘\n\n配置httpd web服务\n安装httpd：yum install httpd；并把yum源挂载在http下，让客户端能够访问\n[root@localhost ~]# systemctl restart httpd\n可以看到httpd能正常服务，不过操作的时候要注意selinux和iptables\n\n安装syslinux\n安装syslinux：yum install syslinux，并复制系统引导启动所需要的文件到相应的目录中\ncp /mnt/isolinux/vmlinuz /var/lib/tftpboot/cp /mnt/isolinux/initrd.img /var/lib/tftpboot/cp /usr/share/syslinux/{chain.c32,menu.c32,memdisk,mboot.c32} /var/lib/tftpboot/ \n编辑default文件\ndefault menu.c32\nprompt 5\ntimeout 30\nMENU TITLE CentOS 7_Lurker PXE Menu\n \nLABEL linux-Lurker\nMEMU LABEL Install CentOS 7_Lurker X86_64\nKERNEL vmlinuz\nAPPEND initrd=initrd.img\ninst.repo=http://172.168.47.101/centos/7/x86_64\n新建虚拟机，可以看到启动的引导过程如下：\n如上default文件中并没有指定kickstart文件，无法应答安装时的各步骤，无法实现全自动安装。\n\n现我们修改一下/root/目录下的anaconda-ks.cfg文件，放到/var/www/html/kickstarts/下，并重新修改default文件如下\ndefault menu.c32\nprompt 5\ntimeout 30\nMENU TITLE CentOS 7_Lurker PXE Menu\n \nLABEL Linux-Lurker\nMEMU LABEL ^Install CentOS 7_Lurker X86_64\nKERNEL vmlinuz\nAPPEND initrd=initrd.img\ninst.repo=http://172.168.47.101/centos/7/x86_64\n \nLABEL Linux_Autoinst\nMENU LABEL ^AutoInstall CentOS 7 x86_64\nKERNEL vmlinuz\nAPPEND initrd=initrd.img\ninst.repo=http://172.168.47.101/centos/7/x86_64\nks=http://172.16.47.101/kickstarts/centos7.cfg\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "4"}