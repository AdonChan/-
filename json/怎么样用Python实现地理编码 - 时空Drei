{"title": "怎么样用Python实现地理编码 - 时空Drei ", "index": "python,gis", "content": "(本文已授权Python中文社区发布)\n引言\n今天看到一篇阿里云的文章天下武功，唯快不破，以物流行业为例，分析了 PostgreSQL 与 Greenplum 在地理位置信息处理，最佳路径算法，机器学习等方面的物流行业应用方法。其中提到了地址转换成坐标的问题，更专业些的名词应该是“地理编码”，即知道一个地址，如北京市海淀区上地十街10号，怎么样可以获取到对应的经纬度位置信息(40,116)，或者反过来。\n地理编码概念\n很多地图相关的厂商都提供了相关的API，我们可以直接利用这些API得到这些信息。比如百度的Geocoding API。\nGeocoding API是一类接口，用于提供从地址到经纬度坐标或者从经纬度坐标到地址的转换服务，用户可以使用C# 、C++、Java等开发语言发送请求且接收JSON、XML的返回数据。Geocoding API包括地址解析和逆地址解析功能：\n\n借用ESRI文档中更直观的一张图\n\n\n地理编码：即地址解析，由详细到街道的结构化地址得到百度经纬度信息，例如：“北京市海淀区中关村南大街27号”地址解析的结果是“lng:116.31985,lat:39.959836”。同时，地理编码也支持名胜古迹、标志性建筑名称直接解析返回百度经纬度，例如：“百度大厦”地址解析的结果是“lng:116.30815,lat:40.056885” 。\n逆地理编码：即逆地址解析，由百度经纬度信息得到结构化地址信息，例如：“lat:31.325152,lng:120.558957”逆地址解析的结果是“江苏省苏州市虎丘区塔园路318号”。\n\n不过，需要说明的一点是，若想使用百度的这套API的前提是，有百度账号并申请相应的Key。其实，除了百度之外，谷歌、ESRI、微软的Bing等都有类似的地理编码服务。不过这些服务大多没有专门针对Python的库并且彼此之间的Json结构也不一致。于是乎专治不服的Python大神做了一个专门的地理编码工具geocoder，将这些不同厂商的服务整合统一起来。\n地理编码工具geocoder\n\n首先看一下它都支持哪些公司的地理编码服务:\n\n\nProvider\nOptimal\nUsage Policy\n\n\n\nArcGIS\nWorld\n \n\n\n \nBaidu\nChina\nAPI key\n\n\nBing\nWorld\nAPI key\n\n\nCanadaPost\nCanada\nAPI key\n\n\nFreeGeoIP\nWorld\n \n\n\n \nGeocoder.ca\nCA & US\nRate Limit\n\n\nGeocodeFarm\nWorld\nPolicy\n\n\nGeoNames\nWorld\nUsername\n\n\nGeoOttawa\nOttawa\n \n\n\nGoogle\nWorld\nRate Limit, Policy\n\n\n\nHERE\nWorld\nAPI key\n\n\nIPInfo\nWorld\n \n\n\n \nMapbox\nWorld\nAPI key\n\n\nMapQuest\nWorld\nAPI key\n\n\nMapzen\nWorld\nAPI key\n\n\nMaxMind\nWorld\n \n\n\n \nOpenCage\nWorld\nAPI key\n\n\nOpenStreetMap\nWorld\nPolicy\n\n\nTamu\nUS\nAPI key\n\n\nTomTom\nWorld\nAPI key\n\n\nWhat3Words\nWorld\nAPI key\n\n\nYahoo\nWorld\n \n\n\nYandex\nRussia\n \n\n\n \nTGOS\nTaiwan\n \n\n\n\n安装\npip install geocoder\n地理编码\nimport geocoder\ng = geocoder.google(\"1403 Washington Ave, New Orleans, LA 70130\")\ng = geocoder.arcgis(u\"北京市海淀区上地十街10号\")\ng.latlng\n输出为\n[29.9287839, -90.08421849999999]\n也可以查看完整的geojson\ng.geojson\n输出为\n{'bbox': [-90.0855674802915,\n  29.9274349197085,\n  -90.0828695197085,\n  29.9301328802915],\n 'geometry': {'coordinates': [-90.08421849999999, 29.9287839],\n  'type': 'Point'},\n 'properties': {'accuracy': u'ROOFTOP',\n  'address': u'1403 Washington Ave, New Orleans, LA 70130, USA',\n  'bbox': [-90.0855674802915,\n   29.9274349197085,\n   -90.0828695197085,\n   29.9301328802915],\n  'city': u'New Orleans',\n  'confidence': 9,\n  'country': u'US',\n  'county': u'Orleans Parish',\n  'encoding': 'utf-8',\n  'housenumber': u'1403',\n  'lat': 29.9287839,\n  'lng': -90.08421849999999,\n  'location': '1403 Washington Ave, New Orleans, LA 70130',\n  'neighborhood': u'Garden District',\n  'ok': True,\n  'place': u'ChIJGyFHWc2lIIYRYSoneaXAUiw',\n  'postal': u'70130',\n  'provider': 'google',\n  'quality': u'street_address',\n  'state': u'LA',\n  'status': 'OK',\n  'status_code': 200,\n  'street': u'Washington Ave'},\n 'type': 'Feature'}\n直接用Google尝试查询中文地址时失败\ng = geocoder.google(u\"北京市海淀区上地十街10号\")\ng.ok\n输出为\nFalse\n用百度应该没问题，不过我没有申请相应的key。切换到arcgis，能够成功编码\ng = geocoder.arcgis(u\"北京市海淀区上地十街10号\")\ng.latlng\n输出为\n[40.050934, 116.30079]\n逆地理编码\ng = geocoder.google([29.9287839, -90.08421849999999], method='reverse')\n\nprint g.address\nprint g.city\nprint g.state\nprint g.country\n输出为\n1403 Washington Ave, New Orleans, LA 70115, USA\nNew Orleans\nLA\nUS\n换成中国的地址\ng = geocoder.google([40.050934, 116.30079], method='reverse')\nprint g.address\nprint g.city\nprint g.state\nprint g.country\n输出为\nBai Du Da Sha, Haidian Qu, Beijing Shi, China, 100193\nBeijing\nBeijing Shi\nCN\n用arcgis的服务试试\ng = geocoder.arcgis([40.050934, 116.30079], method='reverse')\nprint g.address\nprint g.city\nprint g.state\nprint g.country\n输出为\nNone\n北京市\n北京市\nCHN\nGoogle转换成的是英文，但地址比较全。arcgis虽然是中文，但是详细的地址居然输出为了None，这有个X用。\n其他\ngeocoder 的功能不止于此，它还可以查IP（包括自己的）。\ng = geocoder.ip('199.7.157.0')\nprint g.latlng\nprint g.city\ng = geocoder.ip('me')\nprint g.latlng\nprint g.city\n输出为\n[43.6934, -79.4857]\nToronto\n[51.05, 13.75]\nDresden\n查询一个城市的空间包围盒\ng = geocoder.arcgis(u\"山东\")\ng.bbox\n输出为\n{'northeast': [38.976997, 121.976998], 'southwest': [33.022997, 116.022998]}\n小结\n空间信息既可以利用行政区划、自然地理区域等文本信息描述，也可以用坐标系统、数字（邮编等）来标识。利用地理编码技术，可以将空间信息的地理定位要素与相应的文本信息关联起来。本文主要介绍了geocoder地理编码这一小工具，可以方便快捷的利用地图等相关厂商提供的地理编码服务，将文字描述的位置转换成地图上的经纬度，或者通过地图上的某个位置坐标获得相应的位置信息文字描述。\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}