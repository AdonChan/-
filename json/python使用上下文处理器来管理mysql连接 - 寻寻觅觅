{"title": "python使用上下文处理器来管理mysql连接 - 寻寻觅觅 ", "index": "python", "content": "一，使用contextmanager\nfrom contextlib import contextmanager\nimport MySQLdb\n\nDB_CONFIG = {\n    'host': '192.168.1.253',\n    'user': 'pythondb',\n    'passwd': 'python123',\n    'port': 20002,\n    'db': 'xw',\n    'charset': 'utf8'\n}\n\n\n@contextmanager\ndef open_mysql(db_conf):\n    try:\n        conn = MySQLdb.connect(**db_conf)\n        if conn:\n            yield conn.cursor(cursorclass=MySQLdb.cursors.DictCursor)\n    except Exception as e:\n        print(e)\n    finally:\n        conn.close()\n\nif __name__ == '__main__':\n    with open_mysql(DB_CONFIG) as con:\n        sql = 'select 1 as c'\n        con.execute(sql)\n        rv = con.fetchall()\n        print(rv)\n\n二，使用__enter__跟__exit__\nclass OpenMysqlConn(object):\n    def __init__(self, db_conf):\n        self.db_conf = db_conf\n        self.conn = None\n\n    def __enter__(self):\n        try:\n            self.conn = MySQLdb.connect(**self.db_conf)\n            if self.conn:\n                return self.conn.cursor(cursorclass=MySQLdb.cursors.DictCursor)\n        except (AttributeError, MySQLdb.OperationalError):\n            current_app.logger.error(\"连接数据库失败\")\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        if self.conn:\n            self.conn.close()\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "1"}