{"title": "lxml处理xml时的字符编码问题 - Let’s Test It ", "index": "python,xml,lxml", "content": "为了简化问题，就把xml的内容简化为如下的形式:\n\n<?xml version=\"1.0\" encoding=\"gbk\"?><DOCUMENT><da><![CDATA[中文，就是任性]]></da></DOCUMENT>\n\n\n它的encoding为gbk，其中的节点有一个为中文字符\n使用lxml提取节点的值时出现了如下的异常\n\nlxml.etree.XMLSyntaxError: Extra content at the end of the document\n\n\n此时对应的Python脚本为：\n\ntst = u'<?xml version=\"1.0\" encoding=\"gbk\"?><DOCUMENT><da><![CDATA[中文，就是任性]]></da></DOCUMENT>'\nfor event,element in etree.iterparse(BytesIO(tst.encode('utf-8'))):\n    print(\"%s, %s\" % (element.tag, element.text))\n\n\n不过简化之前，报的是另外一个异常\n\nlxml.etree.XMLSyntaxError: input conversion failed due to input error, bytes 0x8B 0x2C 0xE6 0x9D\n\n\n不论异常是哪一个，猜测还是和字符的编码形式有关。\n经过各种尝试无果，后来在stackoverflow上看到这篇文章，文中提到的问题和xml中的encoding值有关，尝试了增加了一段代码\n\ntst = u'<?xml version=\"1.0\" encoding=\"gbk\"?><DOCUMENT><da><![CDATA[中文，就是任性]]></da></DOCUMENT>'\ntst = tst.replace('encoding=\"gbk\"', 'encoding=\"utf-8\"')\nfor event,element in etree.iterparse(BytesIO(tst.encode('utf-8'))):\n    print(\"%s, %s\" % (element.tag, element.text))\n\n\n增加了一个替换的语句，将之前的encoding=\"gbk\"替换成encoding:\"utf-8\"\n于是终于得到了结果：\n\nda, 中文，就是任性\nDOCUMENT, None\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "3"}