{"title": "Virtualenv加Django加UWSGI加Nginx多站点部署 - python技术的魅力 ", "index": "django,nginx,uwsgi,virtualenv,python", "content": "安装 Virtualenv\npip install –U virtualenv\n搭建并进入 Virtualenv 环境\nmkdir /Django/cmdb/\ncd /Django/cmdb/\nvirtualenv --no-site-packages --distribute env\ncd env/\nsource bin/activate\n查看虚拟环境\n/Django/cmdb/env\n[root@saltstack env]# ll\ndrwxr-xr-x 2 root root 4096 May 27 16:04 bin\ndrwxr-xr-x 2 root root 4096 May 27 12:01 include\ndrwxr-xr-x 3 root root 4096 May 27 12:01 lib\nlrwxrwxrwx 1 root root    3 May 27 12:01 lib64 -> lib\n安装 Django 等需要的类库\npip install django\n下面就可以进行Django项目、应用的部署了\n安装 uwsgi\npip install uwsgi\n配置多站点\n假设我们的两个站点分别叫cmdb和bbs\n在env目录下（类似/Django/cmdb/env）新建文件夹 uwsgi_conf\nmkdir uwsgi_conf/\n进入uwsgi_conf 下建立 wa_uwsgi.ini 和 wb_uwsgi.ini 两个配置文件\ncd uwsgi_conf/\ntouch cmdb.ini\ntouch bbs.ini\ncmdb.ini配置文件的内容\n[uwsgi]\n#plugins = python\nvirtualenv = /Django/cmdb/env/\nchdir = /Django/cmdb/env/CMDB/\ntouch-reload = /Django/cmdb/env/CMDB/\nmodule = CMDB.wsgi\nsocket = 127.0.0.1:3500\nvhost = false\nchmod-socket = 664\nmaster = true\nenable-threads = true\nworkers = 4 \nthreads = 2\nvacuum = true\nmax-requests = 6000\npidfile = /var/log/uwsgi/cmdb.pid\ndaemonize = /var/log/uwsgi/cmdb.log\n#touch-logreopen = /var/log/module/.touchforlogrotate\nbbs.ini和cmdb.ini内容差不多，参考修改即可。\n可以用 uwsgi 的 emperor 模式来启动 uwsgi 服务\nuwsgi --emperor /Django/cmdb/env/uwsgi_conf/\n想要重启某站点的时候，就 touch 一下该站点的配置文件\ntouch /Django/cmdb/env/uwsgi_conf/cmdb.ini\n配置Nginx\n    server {\n        listen 80;\n        server_name cmdb.test.com;\n\n        #location /service/ {\n        #    proxy_set_header Host service.test.com;\n        #    proxy_pass http://service.test.com;\n        #}\n\n        charset utf-8;\n        access_log logs/cmdb/access.log;\n        error_log logs/cmdb/error.log;\n        root /Django/cmdb/env/CMDB;\n        client_max_body_size 75M;\n        # location /admin {\n        #    alias /Django/mysite/static/admin;\n        #    }\n\n        location /static {\n            alias /Django/cmdb/env/CMDB/static; # your Django project's static files\n            }\n\n        location /media {\n            alias /Django/cmdb/env/CMDB/static; # your Django project's media files\n            }\n\n        location / {\n            #uwsgi_pass unix:/var/log/uwsgi/cmdb.sock;\n            uwsgi_pass 127.0.0.1:3500;\n            include uwsgi_params; # the uwsgi_params file you installed\n            }\n  }\n重启Nginx访问测试\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}