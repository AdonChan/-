{"title": "Flask Bind-DLZ + Mysql DNS管理平台 - 个人文章 ", "index": "python", "content": "系统环境：CentOS 6.5 X64\n软件版本：\n\n绑定-9.9.5.tar.gz\nmysql-5.6.16.tar.gz\n\n描述：\n\n数据库安装就不在这里具体说了，了解运维的同学都应该知道，不知道的大家可以百度查阅。\n绑定相关配置文件，详见https://github.com/1032231418...\n\n\n源码安装配置绑定\n1.源码编译安装\ntar -zxvf  bind-9.9.5.tar.gz           #解压压缩包\n cd bind-9.9.5\n ./configure --prefix=/usr/local/bind/  \\\n --enable-threads=no \\\n --enable-newstats   \\\n --with-dlz-mysql    \\\n --disable-openssl-version-check\n\n #官网说明强调编译关闭多线程，即--enable-threads=no\n\n make\n make install           #源码编译安装完成\n2.环境变量配置\ncat>>/etc/profile<\nPATH=$PATH:/usr/local/bind/bin:/usr/local/bind/sbin\nexport PATH\nEOF\nsource  /etc/profile  #重新加载一下环境变量\nnamed -v  \n如下图，说明环境变量是正常\n3.用户添加授权目录\nuseradd -s /sbin/nologin named\nchown -R named:named /usr/local/bind/\n4.配置绑定\nvi /usr/local/bind/etc/named.conf\noptions{\n        directory\"/usr/local/bind/\";\n        version\"bind-9.9.9\";\n        listen-onport53 { any; };\n        allow-query-cache { any; };\n        listen-on-v6port53 {::1; };\n        allow-query { any; };\n        recursion yes; \n        dnssec-enable yes;\n        dnssec-validation yes;\n        dnssec-lookaside auto;\n\n};\n\n\nkey\"rndc-key\"{\n        algorithm hmac-md5;\n        secret\"C4Fg6OGjJipHKfgUWcAh+g==\";\n\n};\n\ncontrols {\n        inet 127.0.0.1port953\n                allow{ 127.0.0.1; } keys {\"rndc-key\";};\n};\n\n\nview\"ours_domain\"{\n        match-clients {any; };\n        allow-query-cache {any; };\n        allow-recursion {any; };\n        allow-transfer {any; };\n\n        dlz\"Mysql zone\"{\n                database\"mysql\n                {host=127.0.0.1 dbname=named ssl=false port=3306 user=root pass=123456}\n                {select zone from dns_records where zone='$zone$'}\n                {select ttl, type, mx_priority, case when lower(type)='txt' then concat('\\\"',data,'\\\"') when lower(type) = 'soa' then concat_ws(' ', data, resp_person, serial, refresh, retry, expire, minimum) else data end from dns_records where zone = '$zone$' and host = '$record$'}\";\n        };\n        zone\".\"IN {\n            type hint;\n            file\"/usr/local/bind/etc/named.ca\";\n        };\n\n};\n保存退出\n生成name.ca文件\n(demo) -bash-4.1# cd /usr/local/bind/etc/\n(demo) -bash-4.1# dig -t NS .>named.ca\n5.配置数据库，导入sql文件\n# mysql -p #登录数据库\nmysql>CREATE DATABASE named CHARACTER SET utf8 COLLATE utf8_general_ci;\nmysql>source named.sql; #注意路径，这里我放在当前目录\n就两张表，一个dns用到的表，一个用户管理表\n6.启动绑定服务并设置开机启动脚本\n(demo) -bash-4.1# /usr/local/bind/sbin/named\n监控系统日志：\ntail -f /var/log/messages\n如下，说明服务启动正常\n测试bind连接数据库是否正常：\n\n设置绑定开机启动脚本\nbind 本文档会附带，传到服务器  /etc/init.d/ 目录\n(demo) -bash-4.1# chmod  755 /etc/init.d/bind \n(demo) -bash-4.1# #mkdir  /var/run/named/ && chown  named:named -R /var/run/named \n杀掉 named  服务，改用脚本启动\n\n(demo) -bash-4.1# pkill  named\n(demo) -bash-4.1# /etc/init.d/bind  start            #监控日志，查看启动状态\n(demo) -bash-4.1# chkconfig  --add bind            #加入开机启动\n＃tail -f / var / log / messages\n\n配置Bind-Web管理平台\n克隆管理平台\n(demo) -bash-4.1# git  clone  https://github.com/1032231418/Bind-Web.git  #git  克隆下来\n(demo) -bash-4.1# cd Bind-Web\n(demo) -bash-4.1# python  run.py\n运行软件程序使用烧瓶框架写的，要用pip安装该框架    点安装 http：// ip / 5000   访问WEB界面登录账户：老鹰 密码：123456\n功能：\n\n用户管理\n域名管理\n......\n\n\n解析测试：\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "2"}