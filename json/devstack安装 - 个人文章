{"title": "devstack安装 - 个人文章 ", "index": "python,openstack,devstack", "content": "系统及版本\n\nUbuntu16.0 LTS\nOpenStack版本Rocky\n\nUbuntu配置\n\n4G RAM\n4核处理器(开启处理器虚拟化)\n40G可用空间\n网络设置(NAT模式与宿主机连接)IP配置xxx:xxx:xxx:xxx\n\napt配置\n在DevStack安装过程中要使用apt安装依赖软件，Ubuntu默认使用美国源，在国内使用下载速度会非常慢，甚至导致安装失败，所以要更换国内源。这里使用中科大的镜像源.。\n# 首先备份原/etc/apt/sources.list文件\n$ sudo mv /etc/apt/sources.list  /etc/apt/sources.list.bak\n# 编辑新的sources.list\n$ sudo vim /etc/apt/sources.list\nsources.list内容如下\ndeb http://mirrors.ustc.edu.cn/ubuntu/ xenial main restricted universe multiverse \ndeb-src http://mirrors.ustc.edu.cn/ubuntu/ xenial main restricted universe multiverse \ndeb http://mirrors.ustc.edu.cn/ubuntu/ xenial-security main restricted universe multiverse\ndeb-src http://mirrors.ustc.edu.cn/ubuntu/ xenial-security main restricted universe multiverse\ndeb http://mirrors.ustc.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse\ndeb-src http://mirrors.ustc.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse\ndeb http://mirrors.ustc.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse\ndeb-src http://mirrors.ustc.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse\n## Not recommended\n# deb http://mirrors.ustc.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse\n# deb-src http://mirrors.ustc.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse\n这里选用的是http传输＋xenial版本，更多发行版可以自行在中科大网站自行配置\n# 更新软件\n$ sudo apt-get update\n$ sudo apt-get upgrade\n# 安装git\nsudo apt-get install git\n创建stack用户\n$ sudo useradd -s /bin/bash -d /opt/stack -m stack\n# 因为stack用户在安装过程中要使用sudo命令且安装过程中不会询问密码，所以要给stack用户无明码的sudo权力\n$ echo \"stack ALL=(ALL) NOPASSWD: ALL\" | sudo tee /etc/sudoers.d/stack\n# 切换用户\n$ sudo su - stack\n更换pip源\nopenstack基于Python语言，在安装过程中要使用pip相应的包，更换为国内源会加快安装速度。编辑~/.pip/pip.conf(没有就创建)\n[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n设置git代理\ndevstack安装过程中要从GitHub下载openstack代码,所以最好为git设置代理,否则容易因为下载超时而中断安装.这里使用shadowsocks来作为代理.\n安装并设置shadowsocks客户端\n# 安装shadowsocks客户端\n$ sudo apt install shadowsocks\n# 配置shadowsocks\n$ sudo vim /etc/shadowsocks.json\n# shadowsocks.json\n\n{\n\"server\":\"server-ip\",\n\"server_port\":8000,\n\"local_address\": \"127.0.0.1\",\n\"local_port\":1080,\n\"password\":\"your-password\",\n\"timeout\":600,\n\"method\":\"aes-256-cfb\"\n}\n# 启动shadowsocks客户端\n$ sudo sslocal -c /etc/shadowsocks.json -d start\n更多关于shadowsocks命令行的使用可以参考这篇blog\n为git http/https协议设置代理\n在配置shadowsocks时我们设置了shadowsocks客户端监听本地1080端口,发送到这个端口的请求可以通过shadowsocks转发至代理服务器\n$ git config --global http.proxy 'sock5://127.0.0.1:1080'\n$ git config --global https.porxy 'sock5://127.0.0.1:1080'\n下载devstack\n$ git clone https://git.openstack.org/openstack-dev/devstack\ncd devstack\n创建local.conf文件\nlocalconf用于控制安装的一些配置，如各服务的密码和服务端口等,更多配置可以参考官方文档最简配置如下\n[[local|localrc]]\nADMIN_PASSWORD=secret\nDATABASE_PASSWORD=$ADMIN_PASSWORD\nRABBIT_PASSWORD=$ADMIN_PASSWORD\nSERVICE_PASSWORD=$ADMIN_PASSWORD\n开始安装\n$ ./stack.sh\n安装失败的补救措施\n如果安装失败,一般出错信息会显示在最近的log信息里,按log修复即可.如果不能修复,可以执行下面的命令重新开始安装\n$ ./unstack.sh\n$ ./clean.sh\nsudo rm -rf /opt/stack\nsudo reboot\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}