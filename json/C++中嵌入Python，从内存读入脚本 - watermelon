{"title": "C++中嵌入Python，从内存读入脚本 - watermelon ", "index": "c++,python", "content": "int main()\n{\n    PyObject *pName, *pModule, *pArgs, *pValue, *pFunc;\n    PyObject *pGlobal = PyDict_New();\n    PyObject *pLocal;\n\n    //Create a new module object\n    PyObject *pNewMod = PyModule_New(\"mymod\");\n\n    Py_Initialize();\n    PyModule_AddStringConstant(pNewMod, \"__file__\", \"\");\n\n    //Get the dictionary object from my module so I can pass this to PyRun_String\n    pLocal = PyModule_GetDict(pNewMod);\n\n    //Define my function in the newly created module\n    pValue = PyRun_String(\"def blah(x):\\n\\tprint 5 * x\\n\\treturn 77\\n\", Py_file_input, pGlobal, pLocal);\n    Py_DECREF(pValue);\n\n    //Get a pointer to the function I just defined\n    pFunc = PyObject_GetAttrString(pNewMod, \"blah\");\n\n    //Build a tuple to hold my arguments (just the number 4 in this case)\n    pArgs = PyTuple_New(1);\n    pValue = PyInt_FromLong(4);\n    PyTuple_SetItem(pArgs, 0, pValue);\n\n    //Call my function, passing it the number four\n    pValue = PyObject_CallObject(pFunc, pArgs);\n    Py_DECREF(pArgs);\n    printf(\"Returned val: %ld\\n\", PyInt_AsLong(pValue));\n    Py_DECREF(pValue);\n\n    Py_XDECREF(pFunc);\n    Py_DECREF(pNewMod);\n    Py_Finalize();\n\n    return 0;\n}\n\n\n参考：http://stackoverflow.com/questions/3789881/create-and-call-python-function-from-string-via-c-api?s=737aab37-4e1e-4945-a887-16dd97cfece1#new-answer\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}