{"title": "Tornado按天打印日志 - 码农咖啡馆 ", "index": "web,日志,python,tornado", "content": "网站流量上来后，日志按天甚至小时存储更方便查看和管理，而Python的logging模块也提供了TimedRotatingFileHandler来支持以不同的时间维度归档日志。\n然而根据Logging HOWTO的官方指南设置后，却发现新的日志只剩下root的，Tornado内部的logger全部没有生效。\n参考stackoverflow上的一个回答，我发现下面的配置能让Tornado内部的logger也用上TimedRotatingFileHandler：\n\n# logging.yaml\n\nversion: 1\ndisable_existing_loggers: false\nformatters:\n  simple:\n    format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n\nloggers:\n  all:\n    handlers: [all]\n    propagate: false\n  tornado:\n    handlers: [all]\n    propagate: false\n\nhandlers:\n  console:\n    class: logging.StreamHandler\n    level: INFO\n    formatter: simple\n    stream: ext://sys.stdout\n  all:\n    class: logging.handlers.TimedRotatingFileHandler\n    level: INFO\n    formatter: simple\n    when: midnight\n    filename: ./logs/server.log\n\nroot:\n  level: INFO\n  handlers: [console, all]\n  propagate: true\n\n\n只需在Tornado的入口代码处调用：\n\npythonlogging.config.dictConfig(yaml.load(open('logging.yaml', 'r')))\n\n\n\n如果你想按别的时间维度分割日志，修改when参数对应的值就可以了。\n\n特别注意：当when的值是D，表示由服务器启动的时间计起，每过24小时归档一次；而如果你和我一样，希望在每天的凌晨归档日志的话，可以配置为midnight。\nCentos系统可能需要先安装python-yaml：sudo yum install python-yaml\n\n\n\n  来自：建造者说\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "10"}