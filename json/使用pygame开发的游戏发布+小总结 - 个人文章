{"title": "使用pygame开发的游戏发布+小总结 - 个人文章 ", "index": "python", "content": "概述\n大约两年前接触了python，然后就爱上了这个语言。然后就想用它写游戏，很快就找到了pygame这个库，但是pygame貌似十分冷门，网上教程也比较少，好在还有个文档来参考。于是胡乱搞了很久，前后搞了弹幕射击类（模拟东方project系列）、ARPG和这次的AVG(文字冒险)。这次的文字冒险游戏由于有前几次的经验积累，耗时5天成功开发了出来。于是准备在这里总结下用pygame开发游戏的经验，大致讲一下这个游戏是怎么开发出来的，代码比较长就不贴在这里了。但是会附上作品和源码，以供有兴趣的同学参考学习和玩耍。这里主要是讲思想。\n游戏制作\n环境\npython2.7+制作游戏需要安装的pygame操作系统是在windows下，而且由于是py2exe发布的，所以只能在windows下运行（但是源码也许能在其他OS上跑，好像没有依赖windows的库）\n游戏资源\n游戏资源就是游戏要使用的音乐、图片、文字等，本游戏使用一下几类：\n\npics/ 图片信息\ndiags/ 游戏中的对话\nfonts/ 字体\nitem/ 游戏中的道具信息\nmusic/ 音乐信息\nsound/ 音效\n\n类的设计\n类的设计大部分依赖于游戏的资源，主要有这些类：\n\nMusic\nSound\nTxt\nButton\nLh\nMoji\nItem\nRule\nSysb\nStory\n\n其中Music,Sound,Lh,Moji,Item分别是读取文件中的音乐、音效、立绘图片、对话内容和道具的信息并组织管理起来。其中Moji类还要管理游戏中的对话部分，显示哪一条语句、画哪些立绘等。\nTxt是游戏中需要在哪些位置显示一些文字时需要，例如左上角显示位置，按钮上的提示信息等。\nButton是一个矩形按钮，可以为其配置位置、大小、图片、快捷键、功能等。在很多时候，我们都需要一个按钮。\nSysb为本游戏的证物系统，管理证物的显示，指证等。\nRule为游戏规则，每个游戏都有它的规则，小到先画背景，再画人物，再画对话框；具体到比如弹幕射击类的自机是否与地方弹幕碰撞？是则发生miss等。\nStroy为游戏剧本，由一个关键变量event值控制故事走向，也包括flag的控制功能。本来我是将剧本都写入这个类里面，但是这样若故事长的话会导致代码长度剧增，而且也不美观。所以就把它改成了个解释器，用来读外部一个文件内的“指令”，并解释执行从而控制游戏走向。这样的话，剧本就可以写在外部文件，而且主程序导出exe后，不会编程的人也可以尝试利用这些指令写出新的故事让游戏程序去运行。关于这个游戏的解释指令问题，有兴趣的可以去下载游戏，里面有文档说明。（可能算是个超劣质版的橙光？）\n主程序\n有了这些大类，已经可以想出游戏的框架了，看看主程序的循环就知道了：\nwhile True:\n    keyp=pygame.key.get_pressed()\n    moup=pygame.mouse.get_pressed()\n    mou_pos=pygame.mouse.get_pos()\n    timep = clock.tick(60)\n    for event in pygame.event.get():\n        if event.type == QUIT:\n            exit()\n    rule.run()\n    story.run()\n首先获取键盘的按键状态、鼠标的按键状态和鼠标位置，用来进行交互；然后控制一下帧率，帧率在实时类游戏中很重要，用来掌控时间，在本游戏中用处很小。设置好关闭；最后让规则和故事“run”就可以了。\n几乎所有的类都有个“run”方法，只要它存在在游戏中，它每帧都会run一次，实现它该有的作用。例如Button类每次run都会检测鼠标是不是在自己的范围内，是的话绘制第二个图像，再进一步判断鼠标是否点击，是的话运行自己的“功能”。\n游戏\n这里介绍一下这次开发的游戏，类型是文字冒险游戏：是类似逆转裁判的游戏方式，在自由行动时，q为调查，w为移动，e为交谈；r为看已获取的证物，按方向键或a、d切换，并可以在对话中按z指证；\n运行时是这个样子的：\n游戏有两个结局。\n游戏、代码地址（顺便附带了第一次制作的半成品弹幕射击游戏）：网盘\n游戏素材来源于逆转裁判、仙剑和网上。\n其他\n做游戏真是比较开心，但是这大概是第一次算是完整的做出了个游戏吗？（还是因为暑假没回家才有的干活动力）\n这大概是最后一次使用pygame去开发游戏？pygame毕竟是比较老了，很久没更新了，感觉很多功能不是特别爽。下面可能会去研究研究pyglet。\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "3"}