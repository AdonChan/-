{"title": "python3 pillow生成简单验证码图片 - 个人文章 ", "index": "django,python", "content": "使用Python的pillow模块 random 模块随机生成验证码图片，并应用到Django项目中\n安装pillow\n$ pip3 install pillow\n生成验证码图片\n\\vericode.py\n\nfrom PIL import Image,ImageDraw,ImageFont,ImageFilter\nimport random\n\n #随机码 默认长度=1\ndef random_code(lenght=1):    \n    code = ''\n    for char in range(lenght):\n        code += chr(random.randint(65,90))\n    return code\n\n #随机颜色 默认颜色范围【1，255】\ndef random_color(s=1,e=255):\n    return (random.randint(s,e),random.randint(s,e),random.randint(s,e))\n\n #生成验证码图片\n #length 验证码长度\n #width 图片宽度\n #height 图片高度\n #返回验证码和图片\ndef veri_code(lenght=4,width=160,height=40):\n    #创建Image对象\n    image = Image.new('RGB',(width,height),(255,255,255))\n    #创建Font对象\n    font = ImageFont.truetype('Arial.ttf',32)\n    #创建Draw对象\n    draw = ImageDraw.Draw(image)\n    #随机颜色填充每个像素\n    for x in range(width):\n        for y in range(height):\n            draw.point((x,y),fill=random_color(64,255))\n    #验证码\n    code = random_code(lenght)\n    #随机颜色验证码写到图片上\n    for t in range(lenght):\n        draw.text((40*t+5,5),code[t],font=font,fill=random_color(32,127))\n    #模糊滤镜\n    image = image.filter(ImageFilter.BLUR)\n    return code,image\n应用\n编写Django应用下的视图函数\n\\views.py\n\nfrom . import vericode.py\nfrom io import BytesIO\nfrom django.http import HttpResponse\n\ndef verify_code(request):\n    f = BytesIO()\n    code,image = vericode.veri_code()\n    image.save(f,'jpeg')\n    request.session['vericode'] = code\n    return HttpResponse(f.getvalue())\n\ndef submit_xxx(request):\n    if request.method == \"POST\":\n        vericode = request.session.get(\"vericode\").upper()\n        submitcode = request.POST.get(\"vericode\").upper()\n        if submitcode == vericode:\n            return HttpResponse('ok')\n    return HttpResponse('error')\n这里使用了Django的session，需要在Django settings.py的INSTALLED_APPS中添加'django.contrib.sessions'(默认添加)verify_code视图函数将验证码添加到session中和验证码图片一起发送给浏览器，当提交表单到submit_xxx()时，先从session中获取验证码，再对比从表单中的输入的验证码。这里只是简单说明，url配置和前端代码未给出。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "4"}