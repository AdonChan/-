{"title": "Python-OpenCV进行人脸识别 - 个人文章 ", "index": "python,opencv", "content": "在之前的文章中，我们学习了使用数据集训练出一个识别器。本文中，我们将载入这个识别器，然后来看见怎么识别人脸。\n如果看过之前的文章，你就已经准备好了一个识别器，它就在trainner文件夹和trainner.yml文件里面。\n现在，我们将使用这个训练好的文件去识别人脸了。\n导入\nimport cv2\nimport numpy as np\n加载识别器\n接下来，我们用OpenCV库以及我们训练好的数据（yml文件）创建一个识别器对象：\nrecognizer = cv2.face.LBPHFaceRecognizer_create()\n# recognizer = cv2.createLBPHFaceRecognizer() # in OpenCV 2\nrecognizer.read('trainner/trainner.yml')\n# recognizer.load('trainner/trainner.yml') # in OpenCV 2\n然后用之前准备好的xml创建一个分类器：\ncascade_path = \"haarcascade_frontalface_default.xml\"\nface_cascade = cv2.CascadeClassifier(cascade_path)\n获取到摄像头的控制对象：\ncam = cv2.VideoCapture(0)\n加载一个字体，用于在识别后，在图片上标注出识别对象的名字：\n# font = cv2.cv.InitFont(cv2.cv.CV_FONT_HERSHEY_SIMPLEX, 1, 1, 0, 1, 1)\nfont = cv2.FONT_HERSHEY_SIMPLEX\n识别程序的主循环\n在程序的主循环中，我们需要做的是：\n\n从摄像头中获取图像\n将图像转换为灰度图片\n在图片中检测人脸\n用识别器识别该人的id\n将识别出人脸的id或名称用矩形在图片中标出来\n\nwhile True:\n    ret, im = cam.read()\n    gray = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)\n    faces = face_cascade.detectMultiScale(gray, 1.2, 5)\n    for (x, y, w, h) in faces:\n        cv2.rectangle(im, (x - 50, y - 50), (x + w + 50, y + h + 50), (225, 0, 0), 2)\n        img_id, conf = recognizer.predict(gray[y:y + h, x:x + w])\n        # cv2.cv.PutText(cv2.cv.fromarray(im), str(Id), (x, y + h), font, 255)\n        cv2.putText(im, str(img_id), (x, y + h), font, 0.55, (0, 255, 0), 1)\n    cv2.imshow('im', im)\n    if cv2.waitKey(10) & 0xFF == ord('q'):\n        break\nrecognizer.predict为预测函数，putText则是在图片上添加文字\n更进一步\n由于可能识别不出来，或者存在未知的人脸。而且，如果只用id1，id2就会大大地降低了程序的体验。因此，我们可以把id换成名字，把未知的脸标为未知。\n我们把程序改成：\n        img_id, conf = recognizer.predict(gray[y:y + h, x:x + w])\n        if conf > 50:\n            if img_id == 1:\n                img_id = 'jianyujianyu'\n            elif img_id == 2:\n                img_id = 'ghost'\n        else:\n            img_id = \"Unknown\"\n        # cv2.cv.PutText(cv2.cv.fromarray(im), str(Id), (x, y + h), font, 255)\n        cv2.putText(im, str(img_id), (x, y + h), font, 0.55, (0, 255, 0), 1)\n释放资源\n记得释放资源\ncam.release()\ncv2.destroyAllWindows()\n测试\n然后在测试阶段，这个人工智障完美地识别不出我。\n\n我觉得是素材不够丰富，我回头改改。。。\n完整代码\n现在的目录：\n\nimport cv2\nimport numpy as np\n\nrecognizer = cv2.face.LBPHFaceRecognizer_create()\n# recognizer = cv2.createLBPHFaceRecognizer() # in OpenCV 2\nrecognizer.read('trainner/trainner.yml')\n# recognizer.load('trainner/trainner.yml') # in OpenCV 2\n\ncascade_path = \"haarcascade_frontalface_default.xml\"\nface_cascade = cv2.CascadeClassifier(cascade_path)\ncam = cv2.VideoCapture(0)\n# font = cv2.cv.InitFont(cv2.cv.CV_FONT_HERSHEY_SIMPLEX, 1, 1, 0, 1, 1) # in OpenCV 2\nfont = cv2.FONT_HERSHEY_SIMPLEX\n\nwhile True:\n    ret, im = cam.read()\n    gray = cv2.cvtColor(im, cv2.COLOR_BGR2GRAY)\n    faces = face_cascade.detectMultiScale(gray, 1.2, 5)\n    for (x, y, w, h) in faces:\n        cv2.rectangle(im, (x - 50, y - 50), (x + w + 50, y + h + 50), (225, 0, 0), 2)\n        img_id, conf = recognizer.predict(gray[y:y + h, x:x + w])\n        if conf > 50:\n            if img_id == 1:\n                img_id = 'jianyujianyu'\n            elif img_id == 2:\n                img_id = 'ghost'\n        else:\n            img_id = \"Unknown\"\n        # cv2.cv.PutText(cv2.cv.fromarray(im), str(Id), (x, y + h), font, 255)\n        cv2.putText(im, str(img_id), (x, y + h), font, 0.55, (0, 255, 0), 1)\n    cv2.imshow('im', im)\n    if cv2.waitKey(10) & 0xFF == ord('q'):\n        break\n\ncam.release()\ncv2.destroyAllWindows()\n先这样吧\n原文，若有错误之处请指出，更多地关注煎鱼。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}