{"title": "python读excel写入mysql小工具 - zhoutk ", "index": "macos,mysql,python", "content": "背景\n需要导入全国高校名录到数据库，从教委网站下到了最新的数据，是excel格式，需要做一个工具进行导入，想试用一下python，说干就干。\n库\n\nxlrd : excel读写库\npymysql : mysql数据库驱动库，纯python打造\nre : 正则表达式库，核心库\n\n前两个用pip轻松完成安装，本人是在mac pro是进行的，过程很顺利，以前在mac上装mysqlclient一直安装不上，所以一度放弃使用python，但我在linux下安装mysqlclient却没有任何问题。\n源代码\n很简单的小脚本，留存纪念。值得注意的一点，数据库连接字段串中要设定字符编码，不然默认是lanti-1，写入会出错。\nimport xlrd\nimport pymysql\nimport re\n\nconn = pymysql.connect(host='database connect address', port=1234, user='root',\n                       passwd='****', db='database name', charset='utf8mb4')\np = re.compile(r'\\s')\ndata = xlrd.open_workbook('./W020170616379651135432.xls')\ntable = data.sheets()[0]\nt = table.col_values(1)\nnrows = table.nrows\nfor i in range(nrows):\n    r1 = table.row_values(i)\n    if len(r1[2]) == 10:\n        cur = conn.cursor()\n        cur.execute('insert into `university` (`id`, `name`, `ministry`, `city`, `level`, `memo`) \\\n                    values (%s, %s, %s, %s, %s, %s)',\n                    (r1[2], p.sub('', r1[1]), p.sub('', r1[3]), p.sub('', r1[4]), r1[5], r1[6]))\n        conn.commit()\n        cur.close()\n\nconn.close()\n心得\n写惯了类C的语言，不太习惯python，想同时掌握两种风格的编程语言，好痛苦啊。python编程效率的确不错，这是我第一次用python写实用小程序，连查带写带调试，一共也就花了一个来小时。python库与资料丰富，不愁找不到合适的^_^\n数据库写入优化\n早上闲来无事，用批量写入优化了一下，任务秒完成，比一条条写入快了很多， 比我预想的差别还要大。看来，没有不好的工具，只是我们没有用好啊！\nimport xlrd\nimport pymysql\nimport re\n\nconn = pymysql.connect(host='database connect address', port=1234, user='root',\n                       passwd='****', db='database name', charset='utf8mb4')\np = re.compile(r'\\s')\ndata = xlrd.open_workbook('./W020170616379651135432.xls')\ntable = data.sheets()[0]\nt = table.col_values(1)\nnrows = table.nrows\nops = []\nfor i in range(nrows):\n    r1 = table.row_values(i)\n    if len(r1[2]) == 10:\n        ops.append((r1[2], p.sub('', r1[1]), p.sub('', r1[3]), p.sub('', r1[4]), r1[5], r1[6]))\n\ncur = conn.cursor()\ncur.executemany('insert into `university_copy` (`id`, `name`, `ministry`, `city`, `level`, `memo`) \\\n                 values (%s, %s, %s, %s, %s, %s)', ops)\nconn.commit()\ncur.close()\n\nconn.close()\n\n                ", "mainLikeNum": ["3 "], "mainBookmarkNum": "6"}