{"title": "用python跑一边脚本，把数据传到几台服务器的指定位置 - 假分子 ", "index": "linux,python", "content": "创业公司，但也逐渐积累了十多态服务器，有时候因为一点小疏忽，就导致了十多台服务器返工，刚开始会使用ssh一台一台登上去修改，或者scp、sftp一个一个上传，基本上只要发生一点错误，就会花去小半天时间，这不是最重要的，最重要的是，小半天时间都在做一件重复的事：ssh链接 -> 找到文件目录 -> 修改 (或者：scp上传 -> 查看效果 ......)\n时间久了，就再也不想这样干了，于是学习了python，写了一段利用scp上传文件的脚本：\n\n\n引入包: paramiko\n引入服务器的配置：from config.server import server_data\n添加下面的代码：\n\n #!/usr/bin/python\n# -*- coding: UTF-8 -*-\n\nimport paramiko\n\nfrom config.server import server_data # 服务器配置数据\n\nimport sys\nreload(sys)\nsys.setdefaultencoding('utf8')\n\n# 建立单独的scp链接\ndef trans (hostname, username, password, port, sites):\n\n    scp = paramiko.Transport((hostname, port))\n    scp.connect(username=username, password=password)\n\n    sftp = paramiko.SFTPClient.from_transport(scp)\n\n    for v in sites:\n        print v\n        u = '/host/sites/' + v['domain'] + '/msites/public/images/12124.png' # 文件在服务器中存储的路径\n        print u\n        try:\n            sftp.put('./upload/12124.png', u)　# 文件本地存储路径\n        except Exception as e:\n            print \"Error: %s\" % e\n            pass\n\n    sftp.close()\n\n# 执行每个网站\ndef main ():\n\n    i = 0\n    for data in server_data:\n        i = i + 1\n        print i\n        trans(data['hostname'], data['username'], data['password'], data['port'], data['sites'])\n\nif __name__ == '__main__':\n    main()\n\n\n服务器配置：\nserver_data = [\n{\n    'hostname': '',　# 需要填写\n    'id': , # 需要填写\n    'username': 'root',\n    'port': 22, # 需要填写\n    'password': '', # 需要填写\n    'sites': [\n        {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n       {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n        {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n    ]\n},\n{\n    'hostname': '',\n    'id': ,\n    'username': 'root',\n    'port': 22,\n    'password': '',\n    'sites': [\n        {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n       {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n        {\n            'name': '百度'.decode('utf-8'),\n            'domain': 'baidu.com',\n            'alias': 'bd',\n            'fallname': '百度'.decode('utf-8')\n        },\n    ]\n}\n];\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}