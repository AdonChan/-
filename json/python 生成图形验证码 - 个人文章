{"title": "python 生成图形验证码 - 个人文章 ", "index": "python", "content": "文章链接：https://mp.weixin.qq.com/s/LYUBRNallHcjnhJb1R3ZBg\n\n日常在网站使用过程中经常遇到图形验证，今天准备自己做个图形验证码，这算是个简单的功能，也适合新手练习的，便于自己学习。   主要用到的库--PIL图像处理库，简单的思路，我们需要随机的颜色，随机的数字或字母，随机的线条、点作为干扰元素 拼凑成一张图片。  \n生成随机颜色，返回的是rgb三色。\ndef getRandomColor():\n    r = random.randint(0, 255)\n    g = random.randint(0, 255)\n    b = random.randint(0, 255)\n    return (r, g, b)\n从数字、大小写字母里生成随机字符。\ndef getRandomChar():\n    random_num = str(random.randint(0, 9))\n    random_lower = chr(random.randint(97, 122))  # 小写字母a~z\n    random_upper = chr(random.randint(65, 90))  # 大写字母A~Z\n    random_char = random.choice([random_num, random_lower, random_upper])\n    return random_char\n图片操作，生成一张随机背景色的图片，随机生成5种字符+5种颜色，在图片上描绘字，由于默认的字体很小，还需要对字进行处理，不同系统下的字体文件存放位置不一样，这里我是把window下的 arial.ttf 字体复制到了当前文件夹下直接使用的。\n# 图片宽高\nwidth = 160\nheight = 50\n\ndef createImg():\n    bg_color = getRandomColor()\n    # 创建一张随机背景色的图片\n    img = Image.new(mode=\"RGB\", size=(width, height), color=bg_color)\n    # 获取图片画笔，用于描绘字\n    draw = ImageDraw.Draw(img)\n    # 修改字体\n    font = ImageFont.truetype(font=\"arial.ttf\", size=36)\n    for i in range(5):\n        # 随机生成5种字符+5种颜色\n        random_txt = getRandomChar()\n        txt_color = getRandomColor()\n        # 避免文字颜色和背景色一致重合\n        while txt_color == bg_color:\n            txt_color = getRandomColor()\n        # 根据坐标填充文字\n        draw.text((10 + 30 * i, 3), text=random_txt, fill=txt_color, font=font)\n    # 打开图片操作，并保存在当前文件夹下\n    with open(\"test.png\", \"wb\") as f:\n        img.save(f, format=\"png\")\n这个时候可以看到文件夹下面的图片   \n\n这里是张很清晰的图片，为了有干扰元素，这里还需要在图片加入些线条、点作为干扰点。   随机画线，在图片宽高范围内随机生成2个坐标点，并通过随机颜色产生线条。\ndef drawLine(draw):\n    for i in range(5):\n        x1 = random.randint(0, width)\n        x2 = random.randint(0, width)\n        y1 = random.randint(0, height)\n        y2 = random.randint(0, height)\n        draw.line((x1, y1, x2, y2), fill=getRandomColor())\n随机画点，随机生成横纵坐标点。\ndef drawPoint(draw):\n    for i in range(50):\n        x = random.randint(0, width)\n        y = random.randint(0, height)\n        draw.point((x,y), fill=getRandomColor())\n生成方法\ndef createImg():\n    bg_color = getRandomColor()\n    # 创建一张随机背景色的图片\n    img = Image.new(mode=\"RGB\", size=(width, height), color=bg_color)\n    # 获取图片画笔，用于描绘字\n    draw = ImageDraw.Draw(img)\n    # 修改字体\n    font = ImageFont.truetype(font=\"arial.ttf\", size=36)\n    for i in range(5):\n        # 随机生成5种字符+5种颜色\n        random_txt = getRandomChar()\n        txt_color = getRandomColor()\n        # 避免文字颜色和背景色一致重合\n        while txt_color == bg_color:\n            txt_color = getRandomColor()\n        # 根据坐标填充文字\n        draw.text((10 + 30 * i, 3), text=random_txt, fill=txt_color, font=font)\n    # 画干扰线点\n    drawLine(draw)\n    drawPoint(draw)\n    # 打开图片操作，并保存在当前文件夹下\n    with open(\"test.png\", \"wb\") as f:\n        img.save(f, format=\"png\")\n最终生成的图片   这里介绍的是图片生成的方法，可以将图片直接显示在前端，也可以使用接口返回url。这里我简单的把图片做成链接显示在网页上，https://www.manjiexiang.cn/blog/validate 用Django做的，需要注意的是图片保存的路径。  \n欢迎关注我的个人博客：https://www.manjiexiang.cn/  \n更多精彩欢迎关注微信号：春风十里不如认识你  一起学习，一起进步，欢迎上车，有问题随时联系，一起解决！！！\n\n\n                ", "mainLikeNum": ["3 "], "mainBookmarkNum": "1"}