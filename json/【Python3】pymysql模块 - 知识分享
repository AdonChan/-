{"title": "【Python3】pymysql模块 - 知识分享 ", "index": "mysql,pymysql,python3.x,python", "content": "【Python3】pymysql模块\n1. 什么是 PyMySQL？\nPyMySQL 是在 Python3.x 版本中用于连接 MySQL 服务器的一个库，Python2中则使用mysqldb。\nPyMySQL 遵循 Python 数据库 API v2.0 规范，并包含了 pure-Python MySQL 客户端库。\n2. PyMySQL 安装\npip3 install PyMySQL\n3. 使用操作\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n  \n# 创建连接\nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\n# 创建游标\ncursor = conn.cursor()\n  \n# 执行SQL，并返回收影响行数\neffect_row = cursor.execute(\"update hosts set host = '1.1.1.2'\")\n  \n# 执行SQL，并返回受影响行数\n#effect_row = cursor.execute(\"update hosts set host = '1.1.1.2' where nid > %s\", (1,))\n  \n# 执行SQL，并返回受影响行数\n#effect_row = cursor.executemany(\"insert into hosts(host,color_id)values(%s,%s)\", [(\"1.1.1.11\",1),(\"1.1.1.11\",2)])\n  \n  \n# 提交，不然无法保存新建或者修改的数据\nconn.commit()\n  \n# 关闭游标\ncursor.close()\n# 关闭连接\nconn.close()\n注：当使用字符串格式化时容易引起sql注入\nsql = 'select * from userinfo where username=\"%s\" and password=\"%s\" ' %(user,pwd,)      #不推荐使用\nsql = 'select * from userinfo where username=%s and password=%s',[user,pwd]    #推荐使用，mysql会自动格式化，避免SQL注入\nimport pymysql\n\nuser = input('请输入用户名:')\npwd = input('请输入密码:')\n\n# 获取数据\nconn = pymysql.Connect(host='192.168.12.89',port=3306,user='root',password=\"123\",database=\"s17day11db\",charset='utf8')\ncursor = conn.cursor()\n\nv = cursor.execute('select * from userinfo where username=%s and password=%s',[user,pwd])\nresult = cursor.fetchone()\ncursor.close()\nconn.close()\n\nprint(result)\n获取新创建数据自增ID\nnew_class_id = cursor.lastrowid # 获取新增数据自增ID\n复制代码\nimport pymysql\n\n# 获取数据\nconn = pymysql.Connect(host='192.168.12.89',port=3306,user='root',password=\"123\",database=\"s17day11db\",charset='utf8')\ncursor = conn.cursor()\n\ncursor.execute('insert into class(caption) values(%s)',['新班级'])\nconn.commit()\nnew_class_id = cursor.lastrowid # 获取新增数据自增ID\n\ncursor.execute('insert into student(sname,gender,class_id) values(%s,%s,%s)',['李杰','男',new_class_id])\nconn.commit()\n\ncursor.close()\nconn.close()\n查询语句\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n  \nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\ncursor = conn.cursor()\ncursor.execute(\"select * from hosts\")\n  \n# 获取第一行数据\nrow_1 = cursor.fetchone()\n  \n# 获取前n行数据\n# row_2 = cursor.fetchmany(3)\n# 获取所有数据\n# row_3 = cursor.fetchall()\n  \nconn.commit()\ncursor.close()\nconn.close()\n注：在fetch数据时按照顺序进行，可以使用cursor.scroll(num,mode)来移动游标位置，如：\n\ncursor.scroll(1,mode='relative')  # 相对当前位置移动\ncursor.scroll(2,mode='absolute') # 相对绝对位置移动\n更改fetch数据类型默认获取的数据是元祖类型，如果想要或者字典类型的数据\n\ncursor = conn.cursor(cursor=pymysql.cursors.DictCursor)\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport pymysql\n  \nconn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='123', db='t1')\n  \n# 游标设置为字典类型\ncursor = conn.cursor(cursor=pymysql.cursors.DictCursor)\nv = cursor.execute('SELECT * FROM score')\nresult = cursor.fetchall()\n# result = cursor.fetchone()\n# result = cursor.fetchmany()\nprint(result)\n\n\n\ncursor.close()\nconn.close()\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}