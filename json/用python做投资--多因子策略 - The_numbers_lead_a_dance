{"title": "用python做投资--多因子策略 - The_numbers_lead_a_dance ", "index": "pandas,互联网金融,数据,股票,python", "content": "导语：每一位宽客都相信，影响股票涨跌的因素不胜枚举，而这些“因素”就是因子！本文作为一篇合格的入门教程，提供代码当做框架，各路宽客可以自己测试，查看收益率，亦可利用聚宽python平台自行构建代码。\n规范源码已更新！请大家克隆研究。\n本文由JoinQuant量化课堂推出 。难度标签为进阶上，理解深度标签：level-0\n\nJoinQuant免费提供数据获取、研究环境、策略回测、实盘连接、发送交易信号，学习交流等功能.\n\n作者： 导数君\n编辑： 宏观经济算命师\n\n因子\n因子是什么？通俗来讲。选股择时，我们得有一个标准对不对？这些标准就叫做因子。比如，我认为营收增长率高的公司就是好公司！那我就把营收增长率大于30%的股票拉出来纳入石榴裙下好了。这个营收增长率大于30%就是因子，完毕。\n因子有选股的因子（股票好不好），有择时的因子（好股票什么时候买）。由于择时往往跟技术指标关系紧密，本篇中就介绍基本面类的因子吧，偏财务向。\n选取因子\n最简单的方法，先物色一些自己喜欢的因子，比如增长率啦，市值啦，ROE啦，等等。然后一个个往里面加，看看效果如何，效果好了留下，效果差了删除，反复重复这个过程就能找到心仪的因子啦。\n举个例子，小编先选两个因子，ROA和净利润/营业总收入(%)。ROA和利润率比较高的一般都是表现良好的公司，所以小编决定选取ROA和净利润/营业总收入前20名的股票买入，回测结果如下图所示：\n\n表现比大盘略好一点，11年的收益有3.98倍。那换个因子试试？小编把净利润/营业总收入换成净利润环比增长率(%)，回测结果如下图所示：\n\n然后发现收益率好了一点点，过去11年的收益有7.54倍。嗯，比刚才高了一些。如果我们把这三个因子都加进去会怎样呢？\n\n收益率为5.34倍，没有刚才那么好了，还是刚才的ROA和净利润环比增长率(%)这两个因子比较好，那就保留两个吧。小编听说小市值股票收益好，如果把市值这个因子也加进去会怎么样呢？回测了一下，发现：\n\n收益居然有28倍！真的是太不可思议了。\n所以话说回来，虽然这种试错法选因子是一种比较基础的选因子方式，但其实还挺有用。经过反复试错，小编发现小市值和ROE高的股票收益比较高，回测结果显示，收益可以达到42倍之多！\n\n是不是很惊艳！你可以直接编程构建代码，也可以用我们的代码当做框架。总之，可以自己测试一下，看看收益会不会爆表。作为一篇合格的教程，我们接下来看看代码是如何实现的：\n编写代码的一些问题\n首先，财务面的数据有个问题，就是有些数据是不可获得的，这样的话对排序的影响比较大，因此涉及到一个清洗数据的步骤。一个很简单的办法就是用均值来填充，这个在Python的pandas库里面有个现成的函数，大家可以尝试使用里面的均值填充法。小编自己也写了一个填充均值的函数，大家也可以参考一下源码。\n不过随着深入的研究，可能会发现用均值填充并不是一个完美的方法。这里小编再提供一个思路，大家感兴趣可以自己实现：如果某只股票这一期的某个财务数据空缺，但是上一期没有，我们可以根据该股票这个数据与上一期的平均值比例来确定。用公式说可能更清晰点：空缺数值=本期该字段平均值*上期该字段数值/上期该字段平均值。\n其次，我们对因子的单位要做一个统一。因为有的因子绝对值好几十亿（比如市值），有的可能只有十几（收益率）甚至是负的，因此因子和因子之间很难直接赋予权重进行计算。因此，我们可以考虑使用排名的方法，对这些因子进行排名。Python自带有一个sort函数，不过为了练手起见，小编自己写了一个。用的是最简单的冒泡排序算法，高手也可以试一下堆排序或者归并排序以加快回测的速度。\n最后，我们将上述功能汇总成一个函数，集中取数据-清洗数据。\n有了以上的几个子函数，写主函数就很方便了，各位宽粉们赶紧尝试吧！\n小结\n我们这篇文章主要介绍了如何通过财务数据来构建一个多因子的策略。由于是入门向，我们构建多因子的方法比较简单，选取的因子依据是主观分析+排名。如果想定量的分析，主流的方法是做回归分析，或者对各个因子进行打分，这些将会在进阶的量化课堂中有所介绍。如果还有其他的方法，当然也欢迎尝试。\n\n本文由JoinQuant量化课堂推出，版权归JoinQuant所有，商业转载请联系我们获得授权，非商业转载请注明出处。\n\n文章更迭记录：\nv2.1，2016-07-25，修正文字，感谢 liuzehong 指出\nv2.0，2016-07-16，更新为规范源码，添加“函数说明书”\nv1.1，2016-07-04，添加“导语”\nv1.0，2016-05-21，文章上线\n策略代码与回测结果见：原文\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "8"}