{"title": "python  sftp上传(使用ssh 密钥) - zhiguo ", "index": "sftp,python", "content": "刚工作的时候写的一个代码， 现在回头看，实在不忍直视， po出来试试这个文章\n#!/usr/bin/env python  \n#sftp auto upload\n#author:zhiguo\nimport paramiko,datetime,os,time\nimport socks\nimport socket\nhostname='$ip'\nusername='yt-hunantv2'\n#password='abc123'  \nport=19321\nlocal_dir='/root/'  \nremote_dir='/' \nt_id = str(time.time())\n\n#最简单粗暴最sb的方式写日志\ndef loggs(content):\n    files = '/tmp/'+hostname+'.log'\n    f = open(files,'a')\n    f.write(content)\n    f.close()\ntry: \n    #socks.setdefaultproxy(socks.PROXY_TYPE_SOCKS5, 'proxy_ip', 3306, True)\n    #t=paramiko.Transport((hostname,port))\n    #socket.socket = socks.socksocket\n    t=paramiko.Transport((hostname,port))\n    #t.connect(username=username,password=password)\n    #k = paramiko.RSAKey.from_private_key_file(filename=key_file)\n    private_key = paramiko.RSAKey.from_private_key_file(\"/root/.ssh/id_rsa\")\n    #t.connect(username=username,password='', pkey=private_key)\n    t.connect(username=username,pkey=private_key)\n    sftp=paramiko.SFTPClient.from_transport(t)\n    #files=sftp.listdir(dir_path)          \n    #files=sftp.listdir(remote_dir)\n    #for f in files:                  \n    f=\"hunantv.ts\"\n    print ''                  \n    print '#########################################'                  \n    print 'Beginning to upload file  from %s  %s ' % (hostname,datetime.datetime.now())                \n    print 'Downloading file:',os.path.join(remote_dir,f) \n    loggs('#########################################'+'\\n')\n    a = 'tran id'+ t_id + ' : '+ 'Beginning to Uploading file  from %s  %s \\n'%(hostname,datetime.datetime.now())\n    b = 'tran id'+ t_id + ' : '+ 'Uploading file:'+os.path.join(remote_dir,f)+'file size is 1001M'+'\\n'\n    loggs(str(a))\n    loggs(str(b))\n    #sftp.get(os.path.join(remote_dir,f),os.path.join(local_dir,f))\n    fs='abc'\n    sftp.put(os.path.join(local_dir,f),os.path.join(remote_dir,f))\n    print 'Uploading file success %s ' % datetime.datetime.now()\n    print ''                  \n    print '##########################################'   \n    a = 'tran id'+ t_id + ' : '+ 'Uploading file success %s \\n' % datetime.datetime.now()\n    b = '########################################## \\n'\n    loggs(str(a))\n    loggs(str(b))\n    t.close() \nexcept Exception, e: \n       print \"connect error!\"\n       print e\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}