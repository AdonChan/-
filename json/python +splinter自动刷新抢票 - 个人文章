{"title": "python +splinter自动刷新抢票 - 个人文章 ", "index": "12306,splinter,python", "content": "一年一度的春运又来了，\n今年我自己写了个抢票脚本。\npython +splinter自动刷新抢票，可以成功抢到（依赖自己的网络环境太厉害，还有机器的好坏），\n但是感觉不是很完美，\n有大神请指导完善一下（或者有没有别的好点的思路）\n不胜感谢\n# -*- coding: utf-8 -*-\n\"\"\"\n@author: liuyw\n\"\"\"\nfrom splinter.browser import Browser\nfrom time import sleep\nimport traceback\nimport time, sys\n\n\nclass huoche(object):\n    \"\"\"docstring for huoche\"\"\"\n    driver_name=''\n    executable_path=''\n    #用户名，密码\n    username = u\"xxx@qq.com\"\n    passwd = u\"xxxx\"\n    # cookies值得自己去找, 下面两个分别是上海, 太原南\n    starts = u\"%u4E0A%u6D77%2CSHH\"\n    ends = u\"%u592A%u539F%2CTYV\"\n    # 时间格式2018-01-19\n    dtime = u\"2018-01-19\"\n    # 车次，选择第几趟，0则从上之下依次点击\n    order = 0\n    ###乘客名\n    users = [u\"xxx\",u\"xxx\"]\n    ##席位\n    xb = u\"二等座\"\n    pz=u\"成人票\"\n\n    \"\"\"网址\"\"\"\n    ticket_url = \"https://kyfw.12306.cn/otn/leftTicket/init\"\n    login_url = \"https://kyfw.12306.cn/otn/login/init\"\n    initmy_url = \"https://kyfw.12306.cn/otn/index/initMy12306\"\n    buy=\"https://kyfw.12306.cn/otn/confirmPassenger/initDc\"\n    login_url='https://kyfw.12306.cn/otn/login/init'\n    def __init__(self):\n        self.driver_name='chrome'\n        self.executable_path='/usr/local/bin/chromedriver'\n\n\n    def login(self):\n        self.driver.visit(self.login_url)\n        self.driver.fill(\"loginUserDTO.user_name\", self.username)\n        # sleep(1)\n        self.driver.fill(\"userDTO.password\", self.passwd)\n        print u\"等待验证码，自行输入...\"\n        while True:\n            if self.driver.url != self.initmy_url:\n                sleep(1)\n            else:\n                break\n\n    def start(self):\n        self.driver=Browser(driver_name=self.driver_name,executable_path=self.executable_path)\n        self.driver.driver.set_window_size(1400, 1000)\n        self.login()\n        # sleep(1)\n        self.driver.visit(self.ticket_url)\n        try:\n            print u\"购票页面开始...\"\n            # sleep(1)\n            # 加载查询信息\n            self.driver.cookies.add({\"_jc_save_fromStation\": self.starts})\n            self.driver.cookies.add({\"_jc_save_toStation\": self.ends})\n            self.driver.cookies.add({\"_jc_save_fromDate\": self.dtime})\n\n            self.driver.reload()\n\n            count=0\n            if self.order!=0:\n                while self.driver.url==self.ticket_url:\n                    self.driver.find_by_text(u\"查询\").click()\n                    count += 1\n                    print u\"循环点击查询... 第 %s 次\" % count\n                    # sleep(1)\n                    try:\n                        self.driver.find_by_text(u\"预订\")[self.order - 1].click()\n                    except Exception as e:\n                        print e\n                        print u\"还没开始预订\"\n                        continue\n            else:\n                while self.driver.url == self.ticket_url:\n                    self.driver.find_by_text(u\"查询\").click()\n                    count += 1\n                    print u\"循环点击查询... 第 %s 次\" % count\n                    # sleep(0.8)\n                    try:\n                        for i in self.driver.find_by_text(u\"预订\"):\n                            i.click()\n                            sleep(1)\n                    except Exception as e:\n                        print e\n                        print u\"还没开始预订 %s\" %count\n                        continue\n            print u\"开始预订...\"\n            # sleep(3)\n            # self.driver.reload()\n            sleep(1)\n            print u'开始选择用户...'\n            for user in self.users:\n                self.driver.find_by_text(user).last.click()\n\n            print u\"提交订单...\"\n            sleep(1)\n            # self.driver.find_by_text(self.pz).click()\n            # self.driver.find_by_id('').select(self.pz)\n            # # sleep(1)\n            # self.driver.find_by_text(self.xb).click()\n            # sleep(1)\n            self.driver.find_by_id('submitOrder_id').click()\n            # print u\"开始选座...\"\n            # self.driver.find_by_id('1D').last.click()\n            # self.driver.find_by_id('1F').last.click()\n\n            sleep(1.5)\n            print u\"确认选座...\"\n            self.driver.find_by_id('qr_submit_id').click()\n\n\n\n\n        except Exception as e:\n            print e\n\n\n\n\n\n\nif __name__ == '__main__':\n    huoche=huoche()\n    huoche.start()\n\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "3"}