{"title": "充分理解 python -m mod - 藕丝空间 ", "index": "python3.x,python", "content": "最近在看 __main__ 的官方文档 —— https://docs.python.org/3/library/__main__.html#module-__main__，提到一个 python -m 的用法，很是不理解，所以查找了很多文档，并进行了如下总结。\n查看 Python 的 help 内容\n$ python --help\n...\n-m mod : run library module as a script (terminates option list)\n#　直译就是按照脚本的方式执行模块\n...\n有无 -m 参数的比较\n1. python script.py # 直接执行脚本\n2. python -m script.py # 当做模块的方式执行，相当于 import\n一般情况下，我们会想当然的认为，有无参数 -m 对程序会有不同的影响，但是很可惜，第二种写法是会在程序执行之后报错的。其正确的写法是：丢掉 .py 后缀。\n首先直观的观察执行结果，Python 的版本是 3.6.3。编写 script.py 脚本，内容如下：\nimport sys\nprint(sys.path)\nprint(sys.modules)\n直接执行脚本\n$ python script.py\n['/home/ossifrage/workspaces/python-m', '/usr/lib/python36.zip', '/usr/lib/python3.6', ...]\n{..., '__main__': <module '__main__' from 'script.py'>, ...}\n当做模块方式执行\n$ python -m script\n['', '/usr/lib/python36.zip', '/usr/lib/python3.6', ...]\n{..., '__main__': <module 'run' from '/home/ossifrage/workspaces/python-m/script.py'>, ..., 'runpy': <module 'runpy' from '/usr/lib/python3.6/runpy.py'>, 'pkgutil': <module 'pkgutil' from '/usr/lib/python3.6/pkgutil.py'>}\n显示的内容还有很多，只突出显示出了不同的地方。\n通过比较不同的地方，我们发现:\n第一种方法——直接运行脚本，当前脚本所在的路径会加入到 sys.path 列表中，但是 sys.modules 字典中的 __main__ 的路径不是绝对路径，只是脚本名称。\n第二种方法——当做模块方式运行，当前脚本所在的路径不会加入到 sys.path 列表中，但是 sys.modules 字典中的 __main__ 的路径是绝对路径，同时，还引入了 runpy 和 pkgutil 两个模块。\nrunpy 的用途：定位并执行该模块。主要用途在于实现命令行 -m 执行 python  模块的效果。\npkgutil 的用途：获取包里面的所有模块列表。pkgutil.get_data() 可读取包内任何文件内容。\n模块的导入机制\n其实，上面的内容涉及到了 Python 包模块的导入机制。\n要理解模块的导入机制，得理解几个关键的名词。sys.path -> sys.modules -> < module >.__dict__。\nsys.path：是一个列表。保存着模块的搜索路径。如果路径没有存在与该列表中，可使用 sys.path.append() 导入。\nsys.modules: 是一个字典。所有加载到内存中的模块都存放在该字典中。当 import 一个模块的时候，首先会在这个字典中查找是否已经加载了目标模块。如果已加载，则将模块的名字加入到正在调用 import 的模块的 Local 命名空间（也就是< module >.__dict__)中。如果没有，则从 sys.path 查找，找到后载入内存，并加入到 sys.modules 字典，名称也将导入到当前模块的 Local 命名空间。\nreference\n\n[[python]自问自答：python -m参数？](https://www.cnblogs.com/xuewe...\n\nPython的-m参数\npython中的import（涉及pkgutil和inspect包）\nimport 迷宫\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "2"}