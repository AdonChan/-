{"title": "python调用python脚本时参数的传递 - 运维学习之路 ", "index": "python", "content": "前言：\n为什么有python调用python脚本呢？直接import不就行了吗？这里主要是用于远程调用时,这种调用在运维场景中是比较多的，类似下面这样的调用\n   server.py  远程调用->   agent.py\n\n这里有个问题,就是传递较多参数时,如何传递,比如传递字典,传递列表等,我们可以发现，如果直接传递，往往传过去后不能很好的解析,因为这样直接调用,agent.py在使用sys.argv解析时，获得的是列表，列表里面是字符串\n如何解决？\n解决方法就是将要传递的参数拆解成字符串,以特殊字符隔开,agen.py解析时候,再拆解回来\n实例\n1、server.py\n#-*- coding:utf8 -*- \nimport paramiko\nscript_path = '/data/test'\n\n# 需要传递的参数\narg_a = 1000           #数字\narg_b = 'anymore'      #字符串\narg_c = ['192.168.0.1','192.168.0.2','192.168.0.3'] #列表\narg_d = {'a':'5','b':'10','c':'11'}   #字典\n\n# 将数字变为字符串\narg_a = str(arg_a)\n\n# 拆解列表arg_c\narg_c_str = ','.join(arg_c)\n\n# 拆解字典arg_d\narg_d_list = []\nfor k,v in arg_d.items():\n    tmp_str = '%s:%s'%(k,v)\n    arg_d_list.append(tmp_str)\narg_d_str = ','.join(arg_d_list)\n\n# 组合传递参数\nargs = '{0}|{1}|{2}|{3}'.format(\n    arg_a,\n    arg_b,\n    arg_c_str,\n    arg_d_str\n)\n# 这里输出的内容为:\n#1000|anymore|192.168.0.1,192.168.0.2,192.168.0.3|a:5,c:11,b:10\nprint args\n\n\ncommand = 'python {0}/a.py \"{1}\"'.format(\n    script_path,\n    args\n)\ns = paramiko.SSHClient()\ns.load_system_host_keys()\ns.set_missing_host_key_policy(paramiko.AutoAddPolicy())\ns.connect('ssh host', 'ssh port', 'ssh user', 'ssh password', timeout=15)\nstdin,stdout,stderr = s.exec_command(command)\nstdout,stderr = stdout.read(),stderr.read()\n    \nprint stdout, stderr\n\n# 远程调用一般使用paramiko,这里使用commands演示\nstatus, result = commands.getstatusoutput(command)\n\n2、agent.py\n#-*- coding:utf8 -*-\n\nimport sys\n\nargs = sys.argv[1]\nargs_list = args.split('|')\n\n# 处理数字参数\narg_a = int(args_list[0])\n\n# 处理字符串参数\narg_b = str(args_list[1])\n\n# 处理列表参数\narg_c_list = args_list[2].split(',')\n\n# 处理字典参数\narg_d_list = args_list[3].split(',')\narg_d_dic = {}\nfor i in arg_d_list:\n    tmp = i.split(':')\n    arg_d_dic[tmp[0]] = tmp[1]\n\nprint arg_a\nprint arg_b\nprint arg_c_list\nprint arg_d_dic\n\n执行结果:\n\n结语\n如果有更好的方式,麻烦留言,这样在传递参数的过程中少了很多解析工作.当然这里仅作为在运维编写脚本时候常用到,也不失为一种学习字符串拆解的实际例子\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}