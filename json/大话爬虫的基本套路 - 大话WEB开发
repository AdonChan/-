{"title": "大话爬虫的基本套路 - 大话WEB开发 ", "index": "python,网页爬虫,python爬虫", "content": "\n　　\n什么是爬虫？\n网络爬虫也叫网络蜘蛛，如果把互联网比喻成一个蜘蛛网，那么蜘蛛就是在网上爬来爬去的蜘蛛，爬虫程序通过请求url地址，根据响应的内容进行解析采集数据，比如：如果响应内容是html，分析dom结构，进行dom解析、或者正则匹配，如果响应内容是xml/json数据，就可以转数据对象，然后对数据进行解析。\n\n有什么作用？\n通过有效的爬虫手段批量采集数据，可以降低人工成本，提高有效数据量，给予运营/销售的数据支撑，加快产品发展。\n\n业界的情况\n目前互联网产品竞争激烈，业界大部分都会使用爬虫技术对竞品产品的数据进行挖掘、采集、大数据分析，这是必备手段，并且很多公司都设立了爬虫工程师的岗位\n\n合法性\n爬虫是利用程序进行批量爬取网页上的公开信息，也就是前端显示的数据信息。因为信息是完全公开的，所以是合法的。其实就像浏览器一样，浏览器解析响应内容并渲染为页面，而爬虫解析响应内容采集想要的数据进行存储。\n\n反爬虫\n爬虫很难完全的制止，道高一尺魔高一丈，这是一场没有硝烟的战争，码农VS码农   反爬虫一些手段：\n\n合法检测：请求校验(useragent，referer，接口加签名，等)\n小黑屋：IP/用户限制请求频率，或者直接拦截\n投毒：反爬虫高境界可以不用拦截，拦截是一时的，投毒返回虚假数据，可以误导竞品决策\n... ...\n\n\n爬虫基本套路\n\n\n基本流程\n\n目标数据\n来源地址\n结构分析\n实现构思\n操刀编码\n\n\n\n基本手段\n\n\n破解请求限制\n\n请求头设置，如：useragant为有效客户端\n控制请求频率(根据实际情景)\nIP代理\n签名/加密参数从html/cookie/js分析\n\n\n\n破解登录授权\n请求带上用户cookie信息\n\n\n破解验证码\n简单的验证码可以使用识图读验证码第三方库\n\n\n\n\n解析数据\n\n\nHTML Dom解析\n\n正则匹配，通过的正则表达式来匹配想要爬取的数据，如：有些数据不是在html 标签里，而是在html的script 标签的js变量中\n使用第三方库解析html dom，比较喜欢类jquery的库\n\n\n\n数据字符串\n\n正则匹配(根据情景使用)\n转 JSON/XML 对象进行解析\n\n\n\n\n\n\npython爬虫\n\n\npython写爬虫的优势\n\npython语法易学，容易上手\n社区活跃，实现方案多可参考\n各种功能包丰富\n少量代码即可完成强大功能\n\n\n\n涉及模块包\n\n\n请求\n\nurllib\nurllib2\ncookielib\n\n\n\n多线程\nthreading\n\n\n正则\nre\n\n\njson解析\njson\n\n\nhtml dom解析\n\npyquery\nbeautiful soup\n\n\n\n操作浏览器\nselenium\n\n\n\n\n\n实例解析\n斗鱼主播排行\n\n\n目标数据\n获取排行榜主播信息\n\n\n来源地址\n\n\n[排行榜地址]\nhttps://www.douyu.com/directo...\n\n\n[主播房间地址]\n\nhttps://www.douyu.com/xxx\nxxx=房间号\n\n\n\n\n\n结构分析\n\n通过抓包 [排行榜地址]，[主播房间地址]   （谷歌调试network/charles/fiddler）\n\n\n获得排行数据接口：https://www.douyu.com/directo...\n\n参数确认(去掉不必要参数)\ncookie确认(去掉不必要cookie)\n模拟请求(charles/fiddler/postman)\n\n\n\n获得主播房间信息数据\n发现$ROOM是主播房间信息，在页面的script标签的js变量中，可使用正则工具写表达式去匹配\n\n\n\n\n\n实现构思\n\n通过请求 [主播排行接口] 获取 [排行榜数据]\n\n\n[排行榜数据] 中有主播房间号，可以通过拼接获得 [主播房间地址]\n\n请求 [主播房间地址] 可以获得 [$ROOM信息] ，解析可以获得主播房间信息\n\n\n操刀编码\n\n申明：此例子仅作为爬虫学习DEMO，并无其他利用\n\n基于python实现爬虫学习基础demo\ndef douyu_rank(rankName, statType):\n    '''\n        斗鱼主播排行数据抓取\n        [数据地址](https://www.douyu.com/directory/rank_list/game)\n\n        * `rankName` anchor(巨星主播榜),fans(主播粉丝榜),haoyou(土豪实力榜),user(主播壕友榜)\n        * `statType` day(日),week(周),month(月)\n    '''\n    if not isinstance(rankName, ERankName):\n        raise Exception(\"rankName 类型错误，必须是ERankName枚举\")\n    if not isinstance(statType, EStatType):\n        raise Exception(\"statType 类型错误，必须是EStatType枚举\")\n\n    rankName = '%sListData' % rankName.name\n    statType = '%sListData' % statType.name\n    # 请求获取html源码 \n    rs = rq.get(\n        \"https://www.douyu.com/directory/rank_list/game\",\n        headers={'User-Agent': 'Mozilla/5.0'})\n    # 正则解析出数据\n    mt = re.search(r'rankListData\\s+?=(.*?);', rs, re.S)\n    if (not mt):\n        print u\"无法解析rankListData数据\"\n        return\n    grps = mt.groups()\n    # 数据转json\n    rankListDataStr = grps[0]\n    rankListData = json.loads(rankListDataStr)\n    dayList = rankListData[rankName][statType]\n    # 修改排序\n    dayList.sort(key=lambda k: (k.get('id', 0)), reverse=False)\n    return dayList\n\n\ndef douyu_room(romm_id):\n    '''\n        主播房间信息解析\n        [数据地址](https://www.douyu.com/xxx)\n        'romm_id' 主播房号\n    '''\n    rs = rq.get(\n        (\"https://www.douyu.com/%s\" % romm_id),\n        headers={'User-Agent': 'Mozilla/5.0'})\n    mt = re.search(r'\\$ROOM\\s+?=\\s+?({.*?});', rs, re.S)\n    if (not mt):\n        print u\"无法解析ROOM数据\"\n        return\n    grps = mt.groups()\n    roomDataStr = grps[0]\n    roomData = json.loads(roomDataStr)\n    return roomData\n    \ndef run():\n    '''\n        测试爬虫\n    '''\n    datas = douyu_rank(ERankName.anchor, EStatType.month)\n    print '\\r\\n主播排行榜：'\n    for item in datas:\n        room_id = item['room_id']\n        roomData = douyu_room(room_id)\n        rommName = None\n        if roomData is not None:\n            rommName = roomData['room_name']\n        roomInfo = (u'房间(%s):%s' % (item['room_id'], rommName))\n        print item['id'], item[\n            'nickname'], roomInfo, '[' + item['catagory'] + ']'\n\n\nrun()\n\n\n运行结果：\n\n主播排行榜：\n\n无法解析ROOM数据\n1 冯提莫 房间(71017):今晚来 [英雄联盟]\n2 阿冷aleng丶 房间(2371789):又是我最喜欢的阿冷ktv时间～ [英雄联盟]\n3 胜哥002 房间(414818):胜哥：南通的雨下的我好心累。 [DNF]\n4 White55开解说 房间(138286):卢本伟五五开 每天都要很强 [英雄联盟]\n5 东北大鹌鹑 房间(96291):东北大鹌鹑 宇宙第一寒冰 相声艺术家！ [英雄联盟]\n6 老实敦厚的笑笑 房间(154537):德云色 给兄弟们赔个不是 [英雄联盟]\n7 刘飞儿faye 房间(265438):刘飞儿  月底吃鸡 大吉大利 [绝地求生]\n8 pigff 房间(24422):【PIGFF】借基地直播，没OW [守望先锋]\n9 云彩上的翅膀 房间(28101):翅：还是抽天空套刺激！ [DNF]\n10 yyfyyf 房间(58428):无尽的9月，杀 [DOTA2]\n\n\nDemo源码地址\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "4"}