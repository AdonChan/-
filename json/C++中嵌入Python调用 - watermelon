{"title": "C++中嵌入Python调用 - watermelon ", "index": "内嵌python,python,c++", "content": "python嵌入到C++中\n\n把python嵌入的C++里面需要做一些步骤\n\n\n安装python程序，这样才能使用python的头文件和库\n在我们写的源文件中增加“Python.h”头文件，并且链入“python**.lib”库（还没搞清楚这个库时静态库还是导出库，需要搞清楚）\n掌握和了解一些python的C语言api，以便在我们的c++程序中使用\n\n常用的一些C API函数\n\n在了解下面的函数之前有必要了解一下**PyObject***指针，python里面几乎所有的对象都是使用这个指针来指示的。\n\nPy_Initialize（）&&Py_Finalize（）\n\n\n  在调用任何python的c函数之前需要调用的函数，“Py_Initialize”是用来初始化python模块的，推测是加载初始化加载dll的。对应的在使用python模块之后用“Py_Finalize”来释放模块。\n\n\nPyImport_ImportModule（）\n\n\n  用来载入一个python模块，这个模块就是一般的python文件。这里需要注意的是，在加载这个模块的时候会执行模块里面所有可以执行的语句。包括import导入语句和在函数体之外的所有语句\n\n\nPyObject_GetAttrString（）\n\n\n  返回模块里面的函数\n\n\nPy_BuildValue（）\n\n\n  建立一个参数元组，一般都是用这个函数来建立元组，然后将这个元组作为参数传递给python里面的函数。\n\n\nPyEval_CallObject（）\n\n\n  调用函数，并把“Py_BuildValue”建立的元组作为参数传递给被调用的函数\n\n\n源码实例\n\n下面的实例是在c++代码中调用Python的函数，传递参数并且获取返回值\n\ntest.cpp代码\n\n#include <iostream>\n#include <Python.h>\nusing namespace std;\n\nint main(int argc, char* argv[])\n{\n    Py_Initialize();   //初始化\n\n    PyObject* pModule = NULL;\n    PyObject* pFunc = NULL;\n    PyObject* pParam = NULL;\n    PyObject* pResult = NULL;\n    const char* pBuffer = NULL;\n    int iBufferSize = 0;\n\n    pModule = PyImport_ImportModule(“test_python\");\n\n    if (!pModule)\n    {\n        cout << \"get module failed!\" << endl;\n        exit (0);\n    }\n\n    pFunc = PyObject_GetAttrString(pModule, \"main\");\n    if (!pFunc)\n    {\n        cout << \"get func failed!\" << endl;\n        cout << int(pFunc) << endl;\n        exit (0);\n    }\n    pParam = Py_BuildValue(\"(s)\", \"HEHEHE\");\n    pResult = PyEval_CallObject(pFunc,pParam);\n    if(pResult)\n    {\n        if(PyArg_Parse(pResult, \"(si)\", &pBuffer, iBufferSize))\n        {\n            cout << pBuffer << endl;\n            cout << iBufferSize << endl;\n        }\n    }\n    Py_DECREF(pParam);\n    Py_DECREF(pFunc);\n\n    Py_Finalize();\n    //cout << \"hello\" << endl;\n    return 0;\n}\n\n\ntest_python.py代码\n\ndef main(szString):\n    return (\"hello\", 5)\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "5"}