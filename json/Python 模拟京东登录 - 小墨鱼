{"title": "Python 模拟京东登录 - 小墨鱼 ", "index": "python,python3.5,京东,登录,requests", "content": "Python模拟京东登录\n分析登录的网络请求\n打开https://passport.jd.com/new/login.aspx，打开浏览器的调试面板，然后，输入账号密码 =>> 登录，然后看调试面板上面的Network捕捉到的网络请求，如下图：\n\n\n根据上面的图片，我们可以知道，在我们点击完登录按钮之后，浏览器发送了一个POST请求到https://passport.jd.com/uc/loginService，然后在请求头上面带上了一些基本的参数，最重要的有三个，一个是cookie，一个是Referer，还有一个是User-Agent。不要问我为何重要，我只是知道登录需要带上-_-||然后，再看看请求所需要的参数，这里面有两部分，一个是Query Params：\nuuid:6a9ddda4-1819-4819-a888-b59301f83a59\nReturnUrl：https://item.jd.com/5089239.html\nr: 0.2520828231526894\nversion: 2015\n另一个是Form Data：\nuuid:6a9ddda4-1819-4819-a888-b59301f83a59\neid:F37T4YRBOPZZ6JSEGDA7WH2VCIETQY…J23JGCTD3IM4TMK44Y5ATOTO6G4SM\nfp:87783198d64a9aa25b3f0b28b152b094\n_t:_t\nloginType:f\nloginname:test@qq.com\nnloginpwd:P+TbkVGbhhhC4DFlZ7y4az8j/Y1QYw…h0qs8+bKp7UbHeGWF1KEMrQUG5po=\nchkRememberMe:    \nauthcode:\npubKey: MIGfMA0GCSqGSIb3DQEBAQUAA4GNAD…woanQq+CA6agNkqly2H4j6wIDAQAB\nsa_token: B68C442BE645754F33277E70120805…8EF504D2CD67D7341B8BFBA47FFA5\n上面的参数里面，基本可以在页面上面可以找到\n\n其中：ReturnUrl是登录成功后返回的页面，authcode是图片验证码，本例子上面不需要输入验证码。\nPython实现\n根据上面的分析我们只需要通过代码发送一个post请求，并且带上相对应的参数就可以实现登录了。所有的参数，我们都可以轻而易举地获取，唯一的困难是cookie，但是，Python的requests库给我们提供了会话机制，也就是requests.Session(),因此，具体的实现过程可以如代码所示\n完整代码\n# -*- coding: UTF-8 -*-\nimport json\nimport requests\nimport sys\n\nfrom bs4 import BeautifulSoup\n\ns = requests.Session()\n\n\nclass JD:\n    def __init__(self, username, password):\n        self.username = username\n        self.password = password\n        self.headers = {\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0',\n            'Referer': 'https://www.jd.com/'\n        }\n\n    def get_login_data(self):\n        url = 'https://passport.jd.com/new/login.aspx'\n        html = s.get(url, headers=self.headers).content\n        soup = BeautifulSoup(html, 'lxml')\n        display = soup.select('#o-authcode')[0].get('style')\n        auth_code = ''\n        if not display:\n            print('需要验证码。。。')\n            auth_code_url = soup.select('#JD_Verification1')[0].get('src2')\n            auth_code = self.get_auth_img(auth_code_url)\n        uuid = soup.select('#uuid')[0].get('value')\n        eid = soup.select('#eid')[0].get('value')\n        fp = soup.select('input[name=\"fp\"]')[0].get('value')  # session id\n        _t = soup.select('input[name=\"_t\"]')[0].get('value')  # token\n        login_type = soup.select('input[name=\"loginType\"]')[0].get('value')\n        pub_key = soup.select('input[name=\"pubKey\"]')[0].get('value')\n        sa_token = soup.select('input[name=\"sa_token\"]')[0].get('value')\n\n        data = {\n            'uuid': uuid,\n            'eid': eid,\n            'fp': fp,\n            '_t': _t,\n            'loginType': login_type,\n            'loginname': self.username,\n            'nloginpwd': self.password,\n            'chkRememberMe': True,\n            'authcode': '',\n            'pubKey': pub_key,\n            'sa_token': sa_token,\n            'authCode': auth_code\n        }\n        return data\n\n    def get_auth_img(self, url):\n        auth_code_url = 'http:' + url\n        auth_img = s.get(auth_code_url, headers=self.headers)\n        with open(sys.path[0] + '/auth.jpg', 'wb') as f:\n            f.write(auth_img.content)\n        code = input('请输入验证码：')\n        return code\n\n    def login(self):\n        \"\"\"\n        登录\n        :return:\n        \"\"\"\n        url = 'https://passport.jd.com/uc/loginService'\n        data = self.get_login_data()\n        headers = {\n            'Referer': 'https://passport.jd.com/uc/login?ltype=logout',\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0',\n            'X-Requested-With': 'XMLHttpRequest'\n        }\n        content = s.post(url, data=data, headers=headers).text\n        result = json.loads(content[1: -1])\n        return result\n\n    def rush(self):\n        print('功能正在赶来的路上，敬请期待。。。')\n        pass\n\n\ndef handle():\n    print(\"*************** 菜单列表 **************\")\n    print('1、抢购')\n    print('2、加入购物车')\n    num = input('请输入功能编号：')\n    if num == '1':\n        print('抢购功能正在赶来的路上，敬请期待。。。')\n    else:\n        print('加入购物车功能正在赶来的路上，敬请期待。。。')\n        # print('加入购物车成功！！！')\n    pass\n\n\nusername = input('请输入京东账号：')\npassword = input('请输入京东密码：')\njd = JD(username, password)\nresult = jd.login()\nif result.get('success'):\n    print('登录成功')\n    handle()\nelse:\n    print('登录失败')\n\n项目地址： 模拟京东登录\n吐槽QQ群： 173318043\n\n                ", "mainLikeNum": ["3 "], "mainBookmarkNum": "6"}