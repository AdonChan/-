{"title": "使用Python实现一个简单的图片上传存储服务 - Hello World ", "index": "pillow,flask,python", "content": "GitHub地址: https://github.com/honmaple/maple-file\n使用flask实现的一个简单的图片上传服务\n\n设计初衷\n对于图片的存储,有很多选择,一般采用云服务如(七牛,又拍等),但是国内的服务像七牛自定义域名竟然需要域名备案(Excuse me,当初就是因为备案麻烦才选择国外的),而且浪费了我十块钱,\n而我又想像七牛一样可以直接在本地就可以上传图片,找来找去，没有找到一个比较合适的，所以花两天时间自己写了一个\n\n使用\n由于初衷是本地脚本就可以发布,所以没有前端界面,等以后有时间了再加上\n\nAPI\n\n\n/api/login\n\nPOST\n登录\n\n\n\n/api/logout\n\nGET\n注销\n\n\n\n/api/albums\n\nGET获取相册列表\n\nPOST新建相册\n\nname 相册名称\ndescription 相册描述\n\n\n\n\n\n/api/albums/<int:pk>\npk 相册ID\n\nGET获取相册信息\n\nPUT修改相册信息\n\nname 相册名称\ndescription 相册描述\n\n\nDELETE删除相册\n\n\n\n/api/images\n\nGET获取图片列表\n\nPOST上传图片\n\nimages 上传图片列表\nalbum 相册ID(默认会新建一个default相册)\n\n\n\n\n\n/api/images/<int:pk>\n\nGET获取图片信息\n\nPUT修改图片信息\n\nname 图片名称\ndescription 图片描述\n\n\nDELETE删除图片\n\n\n\n\n配置\nclass Config(object):\n    DEBUG = True # 生产环境设置为False\n    SECRET_KEY = 'ccc' # import os;os.urandom(24)\n    SECRET_KEY_SALT = 'ssss'\n    JSON_AS_ASCII = False\n\n    PERMANENT_SESSION_LIFETIME = timedelta(days=3)\n\n    PER_PAGE = 10 # 分页\n    ADMIN_URL = '/admin/aaaaa' # 后台地址\n\n    LOGIN_TOKEN_HEADER = 'Api-Key' # 将会影响到后面headers设置\n    LOGIN_TOKEN = 'api_key' #url?api_key=21312313\n\n    MIDDLEWARE = ['storage.common.middleware.CommonMiddleware']\n\n    SQLALCHEMY_TRACK_MODIFICATIONS = False\n    SQLALCHEMY_DATABASE_URI = 'sqlite:///test.db'\n    # SQLALCHEMY_ECHO = DEBUG\n    UPLOAD_ALLOWED_EXTENSIONS = set(['png', 'jpg', 'jpeg']) # 允许上传的扩展名\n    UPLOAD_FOLDER_ROOT = os.path.dirname(os.path.abspath(__file__))\n    UPLOAD_FOLDER_PATH = 'images' # 相对于当前文件路径的地址\n    UPLOAD_FOLDER = os.path.join(UPLOAD_FOLDER_ROOT, UPLOAD_FOLDER_PATH)\n\n\n创建账户\npython manager.py create_user\n\n将同时创建一个default的相册\npython manager.py key\n\n显示用户key\n\n上传\n上传后图片保存路径\n\n\n原图路径:\nUPLOAD_FOLDER + 'username' + 'photo' + %Y + %m + (时间戳+随机数).png\n\n\n\n缩略图路径:\nUPLOAD_FOLDER + 'username' + 'thumb' + %Y + %m + (时间戳+随机数).png\n\n\n\n\nexample\n使用requests本地上传\nimport requests\n\ndef images():\n    url = 'http://127.0.0.1:8000/api/images'\n    files = {'images': open('desktop.png', 'rb')}\n    multiple_files = [\n        ('images', ('11.png', open('11.png', 'rb'), 'image/png')),\n        ('images', ('desktop.png', open('desktop.png', 'rb'), 'image/png'))\n    ]\n    headers = {\n        'Api-Key':\n        'InhpeWFuZzA4MDdJBtx4AWlPpI_Oxx1Ki8',\n        'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36'\n    }\n    # r = requests.post(url, files=multiple_files, headers=headers)\n    r = requests.post(url, files=files, headers=headers)\n    print(r.text)\n\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "8"}