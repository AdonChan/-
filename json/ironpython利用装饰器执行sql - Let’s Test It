{"title": "ironpython利用装饰器执行sql - Let’s Test It ", "index": "sqlserver,decorator,python,ironpython", "content": "比较喜欢python的装饰器, 试了下一种用法，通过装饰器来传递sql，并执行返回结果\n这个应用应该比较少\n为了方便起见，直接使用了ironpython, 连接的mssql server\n\n# -*- coding: utf-8 -*-\nimport clr\nclr.AddReference('System.Data')\nfrom System.Data import *\nfrom functools import wraps\n\nconn_str = \"server=localhost;database=DB_TEST;uid=sa;password=sa2008\"\n\ndef mssql(sql):\n    def handler_result(rs):\n        rst = []\n        while rs.Read():\n            rst.Add(rs[0])\n        return rst\n\n\n    def decorator(fn):\n        @wraps(fn)\n        def wrapper(*args, **kwargs):\n            TheConnection = SqlClient.SqlConnection(conn_str)\n            TheConnection.Open()\n            try:\n                MyAction = SqlClient.SqlCommand(sql, TheConnection)\n                MyReader = MyAction.ExecuteReader()\n            except Exception,ex:\n                raise AssertionError(ex)\n            rst_data = handler_result(MyReader)\n            kwargs[\"sql_rst\"] = rst_data\n            result = fn(*args, **kwargs)\n            MyReader.Close()\n            TheConnection.Close()\n            return result\n        return wrapper\n    return decorator\n\n\n\n@mssql(sql=\"Select getdate()\")\ndef get_data(sql_rst=\"\"):\n    print sql_rst[0]\n\nget_data()\n\n\n算是为了好玩吧，回看了下，可能实际用的机会不多\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}