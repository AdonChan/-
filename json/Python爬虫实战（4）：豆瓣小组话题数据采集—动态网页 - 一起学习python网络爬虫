{"title": "Python爬虫实战（4）：豆瓣小组话题数据采集—动态网页 - 一起学习python网络爬虫 ", "index": "数据采集,编程语言,网络爬虫,python", "content": "\n1， 引言\n注释：上一篇《Python爬虫实战（3）：安居客房产经纪人信息采集》，访问的网页是静态网页，有朋友模仿那个实战来采集动态加载豆瓣小组的网页，结果不成功。本篇是针对动态网页的数据采集编程实战。\nPython开源网络爬虫项目启动之初，我们就把网络爬虫分成两类：即时爬虫和收割式网络爬虫。为了适应各种应用场景，GooSeeker的整个网络爬虫产品线包含了四类产品，如下图所示：\n本实战是上图中的“独立python爬虫”的一个实例，以采集豆瓣小组讨论话题(https://www.douban.com/group/haixiuzu/discussion?start=0 )信息为例，记录整个采集流程，包括python和依赖库的安装，即便是python初学者，也可以跟着文章内容成功地完成运行。\n2，Python和相关依赖库的安装\n运行环境：Windows10\n2.1，安装Python3.5.2\n\n官网下载链接: https://www.python.org/ftp/python/3.5.2/python-3.5.2.exe\n下载完成后，双击安装。\n这个版本会自动安装pip和setuptools，方便安装其它的库\n\n2.2，Lxml 3.6.0\n\nLxml官网地址: http://lxml.de/\nWindows版安装包下载: http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml\n对应windows下python3.5的安装文件为 lxml-3.6.0-cp35-cp35m-win32.whl\n下载完成后，在windows下打开一个命令窗口,，切换到刚下载的whl文件的存放目录，运行pip install lxml-3.6.0-cp35-cp35m-win32.whl\n\n2.3，下载网页内容提取器程序\n网页内容提取器程序是GooSeeker为开源Python即时网络爬虫项目发布的一个类，使用这个类，可以大大减少数据采集规则的调试时间，具体参看《Python即时网络爬虫项目: 内容提取器的定义》\n\n下载地址: https://github.com/FullerHua/gooseeker/blob/master/core/gooseeker.py\n把gooseeker.py保存在项目目录下\n\n2.4，安装selenium\npip install selenium\n2.5，PhantomJS下载\n\n下载地址 http://phantomjs.org/download.html\n把下载得到的phantomjs-2.1.1-windows.zip解压到本机的某个文件夹下\n把解压后的文件夹中的phantomjs.exe的完整路径加文件名记录下来，用来替换下面代码的 browser = webdriver.PhantomJS(executable_path='C:\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe') 这一行中的两个单引号之间的内容。\n\n3，网络爬虫的源代码\n# _*_coding:utf8_*_\n# douban.py\n# 爬取豆瓣小组讨论话题\n\nfrom urllib import request\nfrom lxml import etree\nfrom gooseeker import GsExtractor\nfrom selenium import webdriver\n\nclass PhantomSpider:\n    def getContent(self, url):\n        browser = webdriver.PhantomJS(executable_path='C:\\\\phantomjs-2.1.1-windows\\\\bin\\\\phantomjs.exe')\n        browser.get(url)\n        time.sleep(3)\n        html = browser.execute_script(\"return document.documentElement.outerHTML\")\n        output = etree.HTML(html)\n        return output\n\n    def saveContent(self, filepath, content):\n        file_obj = open(filepath, 'w', encoding='UTF-8')\n        file_obj.write(content)\n        file_obj.close()\n\ndoubanExtra = GsExtractor()   \n# 下面这句调用gooseeker的api来设置xslt抓取规则\n# 第一个参数是app key，请到GooSeeker会员中心申请\n# 第二个参数是规则名，是通过GooSeeker的图形化工具: 谋数台MS 来生成的\ndoubanExtra.setXsltFromAPI(\"ffd5273e213036d812ea298922e2627b\" , \"豆瓣小组讨论话题\")  \n\nurl = \"https://www.douban.com/group/haixiuzu/discussion?start=\"\ntotalpages = 5\ndoubanSpider = PhantomSpider()\nprint(\"爬取开始\")\n\nfor pagenumber in range(1 , totalpages):\n    currenturl = url + str((pagenumber-1)*25)\n    print(\"正在爬取\", currenturl)\n    content = doubanSpider.getContent(currenturl)\n    outputxml = doubanExtra.extract(content)\n    outputfile = \"result\" + str(pagenumber) +\".xml\"\n    doubanSpider.saveContent(outputfile , str(outputxml))\n\nprint(\"爬取结束\")\n运行过程如下:\n\n将上面的代码保存到douban.py中，和前面2.3步下载的提取器类gooseeker.py放在同一个文件夹中\n打开Windows CMD窗口，切换当前目录到存放douban.py的路径(cd xxxxxxx)\n运行 python douban.py\n\n请注意：为了让源代码更整洁，也为了让爬虫程序更有通用性，抓取规则是通过api注入到内容提取器bbsExtra中的，这样还有另外一个好处：如果目标网页结构变化了，只需通过MS谋数台重新编辑抓取规则，而本例的网络爬虫代码不用修改。为内容提取器下载采集规则的方法参看《Python即时网络爬虫：API说明—下载内容提取器》。\n4，爬虫结果\n在项目目录下可以看到多个result**.xml文件，文件内容如下图所示：\n5，总结\n因为信息采集规则是通过api下载下来的，所以，本案例的源代码显得十分简洁。同时，整个程序框架变得很通用，因为最影响通用性的采集规则是从外部注入的。\n6，集搜客GooSeeker开源代码下载源\nGooSeeker开源Python即时网络爬虫GitHub源\n7，文档修改历史\n2016-07-15：V1.0\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "22"}