{"title": "scrapy简单学习6—爬取百度贴吧图片（仿写向） - 个人编程学习 ", "index": "python,scrapy", "content": "主要是对上一篇文章的简单仿写，大家以后想批量下载什么图片照格式仿写就好。由于本人是tfboys的粉丝，所以平常没事爱逛贴吧欣赏我家三小只的美图，所以这次就以贴吧[小王的讨论楼]为例，批量爬取该楼的图片[1]\nitme.py编写\nimport scrapy\n\n\nclass WangyuantuItem(scrapy.Item):\n    image_urls=scrapy.Field()#就编写个图片路径就好\nspider的编写\nimport scrapy\nimport requests\nimport os\nfrom wangyuantu.items import WangyuantuItem\n\nclass XiaowangSpider(scrapy.Spider):\n    name = \"xiaowang\"\n    allowed_domains = [\"tieba.baidu.com/p/3888309273\"]\n    start_urls = [\n        'http://tieba.baidu.com/p/3888309273?pn=%d' % i for i in range(21,45)\n        ]\n    \n    \n\n    def parse(self, response):\n        item = WangyuantuItem()\n        item['image_urls']=response.xpath(\"//img[@class='BDE_Image']/@src\").extract()\n        \n        yield item\npipelines编写：这个部分都是可以套用的\nimport requests\nfrom wangyuantu import settings\nimport os\n\n#图片下载类\nclass ImageDownloadPipeline(object):\n    def process_item(self, item, spider):\n        if 'image_urls' in item:#如何‘图片地址’在项目中\n            images = []#定义图片空集\n            \n            dir_path = '%s/%s' % (settings.IMAGES_STORE, spider.name)\n\n            if not os.path.exists(dir_path):\n                os.makedirs(dir_path)\n            for image_url in item['image_urls']:\n                us = image_url.split('/')[3:]\n                image_file_name = '_'.join(us)\n                file_path = '%s/%s' % (dir_path, image_file_name)\n                images.append(file_path)\n                if os.path.exists(file_path):\n                    continue\n\n                with open(file_path, 'wb') as handle:\n                    response = requests.get(image_url, stream=True)\n                    for block in response.iter_content(1024):\n                        if not block:\n                            break\nsettings编写\nBOT_NAME = 'wangyuantu'\n\nSPIDER_MODULES = ['wangyuantu.spiders']\nNEWSPIDER_MODULE = 'wangyuantu.spiders'\n\nITEM_PIPELINES = {'wangyuantu.pipelines.ImageDownloadPipeline': 1}\n#图片储存\nIMAGES_STORE = 'C:\\Users\\Lenovo\\Pictures'\n结果\n\n寄语：wili源源小可爱，希望你快快乐乐的长大\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}