{"title": "使用Python与图灵机器人聊天 - 学习笔记 ", "index": "api,聊天机器人,python", "content": "图灵机器人对中文的识别准确率高达90%，是目前中文语境下智能度最高的机器人。有很多在Python中使用图灵机器人API的博客，但都是1.0版本。所以今天简单地总结一下在Python中使用图灵机器人API v2.0的方法。\n获取API KEY\n首先，前往图灵机器人官方网站 http://www.tuling123.com/ 注册账号。\n登录后点击 创建机器人 ，填写一些简单的基本信息之后即可创建。\n\n在机器人设置界面找到你的 API KEY ，记录下来。\n\n在Python中使用图灵机器人API v2.0\n基本原理就是使用urllib.request模块，向接口地址发送HTTP POST请求，请求中加入了聊天内容。\n*使用python3执行\nimport json\nimport urllib.request\n\napi_url = \"http://openapi.tuling123.com/openapi/api/v2\"\ntext_input = input('我：')\n\nreq = {\n    \"perception\":\n    {\n        \"inputText\":\n        {\n            \"text\": text_input\n        },\n\n        \"selfInfo\":\n        {\n            \"location\":\n            {\n                \"city\": \"上海\",\n                \"province\": \"上海\",\n                \"street\": \"文汇路\"\n            }\n        }\n    },\n\n    \"userInfo\": \n    {\n        \"apiKey\": \"请替换为你的API KEY\",\n        \"userId\": \"OnlyUseAlphabet\"\n    }\n}\n# print(req)\n# 将字典格式的req编码为utf8\nreq = json.dumps(req).encode('utf8')\n# print(req)\n\nhttp_post = urllib.request.Request(api_url, data=req, headers={'content-type': 'application/json'})\nresponse = urllib.request.urlopen(http_post)\nresponse_str = response.read().decode('utf8')\n# print(response_str)\nresponse_dic = json.loads(response_str)\n# print(response_dic)\n\nintent_code = response_dic['intent']['code']\nresults_text = response_dic['results'][0]['values']['text']\nprint('Turing的回答：')\nprint('code：' + str(intent_code))\nprint('text：' + results_text)\n\n* 几点说明：\n1、字典 req 包含了向图灵机器人发出请求所需的各项信息。其中 req['perception']['selfInfo']['location'] 包含了地理位置信息，向图灵机器人发送与位置有关的请求时，如果没有另外指定位置，则会默认使用这个位置。例如询问\"明天会下雨吗\"，图灵机器人会回答我\"上海\"明天是否下雨。\n2、req['userInfo']  包含了API KEY，请替换成你的API KEY（双引号不要删除）。另外 userId 是用户参数，暂时不明白用途，如果你有什么想法恳请留言。\n3、图灵机器人的回答可以转换为python的字典格式。其中有一项 response_dic['intent']['code'] 官方称为\"输出功能code\"，表示这个回答是什么\"类型\"的。例如10004代表普通的聊天回复，10008代表与天气相关的回复。然而奇怪的是，目前API v2.0的官方文档并没有给出code和类型的对照表。目前自己总结了一些如下，欢迎补充：\n\n\ncode\n类型\n\n\n\n10004\n聊天\n\n\n10008\n天气\n\n\n10013\n科普类，例如\"班戟是什么\"\n\n\n10015\n菜谱类，例如\"剁椒鱼头怎么做\"\n\n\n10019\n日期类，例如\"愚人节是几号\"、\"明天是星期几\"\n\n\n10020\n中英翻译\n\n\n10023\n一般返回网页会是这个code，例如\"iphone多少钱\"\n\n\n10034\n语料库中自己设定的回答\n\n\n\n小结\n到现在为止，已经快把每个独立的模块完成了，接下来该准备考虑如何把它们整合在一起了。希望能帮到你。\n感谢你阅读文章！\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "1"}