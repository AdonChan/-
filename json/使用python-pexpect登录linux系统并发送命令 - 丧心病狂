{"title": "使用python-pexpect登录linux系统并发送命令 - 丧心病狂 ", "index": "python", "content": "#!/usr/bin/python\n# -*- coding: utf-8 -*-\n# filename: pexpect_test.py\n\nimport pexpect,time,sys\ndef sendCommt():\n    demo = open(\"result.txt\", \"ab\")\n    demo.write('==========Log Tile: demo==========\\n')\n    print user\n    child = pexpect.spawn('ssh %s@%s' % (user,ip))\n    while True:\n        i = child.expect(patterns)\n        if i == CONTINUES:\n            child.sendline(flag)\n        elif i == PASSWD:\n            child.sendline(passwd)\n        elif i == OPFLAG:\n            break\n    for cmd in cmds:\n        time.sleep(2)\n        p = pexpect.spawn(cmd)\n        p.logfile = demo\n        p.write('=====================\\n')\n        p.expect(pexpect.EOF)\n        print cmd\n    demo.close()\n    child.close()\n\nif __name__ == '__main__':\n    user = 'demo'\n    ip = 'x.x.x.x'\n    passwd = '1'\n    cmds = ['ps','ls','pwd','ifconfig','date']\n    patterns = ['Are you sure you want to continue connecting (yes/no)?','[Pp]assword:','#']\n    CONTINUES,PASSWD,OPFLAG = range(len(patterns))\n    flag = 'yes'\n    group = '1'\n    try:\n        sendCommt()\n    except pexpect.TIMEOUT:  \n        print \"TIMEOUT\" \n    except pexpect.EOF:\n        print \"EOF\"\n\n参考文档：http://www.ibm.com/developerworks/cn/lin...\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}