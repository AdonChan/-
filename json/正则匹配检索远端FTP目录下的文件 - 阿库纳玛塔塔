{"title": "正则匹配检索远端FTP目录下的文件 - 阿库纳玛塔塔 ", "index": "ftp,python", "content": "遇到一个问题，需要正则匹配远端FTP目录下的文件，如果使用ftp客户端可以通过命令行很容易的做到这一点，但是暂时没有一个工具支持这样的需求，于是通过python对FTP的支持和对正则表达式的支持，写了这么一个简单的工具，用于使用正则表达式来匹配远端目录的文件。\n代码如下\n\n# coding=utf-8\n#########################################################################\n# File Name: reg_url.py\n# Author: WangWeilong\n# Company: Baidu\n#########################################################################\n\nimport re\nimport sys\nimport os\nfrom ftplib import FTP\n\ndhccmd = \"http://xxx/api/submit\"\n\nclass DHC_FTP():\n    def __init__(self, hostname, username=\"\", passwd=\"\"):\n        self.hostname = hostname\n        try:\n            self.ftp = FTP(self.hostname)\n        except:\n            print \"hostname error!\"\n            exit(-1)\n        self.username = username\n        self.passwd = passwd\n        self.filelist = []\n        self.reg_pattern = \"\"\n\n    def getftpfilelist(self, path):\n        self.ftp.login(self.username, self.passwd)\n        self.ftp.cwd(path)\n        self.filelist = self.ftp.nlst()\n\n    def matchnames(self, regpattern):\n        pattern = re.compile(regpattern)\n        matchedfiles = []\n        for file in self.filelist:\n            match = pattern.search(file)\n            if match:\n                matchedfiles.append(match.string)\n        return matchedfiles\n\n\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 4:\n        print 'usage:python reg_url.py $ftpurldir $regular'\n    else:\n        #解析ftpurl字符串\n        head = sys.argv[1].split(\"@\")[1].split(\"/\")[0]\n        username = sys.argv[1].split(\"//\")[1].split(\":\")[0]\n        passwd = sys.argv[1].split(\"//\")[1].split(\":\")[1].split(\"@\")[0]\n        pathdir = sys.argv[1].split(head)[1]\n\n        dhc_ftp = DHC_FTP(head, username, passwd)\n        dhc_ftp.getftpfilelist(\"./\" + pathdir)\n\n        #获取正则表达式\n        regpattern = r'%s' % sys.argv[2]\n\n        matchedfiles = dhc_ftp.matchnames(regpattern)\n        for files in matchedfiles:\n            ftpname = sys.argv[1] + \"/\" + files\n            print ftpname\n\n\n\n\n通过输入想要的检索的远端目录地址和想要用来匹配的正则表达式，就能获取到远端的文件了，至于用这些文件来干嘛，那就是需求问题了。\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "0"}