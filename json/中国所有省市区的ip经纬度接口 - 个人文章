{"title": "中国所有省市区的ip经纬度接口 - 个人文章 ", "index": "python", "content": "由于个人需要国内所有省市区的ip地址段和经纬度的对应关系，最好是数据库可以直接使用的数据源，经调研发现可以使用百度API来实现这个功能，主要是找到所有的ip地址段然后调用api 查询，\n主要是用Tornado 做异步爬虫来实现的，\nimport time\nimport json\nfrom datetime import timedelta\nfrom bs4 import BeautifulSoup\nimport os\nfrom tornado import httpclient, gen, ioloop, queues\nfrom api import map_ip_region_provice\n\nAK = \"umG08TkpEwmRWkUPx4MaM0FGW3h4i4L\"  # 你可以使用百度开发者账号申请\nbase_url = 'http://api.map.baidu.com/location/ip?ak={1}&ip={0}'\nIP_URL = 'https://github.com/17mon/china_ip_list/blob/master/china_ip_list.txt'\n\nconcurrency = 20  # 并发数\n\n\ndef is_file_exist(result=None):\n    if result:\n        result = result\n    else:\n        result = []\n    with open('iplist.txt', 'w+') as ipfile:\n        for i in result:\n            ipfile.write(i)\n            ipfile.write('\\n')\n    return result\n\n\ndef get_iplist():\n    \"\"\"\n    从github 下载ip 段\n    \"\"\"\n    # check ip is exist， 节约时间\n    result = list()\n    flag = is_file_exist()\n    if flag:\n        return flag\n    else:\n        http_client = httpclient.HTTPClient()\n        try:\n            response = http_client.fetch(IP_URL)\n            respone = response.body\n        except httpclient.HTTPError as e:\n            print(\"Error: \" + str(e))\n        except Exception as e:\n            # Other errors are possible, such as IOError.\n            print(\"Error: \" + str(e))\n        http_client.close()\n        respone = BeautifulSoup(respone, 'lxml')\n        div = respone.find('table',\n                           attrs={'class',\n                                  'highlight tab-size js-file-line-container'})\n        trs = div.find_all('td', attrs={'class': 'blob-code blob-code-inner js-file-line'})\n        for tr in trs:\n            temp = tr.string\n            result.append(temp)\n        print('fetch ip .....')\n        is_file_exist(result)\n具体可以查看\nhttps://fizblog.cn/blog?title...\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}