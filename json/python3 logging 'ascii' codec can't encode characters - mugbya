{"title": "python3 logging 'ascii' codec can't encode characters - mugbya ", "index": "python,python3.x,logging,encoding", "content": "环境：mac 10.12  python3  django 1.10\n\n问题发现\n最近刚从arch 换到 mac下搬砖， 发现在arch跑的好好的代码，在mac下 终端老是报错 .... 还是编码错误...\ncode:\ntry:\n    int('sdfasdf')\nexcept Exception as e:\n    logger.error( (u' 注册失败 ' + str(e)) )\n    return render(request, 'user/register.html')\n        \nerror:\n--- Logging error ---\nTraceback (most recent call last):\n  File \"../repository/apps/user/views.py\", line 104, in post\n    int('sdfasdf')\nValueError: invalid literal for int() with base 10: 'sdfasdf'\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/Cellar/python3/3.5.2_3/Frameworks/Python.framework/Versions/3.5/lib/python3.5/logging/__init__.py\", line 983, in emit\n    stream.write(msg)\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 91-94: ordinal not in range(128)   \n\n\n坦白说，看到这个错误好无奈。既然能在Linux跑，换到mac就出错，那多半是环境问题了，然后我就开始了我的调试追踪之旅了\n跟踪调试\n先前调试都是一晃而过，只看结果。 然并软，并没有什么用，后面耐着性子单独调试\n首先从错误点开始：\n/usr/local/Cellar/python3/3.5.2_3/Frameworks/Python.framework/Versions/3.5/lib/python3.5/logging/__init__.py      line: 982\n\n发现这里出现ASCII编码，感觉拿到钥匙了~~\n然后顺藤摸瓜，去看了 这个 stream 的初始化，发现标准的stderr 读写都是 encoding='utf-8',\n但是读写日志文件就指定了 ASCII编码。\n解决\n知道了原因，就好解决了，google 一圈未果，马丹，竟然百度一下就知道怎么写(应该是歪果仁都不会有这个问题吧)\n在 LOGGING 的 handlers 中配置编码就行了\n    'debug': {\n        'level': 'DEBUG',\n        'class': 'logging.handlers.RotatingFileHandler',\n        'filename': 'log/debug.log',\n        'maxBytes': 1024 * 1024 * 5,\n        'backupCount': 5,\n        'formatter': 'standard',\n        \"encoding\": \"utf8\"\n    },\n\n参考链接：每个 Python 程序员都要知道的日志实践\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "4"}