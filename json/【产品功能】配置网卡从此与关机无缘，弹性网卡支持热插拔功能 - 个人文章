{"title": "【产品功能】配置网卡从此与关机无缘，弹性网卡支持热插拔功能 - 个人文章 ", "index": "python", "content": "摘要： 本文主要介绍了弹性网卡的热插拨功能改进，弹性网卡插拔对应的实例不再要求必须为 Stopped 状态，现在只要求是稳定状态( Running Stopped )即可。以及介绍了控制台、OpenAPI如何对弹性网卡进行热插拔操作。\n背景\n在云计算飞速发展的今天，用户ECS服务器身处的网络环境越来越复杂，弹性网卡让ECS服务器完美游走在日益复杂的网络环境中。但是以前服务器必须是Stopped状态才可以进行弹性网卡(ENI)的插拔，这样可能会影响运行在服务器上的业务。现在很高兴的向大家宣布：弹性网卡从今天开始支持热插拨，即ECS服务器只要处在稳定状态(Running Stopped)，就可以对弹性网卡进行插拔操作。\n弹性网卡热插拔：控制台\n控制台操作弹性网卡的位置：进入控制台 -> 云服务器 ECS -> 弹性网卡。创建弹性网卡：点击创建弹性网卡按钮，在弹窗中填写网卡名称，选择专有网络 交换机 安全组等信息后创建弹性网卡。热挂载弹性网卡：点击弹性网卡对应的绑定实例按钮，在弹窗中选择要绑定实例。实例状态只要求为稳定状态(Running Stopped)。热卸载弹性网卡：点击弹性网卡对应的解绑实例按钮，确定即可解绑。实例状态只要求为稳定状态(Running Stopped)。弹性网卡热插拔：OpenAPIattach_eni detach_eni 分别可以根据弹性网卡ID，实例ID，进行弹性网卡的热插拔。相关API参考帮助文档：挂载弹性网卡，卸载弹性网卡。\n#  coding=utf-8\n\n# if the python sdk is not install using 'sudo pip install aliyun-python-sdk-ecs'\n# if the python sdk is install using 'sudo pip install --upgrade aliyun-python-sdk-ecs'\n# make sure the sdk version is 4.7.1, you can use command 'pip show aliyun-python-sdk-ecs' to check\n\nimport json\nimport logging\n\nfrom aliyunsdkcore import client\nfrom aliyunsdkecs.request.v20140526.CreateNetworkInterfaceRequest import CreateNetworkInterfaceRequest\nfrom aliyunsdkecs.request.v20140526.AttachNetworkInterfaceRequest import AttachNetworkInterfaceRequest\nfrom aliyunsdkecs.request.v20140526.DetachNetworkInterfaceRequest import DetachNetworkInterfaceRequest\nfrom aliyunsdkecs.request.v20140526.DeleteNetworkInterfaceRequest import DeleteNetworkInterfaceRequest\n\n# configuration the log output formatter, if you want to save the output to file,\n# append \",filename='ecs_invoke.log'\" after datefmt.\n\nlogging.basicConfig(level=logging.INFO,\n                    format='%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s',\n                    datefmt='%a, %d %b %Y %H:%M:%S')\n\n\n# send open api request\ndef _send_request(request):\n    request.set_accept_format('json')\n    try:\n        response_str = clt.do_action(request)\n        logging.info(response_str)\n        response_detail = json.loads(response_str)\n        return response_detail\n    except Exception as e:\n        logging.error(e)\n\n\n# create eni\ndef create_eni(vSwitchId, securityGroupId, networkInterfaceName=None, primaryIpAddress=None, description=None,\n               clientToken=None):\n    request = CreateNetworkInterfaceRequest()\n    request.set_VSwitchId(vSwitchId)\n    request.set_SecurityGroupId(securityGroupId)\n    if (networkInterfaceName != None):\n        request.set_NetworkInterfaceName(networkInterfaceName)\n    if (primaryIpAddress != None):\n        request.set_PrimaryIpAddress(primaryIpAddress)\n    if (description != None):\n        request.set_Description(description)\n    if (clientToken != None):\n        request.set_ClientToken(clientToken)\n    _send_request(request)\n\n\n# attach eni to instance\ndef attach_eni(eniId, instanceId):\n    request = AttachNetworkInterfaceRequest()\n    request.set_NetworkInterfaceId(eniId)\n    request.set_InstanceId(instanceId)\n    _send_request(request)\n\n\n# detach eni from instance\ndef detach_eni(eniId, instanceId):\n    request = DetachNetworkInterfaceRequest()\n    request.set_NetworkInterfaceId(eniId)\n    request.set_InstanceId(instanceId)\n    _send_request(request)\n\n\n# delete eni\ndef delete_eni(eniId):\n    request = DeleteNetworkInterfaceRequest()\n    request.set_NetworkInterfaceId(eniId)\n    _send_request(request)\n\n\nif __name__ == '__main__':\n    clt = client.AcsClient('Your Access Key Id', 'Your Access Key Secrect', 'cn-zhangjiakou')\n    vSwitchId = \"vsw-test\"\n    securityGroupId = \"sg-test\"\n    # create_eni(vSwitchId=vSwitchId, securityGroupId=securityGroupId)\n\n    attach_eniId = \"eni-test\"\n    attach_instanceId = \"i-test\"\n    # attach_eni(attach_eniId, attach_instanceId)\n\n    detach_eniId = \"eni-test\"\n    detach_instanceId = \"i-test\"\n    # detach_eni(detach_eniId, detach_instanceId)\n\n    delete_eniId = \"eni-test\"\n    # delete_eni(delete_eniId)\n\n小结\n现在的弹性网卡热插拔只要求实例为稳定状态即可，改进了以前实例只能为Stopped状态才能插拔弹性网卡的现状。提升了用户体验，现在服务器不用关机就能轻松配置弹性网卡，更加灵活实用。\n原文链接\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}