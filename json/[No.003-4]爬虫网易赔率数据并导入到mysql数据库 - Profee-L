{"title": "[No.003-4]爬虫网易赔率数据并导入到mysql数据库 - Profee-L ", "index": "python", "content": "收集比赛结果\n\n#encoding:utf-8\nimport sys\nimport urllib2\nimport re\nfrom bs4 import BeautifulSoup\nimport MySQLdb as mdb\n\nreload(sys)\nsys.setdefaultencoding('utf-8')\nsoup = BeautifulSoup(open(\"20140830\"))\n\n\n#1.场次 \n#先获得temp（包含None和其他信息的队列）\nscr = []\ntemp =[]\nfor trs in soup.findAll(\"tr\"):\n    for tds in trs.findAll(\"td\",{\"width\":\"50\"}):\n        temp.append(tds.string)\n\nlt = len(temp)/4\nfor i in range(lt):\n    scr.append(temp[4*i+3])\n\n\n\n#2.赛事类型\nleague = []\nfor item in soup.findAll(\"tr\"):\n    for item1 in item.findAll(\"td\",{\"width\":\"70\"}):\n        league.append(item1.string.encode('utf-8'))\n\n#3.比赛日期\ntemp = []\ngmdate = []\nfor item in soup.findAll(\"tr\"):\n    for item1 in item.findAll(\"td\",{\"width\":\"61\"}):\n        temp.append(item1)\n\n#删除无效的前3个数据\ntemp =temp[3:]\nfor item in temp:\n    gmdate.append(re.search(\"\\w{4}-\\w{2}-\\w{2}\",str(item)).group())\n\n\n\n\n#4.主队，客队\nteam=[]\nfor item in soup.findAll(\"tr\"):\n    for teams in item.findAll(\"a\",{\"class\":\"dui\"}):\n        team.append(teams.string.strip().encode('utf-8'))\n\n#5.胜平负赔率\nspfpl =[]\ntemp = []\nfor trs in soup.findAll(\"tr\"):\n    for tds in trs.findAll(\"span\"):\n        temp.append(tds.string)\n\n#删除首尾两个无效数据\ntemp =temp[1:-1]\nfor i in range(len(temp)):\n    for item in temp[7*i+4:7*i+7]:\n        spfpl.append(item)\n\n#6.比分结果以及比分结果赔率\nbfjg = []\ntemp = []\nfor trs in soup.findAll(\"tr\"):\n    for item in trs.findAll(\"div\",{\"align\":\"center\"}):\n        for item1 in item.findAll(\"strong\"):\n            bfjg.append(item1.string.encode('utf-8'))\n\n#7.形成场次日期唯一id\nids=[]\nfor i in range(len(scr)):\n    ids.append(gmdate[i]+'-'+scr[i])\n\n\n#装配结果集\nres =[]\nfor i in range(len(scr)):\n    res.append(ids[i])\n    res.append(scr[i])\n    res.append(league[i])\n    res.append(gmdate[i])\n    res.append(team[2*i])\n    res.append(team[2*i+1])\n    res.append(spfpl[3*i])\n    res.append(spfpl[3*i+1])\n    res.append(spfpl[3*i+2])\n    res.append(bfjg[2*i])\n    res.append(bfjg[2*i+1])\n\n\n\n\n#更新数据库内容\nconn=mdb.connect(host='localhost',user='root',passwd='oracle',db='betdb',port=3306)\ncur = conn.cursor()\nSQL=\"insert into results(id,lea,gmd,hos,gue,win,dog,los,res,odd) values(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)\"\nl =len(res)/10\nfor i in range(l):\n    for item in res[10*i:10*i+1]:\n        cur.execute(SQL,res[10*i:10*i+10])\n        i+=1\n\n\n#更新胜平负\nsql_update3=\"update results set spf=3 where res='1:0' or res='2:0' or res='2:1' or res='3:0' or res='3:1' or res='3:2' or res='4:0' or res='4:1' or res='4:2' or res='5:0' or res='5:1' or res='5:2' or res='胜其他';\"\n\nsql_update1=\"update results set spf=1 where res='0:0' or res='1:1' or res='2:2' or res='3:3' or res='平其他';\"\n\nsql_update0=\"update results set spf=0 where res='0:1' or res='0:2' or res='1:2' or res='0:3' or res='1:3' or res='2:3' or res='0:4' or res='1:4' or res='2:4' or res='0:5' or res='1:5' or res='2:5' or res='负其他';\"\n\ncur.execute(sql_update3)\ncur.execute(sql_update1)\ncur.execute(sql_update0)\n\n#更新总进球\nsql_updatezjq0=\"update results set zjq=0 where res='0:0'\"\nsql_updatezjq1=\"update results set zjq=1 where res='1:0' or res='0:1'\"\nsql_updatezjq2=\"update results set zjq=2 where res='2:0' or res='0:1' or res='1:1' or res='0:2'\"\nsql_updatezjq3=\"update results set zjq=3 where res='3:0' or res='2:1' or res='1:2' or res='0:3'\"\nsql_updatezjq4=\"update results set zjq=4 where res='4:0' or res='3:1' or res='2:2' or res='1:3' or res='0:4'\"\nsql_updatezjq5=\"update results set zjq=5 where res='5:0' or res='4:1' or res='3:2' or res='2:3' or res='0:5' or res='1:4'\"\nsql_updatezjq6=\"update results set zjq=6 where res='5:1' or res='3:3' or res='4:2' or res='2:4' or res='1:5'\"\nsql_updatezjq7=\"update results set zjq=7 where res='胜其他' or res='负其他'\"\n\ncur.execute(sql_updatezjq0)\ncur.execute(sql_updatezjq1)\ncur.execute(sql_updatezjq2)\ncur.execute(sql_updatezjq3)\ncur.execute(sql_updatezjq4)\ncur.execute(sql_updatezjq5)\ncur.execute(sql_updatezjq6)\ncur.execute(sql_updatezjq7)\n\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}