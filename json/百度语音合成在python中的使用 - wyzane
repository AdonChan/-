{"title": "百度语音合成在python中的使用 - wyzane ", "index": "语音合成,python", "content": "今天来说一下在python中如何使用百度的语音合成功能；即输入一段文字，请求百度相关服务器后，会返回来一段二进制语音流，将这段二进制数据经过base64编码返回给前端，前端解码后，可以播放出这段语音；也可以将这段二进制语音流保存到一个wav文件中。\n使用百度的语音合成，首先需要在百度的ai开放平台上注册。\n具体代码如下:\nimport asyncio\nfrom aiohttp import ClientSession\n\ndef get_baidu_voice(text, baidu_voice_token):\n    content_audio = {\n        'tex': text,\n        'tok': baidu_voice_token,\n        'cuid': 'default',\n        'ctp': '1',\n        'lan': 'zh',\n        'per': '4',\n\n    }\n    \n    speech_url = 'https://tsn.baidu.com/text2audio?'\n    headers = {\n        # 'Content-Type': 'audio/mp3'\n        'Content-Type': 'application/json'\n    }\n    async with ClientSession() as session:\n        async with session.post(url=speech_url, data=content_audio,\n                                headers=headers) as res:\n            ret = await res.content.read()\n            try:\n                # 将bytes类型转换为str类型\n                ret_str = str(ret, encoding=\"utf-8\")\n            except Exception as e:\n                # 正常返回\n                self.speech = base64.b64encode(ret)\n            else:\n                # 异常返回\n                ret_dict = json.loads(ret_str)\n                if ret_dict[\"err_no\"] == 502:\n                    raise RuntimeError(\"access token expired, please check\")\n                elif ret_dict[\"err_no\"] == 501:\n                    raise RuntimeError(\"the input arguments is incorrect, please check\")\n                elif ret_dict[\"err_no\"] == 503:\n                    raise RuntimeError(\"合成后端出错\")\n                elif ret_dict[\"err_no\"] == 500:\n                    raise RuntimeError(\"unsupport input\")\n需要传入两个参数，分别是：需要转换成语音的文本和百度的语音token。\n百度语音token的获取方式如下:\ndef get_baidu_voice_token():\n    # client_id 为官网获取的AK， client_secret 为官网获取的SK\n    host = 'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id='+ client_id + '&client_secret=' + client_secret\n    request = urllib.request.Request(host)\n    request.add_header('Content-Type', 'application/json; charset=UTF-8')\n    response = urllib.request.urlopen(request)\n    content_bytes = response.read()\n    content_dict = json.loads(str(content_bytes, encoding=\"utf-8\"))\n    if content_dict:\n        # 28天过期\n        return content_dict[\"access_token\"]\n注意，token是有有效期的，需要定时获取新的token。\n以上就是百度语音合成的调用，如有错误，欢迎交流指正！\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}