{"title": "基于docker+gunicorn部署sanic项目 - 个人文章 ", "index": "docker,gunicorn,python3.x,python", "content": "基于docker+gunicorn部署sanic项目\n源代码: https://github.com/ltoddy/Python-useful/tree/master/sanic-app\n最近云服务提供商在打价格战,我在滴滴云上花了很少的钱租了一个月的云服务器:公网ip是： 116.85.42.182, 以下我以116.85.42.182这个ip为演示,当你自己在部署的时候请换乘自己的ip地址.\n买完服务器之后,你会得到一个公网ip,你可以通过ssh命令连接上你的服务器.\nssh dc2-user@116.85.42.182\n顺便提一句,滴滴云给你创建的账户叫\"dc2-user\",你需要自己设置root的密码.\n\n然后安装docker:\nsudo apt-get install docker.io\n演示一个最小的sanic-app,来部署一下.\n这是项目树(目录).\n.\n├── app.py\n├── Dockerfile\n└── templates\n    └── index.html\n\n1 directory, 3 files\napp.py\nimport os\n\nfrom sanic import Sanic\nfrom sanic.response import html\nfrom sanic.response import HTTPResponse\nfrom jinja2 import Environment, FileSystemLoader\n\napp = Sanic(__name__)\nbase_dir = os.path.abspath(os.path.dirname(__name__))\ntemplates_dir = os.path.join(base_dir, 'templates')\njinja_env = Environment(loader=FileSystemLoader(templates_dir), autoescape=True)\n\n\ndef render_template(template_name: str, **context) -> str:\n    template = jinja_env.get_template(template_name)\n    return template.render(**context)\n\n\n@app.route('/')\nasync def index(request) -> HTTPResponse:\n    return html(render_template('index.html'))\n这里的python代码,用到了sanic框架和jinja2木板引擎,所以带会需要安装这两个依赖.\nDockerfile\nFROM taoliu/gunicorn3\n\nWORKDIR /code\n\nADD . /code\n\nRUN pip install sanic \\\n    && pip install jinja2\n\nEXPOSE 8080\n\nCMD gunicorn app:app --bind 0.0.0.0:8080 --worker-class sanic.worker.GunicornWorker\n第一行那里\"FROM taoliu/gunicorn3\",由于没找到合适的Python3的gunicorn的基础镜像,所以我自己做了一个,方便所有人使用.\nRUN pip install sanic  && pip install jinja2 这里,来安装那两个依赖.\nCMD gunicorn app:app --bind 0.0.0.0:8080 --worker-class sanic.worker.GunicornWorker 这行,是镜像运行他所以执行的命令.\ntemplates/index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>ltoddy's home</title>\n    <link rel=\"stylesheet\" href=\"https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.css\">\n</head>\n<body>\n<div class=\"container\">\n    <div class=\"page-header\">\n        <h1>Welcome</h1>\n    </div>\n</div>\n</body>\n</html>\n然后把这些文件传到服务器上:\nscp -r * dc2-user@116.85.42.182:~\n\n然后ssh连上我们的服务器,去构建我们的docker镜像(这个过程有些漫长,具体看网速.)\ndocker build -t sanic-demo .\n\ndocker images\n来查看一下当前拥有的镜像\n\n然后后台运行docker镜像:\ndocker run -d --restart=always -p 5000:8080 sanic-demo:latest\n\n这时候打开浏览器输入: 116.85.42.182:5000 来看看效果吧.\n最后说明一点,去滴滴云那里的防火墙规则那里,添加5000端口的规则.\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}