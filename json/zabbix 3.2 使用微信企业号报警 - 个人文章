{"title": "zabbix 3.2 使用微信企业号报警 - 个人文章 ", "index": "zabbix,微信,运维,python", "content": "各位看官，我是orange小菜，初来扎道，不足之处还请指教，sharing make happy ！！！\n1.我先把我的代码甩出来，供大家参考一下，挺丑的，别介意哦！\n#!/usr/bin/python\n\nimport requests \nimport sys\nimport json\n\nuserID=sys.argv[1]\nsubject=sys.argv[2]\ncontent=sys.argv[3]\n\ncorpid='CorpID'  #此处为权限管理中每个组的ID,其实说就一个ID，全部相同的\ncorpsecret=\"CortSecret\"#此处为权限管理中的密码，其实严格来说是来区分其他组的ID\n\nclass WeiXin(object):\n#初始化变量 \ndef  __init__(self,corpid,corpsecret):\nself.corpid=corpid\nself.corpsecret=corpsecret\n#获取token的值\ndef get_token(self):\n\nurl='https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid='+\\\nself.corpid+'&corpsecret='+self.corpsecret\nget_data=requests.request(\"GET\",url)\nget_token=get_data.json()\ntoken=get_token.get('access_token')\nreturn token\n#发送data，也就是推送到用户 \ndef send_data(self,user,subject,content):\naccess_token=self.get_token()\nurl='https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token='+\\\naccess_token\nsend_data={\n\"touser\": user,  #这是指的是通信录中不同组的用户，当发送的用户在组中无法找到，            \n 默认会向所有用户发送\n\"toparty\": 3,    #这里指的是通信录中的组ID，\n\"msgtype\": \"text\",\n\"agentid\": 3,    #这里指的是应用，也就是消息管理，那些人可以收到本组信息那些不可以\n\"text\": {\n\"content\": '{0}{1}{2}'.format(subject,content,user)\n},\n\"safe\": 0\n}\ndata=json.dumps(send_data,ensure_ascii=False)\nret=requests.post(url,data=data)\nprint ret.json()\n\nif '__main__'==__name__:\nUser=WeiXin(corpid,corpsecret)\nUser.send_data(userID,subject,content)\n\n2.曾经走过的坑\n （a） 权限问题，和两个地方有关系，第一与应用中心的某个应用的可见范围有关系；第二和设置里面功能设置中的权限管理有关。\n\n （b）微信的使用问题，第一要建个通信录，找到正确的组ID，第二，应用中心agentid的创建并使用，第三，设置中分组要创建；\n\n\n\n坑，解决掉就是路，解决不了还是坑。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}