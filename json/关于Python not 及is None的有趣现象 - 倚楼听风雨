{"title": "关于Python not 及is None的有趣现象 - 倚楼听风雨 ", "index": "session,flask,python", "content": "最近碰到一个问题,就是查看flask SessionInterface相关源码的时候。比如我想整合redis作为flask session的存储。参考：http://flask.pocoo.org/snippe...此处代码中发现以下代码片段特别困惑：\n def save_session(self, app, session, response):\n        domain = self.get_cookie_domain(app)\n        if not session:\n            self.redis.delete(self.prefix + session.sid)\n            if session.modified:\n                response.delete_cookie(app.session_cookie_name,\n                                       domain=domain)\n            return\n后来我又查看了flask的SecureSessionInterface，也是类似这样的。\nif not session:\n            self.redis.delete(self.prefix + session.sid)\n            if session.modified:\n                response.delete_cookie(app.session_cookie_name,\n                                       domain=domain)\n            return\nif not session 然后又在里面调用session.sid。想了半天没想通，但是心里又想官方代码片段肯定不会太马虎的，一定有其道理。\n题外话：于是鲁主开启了第一次stactoverflow提问之旅。(以前都是只在上面寻找答案，无奈这次没找到，可能是问题太过幼稚了吧。尴尬，没关系，大胆承认自己是菜鸟就ok了。)问题链接：http://stackoverflow.com/ques...还真有牛人为我解答了。感觉还是很兴奋的。\n问题的来源在于这里的session对象对应的类继承了dict，代码如下：\nclass RedisSession(CallbackDict, SessionMixin):\n\n    def __init__(self, initial=None, sid=None, new=False):\n        def on_update(self):\n            self.modified = True\n        CallbackDict.__init__(self, initial, on_update)\n        self.sid = sid\n        self.new = new\n        self.modified = False\n而当dict为空的时候,比如if not {}: 这个时候条件判断是出于True的状态。但是这个session还有其他的非dict属性，如sid，还是可以正常访问的。\n写个简单的例子：\nclass AA(dict):\n    def __init__(self,name):\n        self.name=name\n        super(AA,self).__init__()\na=AA('aa')\nif not a:\n    print('not a')\n    print(a.name)\nif a is None:\n    print('a is None')\n\n运行之后输出：not aaa\n总之dict为空时，not dict就是True，但并不代表该dict对象没有定义。也并不代表对象没有其他属性。它只是代表该session对象作为dict时为空。仅此而已。如果要看对象是否定义，就一定要使用 is None来判断。\n那么还剩一个问题？既然RedisSession(CallbackDict, SessionMixin),那么它既是CallbackDict的子类，not 空dict时返回True ,那么not 定义好的SessionMixin对象应该是False那么如何取舍呢？具体实现原理不知道，猜想可能是 True or False这样形式在内部返回判断结果的。\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}