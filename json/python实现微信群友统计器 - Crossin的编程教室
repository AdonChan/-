{"title": "python实现微信群友统计器 - Crossin的编程教室 ", "index": "python", "content": "基于微信可以做很多有意思的练手项目，看了这张速查表你就会发现，可以做的事情超过你的想象。\n\n有一次我想要统计微信群里哪些同学在北京，但发现直接问是很难得到准确结果的……\n\n这时候不如运用 wxpy 这个库抓取所有群友的地区信息，很快就可以得到想要的结果，甚至还精确到了区。\n\n下面来分享一下这个微信群友统计器的实现思路，你可以基于它去拓展更多实用功能。\n实现思路\n解决复杂问题最好的办法就是把问题简单化，拆解成若干个小问题，然后逐个击破。问题的拆解思路如下：\n\n▍1. 如何通过 wxpy 库找到指定微信群？\n使用 bot.groups() 方法找出最近聊天的微信群\n\n使用 wxpy 提供的 bot.groups().search('群名')[0] 方法找到指定微信群\n\n▍2. 如何获取到指定微信群的全部群成员？\n对微信群对象使用 .members 获得微信群的全部群成员\n\n▍3. 如何获取到群成员的省份跟城市的信息？\n对获取到的微信群的全部群成员，使用 for 循环一个一个的用 .province 和 .city 获取省份跟城市信息\n\n然后进行统计，即可获得各地区的人数。\n统计器源码\n只需要修改倒数第5行，改成你要查询的微信群，然后就可以使用了。\n\n\nfrom wxpy import *\n\nbot = Bot()\n\ndef get_members(group_name):\n    print(bot.groups().search(group_name)[0])\n    group = bot.groups().search(group_name)[0]\n    #使用此方法用来更新群聊成员的详细信息 (地区、性别、签名等)\n    group.update_group(True)\n    #获取该群聊组的全部成员对象\n    members = group.members\n    return members\n\ndef clean_members(members):\n    #用来存放群聊里出现的全部的省份跟城市的信息\n    member_clean = []\n    for member in members:\n        #.province跟.city分别获取群成员对象的省份跟城市\n        member_info = member.province + member.city\n        #可能有的成员没有设置自己的地区跟城市，获取到的member_info可能为空\n        member_info_clean = member_info.replace(' ', '')\n        if not member_info_clean == '':\n            member_clean.append(member_info_clean)\n    return member_clean\n\ndef result(member_clean):\n    member_dict = {}\n    for m in member_clean:\n        #统计某个省份跟地区在member_clean列表里面的人数\n        if member_clean.count(m):\n            member_dict[m] = member_clean.count(m)\n            #把member_clean列表里，向member_dict字典里添加过的省份地区删除掉\n            member_clean = [value for value in member_clean if value != m]\n    return member_dict\n\n#改成想要统计的群聊名字，很久没有聊天记录的群最好先发条消息\ngroup_n = '实用主义第三期入门训练营'\nmembers = get_members(group_n)\nmember_clean = clean_members(members)\nmember_dict = result(member_clean)\nprint(member_dict)\n\n\n速查表下载\n这张速查表涵盖了 wxpy 文档中的所有功能，可以对照着方便索引。\n\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "0"}