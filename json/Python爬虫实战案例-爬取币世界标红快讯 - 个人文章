{"title": "Python爬虫实战案例-爬取币世界标红快讯 - 个人文章 ", "index": "python", "content": "爬取币世界标红快讯内容(移动版)\n# 引入依赖\nfrom lxml import etree\nimport requests\nimport pymongo\nimport time\nclient = pymongo.MongoClient('写你自己的数据库地址', 27017) # 需要自己安装mongodb客户端\nmydb = client['mydb']\ninformation = mydb['information'] # 数据库表名\ncurrentTime = time.strftime(\"%m%d%H\", time.localtime())\nsaveTime = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.localtime())\n\n# 伪造成手机\nheader = {\n    'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1'\n}\n\ndef get_url(url):\n    html = requests.get(url, headers=header)\n    selector = etree.HTML(html.text)\n    infos = selector.xpath('//div[@id=\"kuaixun_list\"]/div/article/section[@class=\"focus\"]')\n    onlyOne = selector.xpath('//div[@id=\"kuaixun_list\"]/div/article/section[@class=\"focus\"]')[0]\n    saveId = onlyOne.xpath('../@id')[0]\n    file = open(r'C:/Users/SCZ/PycharmProjects/CommunityCrawl/newest', 'w') # 写你自己的文件地址\n    file.write(currentTime +' '+saveId)\n    file.close()\n    for info in infos:\n        try:\n            title = (info.xpath('h3[@class=\"text_title\"]/text()')[0]).strip()\n            content = (info.xpath('p[@class=\"text_show\"]/text()')[0]).strip()\n            date = info.xpath('../h3[@class=\"timenode\"]/text()')[0]\n            infoId = info.xpath('../@id')[0]\n\n            data = {\n                'title': title,\n                'id': infoId,\n                'date': saveTime,\n                'content': content,\n                'source': 'bishijie'\n            }\n\n            print(data)\n\n            if (int(infoId) > int(saveId) - 20):\n                print('插入了一条新数据!')\n                information.insert_one(data)\n            else:\n                print('无新数据产生!')\n\n        except IndexError:\n            pass\n\nif __name__ == '__main__':\n    fs = open('C:/Users/SCZ/PycharmProjects/CommunityCrawl/newest', 'r+') # 写你自己的文件地址\n    line = fs.read()\n    fileDate = line[0:6]\n\n    if (fileDate != currentTime):\n        print('时间不一致,宕机使用当前系统时间进行爬取!')\n        urls = ['http://m.bishijie.com/kuaixun?fm=' + currentTime]\n        for url in urls:\n            get_url(url)\n            time.sleep(2)\n    else:\n        print('时间一致, 正常运行!')\n        urls = ['http://m.bishijie.com/kuaixun?fm=' + currentTime]\n        for url in urls:\n            get_url(url)\n            time.sleep(2)\n            \n主要要求掌握内容: xpath语法，python操作文件，python的基础语法\n本文内容比较基础，写的不好，多多指教！大家一起进步！！！\n我的其他关于python的文章\nPython爬虫入门\nPython爬虫之使用MongoDB存储数据\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}