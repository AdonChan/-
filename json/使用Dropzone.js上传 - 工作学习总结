{"title": "使用Dropzone.js上传 - 工作学习总结 ", "index": "php,python,javascript", "content": "原创【个人网站欢迎访问】说明：后台用的python的flask框架，后台对你理解这篇文章没什么影响，你可以使用php\nform作为上传区\n引入Dropzone.js和dropzone.css然后使用表单form定义一个class=\"dropzone\"即可完成\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>Flask upload with Dropzone example</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='dropzone.css') }}\" type=\"text/css\" />\n    <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n    <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n</head>\n<body>\n<!-- 第一种上传 -->        \n    <form id =\"myAwesomeDropzone\" action=\"{{ url_for('upload_file') }}\" class=\"dropzone\" method=\"POST\" enctype=\"multipart/form-data\"></form>\n<!-- 第一种上传 -->  \n</body>\n</html>\n效果\n\ndiv作为上传区\ndiv作为上传区也很简单\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>Flask upload with Dropzone example</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='dropzone.css') }}\" type=\"text/css\" />\n    <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n    <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n</head>\n\n<body>\n<div id=\"myId\" class=\"dropzone\" style=\"width: 800px; height: 300px;\">点我上传</div>\n<script type=\"text/javascript\">\n        //下面两行是js和jquery的方式实现绑定div的例子，你选择一种即可\n        //var myDropzone = new Dropzone(\"#myId\", { url: \"{{ url_for('upload_file') }}\" });\n        $(\"#myId\").dropzone({ url: \"{{ url_for('upload_file') }}\" });\n     </script>\n     \n</body>\n</html>\n\n效果\n\nform作为上传区配置\n配置也分为两种，如果使用的form表单上传的就用如下方式配置\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>Flask upload with Dropzone example</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='dropzone.css') }}\" type=\"text/css\" />\n    <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n    <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n</head>\n\n<body>\n    <form id =\"myAwesomeDropzone\" action=\"{{ url_for('upload_file') }}\" class=\"dropzone\" method=\"POST\" enctype=\"multipart/form-data\">        \n       <div class=\"fallback\">\n            <input name=\"file\" type=\"file\" multiple />\n        </div> \n    </form>\n<script type=\"text/javascript\">\n//两种配置方式，第一种，表单上传时的配置方式，可以打开form表单的注释，myAwesomeDropzone是表单的id\n    Dropzone.options.myAwesomeDropzone = {\n          paramName: \"file\", // The name that will be used to transfer the file\n          maxFilesize: 2, // MB\n          accept: function(file, done) {\n            if (file.name != \"justinbieber.jpg\") {\n                  done(\"Naha, you don't.\");\n            }else { \n                done();\n            }\n        }\n      };\n</script>\n     \n</body>\n</html>\n效果\n\ndiv作为上传区配置\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>Flask upload with Dropzone example</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='dropzone.css') }}\" type=\"text/css\" />\n    <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n    <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n</head>\n\n<body>\n <div id=\"myId\" class=\"dropzone\" style=\"width: 800px; height: 300px;\">点我上传</div>\n<script type=\"text/javascript\">\n        //第二种配置，这种使用的是div做上传区域时使用的配置\n        Dropzone.autoDiscover = false;//不知道该行有什么用，欢迎高手下方评论解答\n        $(\"#myId\").dropzone({ \n        url: \"{{ url_for('upload_file') }}\",\n        addRemoveLinks: true,        \n        method: 'post',\n        filesizeBase: 1024        \n        });\n\n</script>\n     \n</body>\n</html>\n说明：关于其他的配置请看最后的链接\n主题\n第一种\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset==\"utf-8\">\n\n  <!-- Latest compiled and minified CSS -->\n  <link rel=\"stylesheet\" href=\"http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\n\n  <!-- Optional theme -->\n  <link rel=\"stylesheet\" href=\"http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css\">\n  <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n  <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n  <script>\n    Dropzone.autoDiscover = false;\n  </script>\n\n  <style>\n    html, body {\n      height: 100%;\n    }\n    #actions {\n      margin: 2em 0;\n    }\n\n\n    /* Mimic table appearance */\n    div.table {\n      display: table;\n    }\n    div.table .file-row {\n      display: table-row;\n    }\n    div.table .file-row > div {\n      display: table-cell;\n      vertical-align: top;\n      border-top: 1px solid #ddd;\n      padding: 8px;\n    }\n    div.table .file-row:nth-child(odd) {\n      background: #f9f9f9;\n    }\n\n\n\n    /* The total progress gets shown by event listeners */\n    #total-progress {\n      opacity: 0;\n      transition: opacity 0.3s linear;\n    }\n\n    /* Hide the progress bar when finished */\n    #previews .file-row.dz-success .progress {\n      opacity: 0;\n      transition: opacity 0.3s linear;\n    }\n\n    /* Hide the delete button initially */\n    #previews .file-row .delete {\n      display: none;\n    }\n\n    /* Hide the start and cancel buttons and show the delete button */\n\n    #previews .file-row.dz-success .start,\n    #previews .file-row.dz-success .cancel {\n      display: none;\n    }\n    #previews .file-row.dz-success .delete {\n      display: block;\n    }\n\n\n  </style>\n\n</head>\n<body>\n  \n  <div class=\"container\" id=\"container\">\n    <h2 class=\"lead\">Configuration Demo</h2>\n    <div id=\"actions\" class=\"row\">\n\n      <div class=\"col-lg-7\">\n        <!-- 控制总体的三个按钮 -->\n        <span class=\"btn btn-success fileinput-button\">\n            <i class=\"glyphicon glyphicon-plus\"></i>\n            <span>Add files...</span>\n        </span>\n        <button type=\"submit\" class=\"btn btn-primary start\">\n            <i class=\"glyphicon glyphicon-upload\"></i>\n            <span>Start upload</span>\n        </button>\n        <button type=\"reset\" class=\"btn btn-warning cancel\">\n            <i class=\"glyphicon glyphicon-ban-circle\"></i>\n            <span>Cancel upload</span>\n        </button>\n      </div>\n\n      <div class=\"col-lg-5\">\n        <!-- 总体的进度 -->\n        <span class=\"fileupload-process\">\n          <div id=\"total-progress\" class=\"progress progress-striped active\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\">\n            <div class=\"progress-bar progress-bar-success\" style=\"width:0%;\" data-dz-uploadprogress></div>\n          </div>\n        </span>\n      </div>\n\n    </div>\n\n    <!--\n    data-dz-thumbnail：使用后代表该标签是存放缩略图的标签【这里必须是一个 <img /> 元素 ，并且alt 和 src 属性将被 Dropzone改变】\n    data-dz-name：存放文件名\n    data-dz-errormessage：存放错误信息\n    data-dz-size：存放文件大小\n    data-dz-remove ：删除队列中的文件，或者取消正在从队列上传到服务器的文件\n    data-dz-uploadprogress：上传进度【( 当这里有一个 uploadprogress事件时， Dropzone 将更改 style.width 属性从 0% 到 100% )】\n    -->\n    \n    <div class=\"table table-striped files\" id=\"previews\">\n\n      <div id=\"template\" class=\"file-row\">\n        <div>\n            <span class=\"preview\"><img data-dz-thumbnail /></span>\n        </div>\n        <div>\n            <p class=\"name\" data-dz-name ></p>\n            <strong class=\"error text-danger\" data-dz-errormessage></strong>\n        </div>\n        <div>\n            <p class=\"size\" data-dz-size></p>\n            <div class=\"progress progress-striped active\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\">\n                <div class=\"progress-bar progress-bar-success\" style=\"width:0%;\" data-dz-uploadprogress></div>\n            </div>\n        </div>\n        <div>\n          <button class=\"btn btn-primary start\">\n              <i class=\"glyphicon glyphicon-upload\"></i>\n              <span>Start</span>\n          </button>\n          <button data-dz-remove class=\"btn btn-warning cancel\">\n              <i class=\"glyphicon glyphicon-ban-circle\"></i>\n              <span>Cancel</span>\n          </button>\n          <button data-dz-remove class=\"btn btn-danger delete\">\n            <i class=\"glyphicon glyphicon-trash\"></i>\n            <span>Delete</span>\n          </button>\n        </div>\n      </div>\n\n    </div>\n\n<script>\n\n      // Get the template HTML and remove it from the doument\n      var previewNode = document.querySelector(\"#template\");\n      previewNode.id = \"\";\n      var previewTemplate = previewNode.parentNode.innerHTML;\n      //开始先删除单个文件的布局\n      previewNode.parentNode.removeChild(previewNode);\n\n      var myDropzone = new Dropzone(document.body, { // 指定拖拽区为body\n        url: \"{{ url_for('upload_file') }}\", // Set the url\n        thumbnailWidth: 80,\n        thumbnailHeight: 80,\n        parallelUploads: 20,\n        previewTemplate: previewTemplate,\n        autoQueue: false, // 当队列有文件，是否立刻自动上传到服务器\n        previewsContainer: \"#previews\", // 指定存放文件队列区\n        clickable: \".fileinput-button\" // 点击某个按钮或区域后出现选择电脑中本地图片，默认是previewsContainer指定的区域\n      });\n\n      myDropzone.on(\"addedfile\", function(file) {\n        // 让模版中的单个文件可以点击上传\n        file.previewElement.querySelector(\".start\").onclick = function() { myDropzone.enqueueFile(file); };\n      });\n\n      // 显示所有文件整体上传进度1-100\n      myDropzone.on(\"totaluploadprogress\", function(progress) {\n        document.querySelector(\"#total-progress .progress-bar\").style.width = progress + \"%\";\n      });\n      \n      myDropzone.on(\"sending\", function(file) {\n        // 显示整体的上传的进度条，说明：原来是0，所以上面的style.width = progress + \"%\"即使是100%也看不到\n        document.querySelector(\"#total-progress\").style.opacity = \"1\";\n        // 失效上传按钮\n        file.previewElement.querySelector(\".start\").setAttribute(\"disabled\", \"disabled\");\n      });\n\n      // 当没有文件上传时，隐藏进度条\n      myDropzone.on(\"queuecomplete\", function(progress) {\n        document.querySelector(\"#total-progress\").style.opacity = \"0\";\n      });\n\n      // 上传所有\n      document.querySelector(\"#actions .start\").onclick = function() {\n         myDropzone.enqueueFiles(myDropzone.getAcceptedFiles());\n        //myDropzone.enqueueFiles(myDropzone.getFilesWithStatus(Dropzone.ADDED));与上面一样，可查看源码对比\n      };\n      //取消所有  \n      document.querySelector(\"#actions .cancel\").onclick = function() {\n        myDropzone.removeAllFiles(true);\n      };\n\n</script>\n\n</body>\n</html>\n\n效果\n\n第二种效果与默认的一样\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <title>Flask upload with Dropzone example</title>\n    <link rel=\"stylesheet\" href=\"{{ url_for('static', filename='dropzone.css') }}\" type=\"text/css\" />\n    <script src=\"{{ url_for('static', filename='jquery.js') }}\"></script>\n    <script src=\"{{ url_for('static', filename='dropzone.js') }}\"></script>\n</head>\n\n<body>\n\n<div id=\"myId\" class=\"dropzone\" style=\"width: 500px; height: 300px;\"></div>\n\n\n<div id=\"aaa\"></div>\n<div id=\"preview-template\" style=\"display: none;\">\n    <div class=\"dz-preview  dz-file-preview \">\n        <div class=\"dz-image\"><img data-dz-thumbnail /></div>\n        <div class=\"dz-details\">\n            <div class=\"dz-filename\"><span data-dz-name></span></div>\n            <div class=\"dz-size\" data-dz-size></div>\n        </div>\n        <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>\n        <div class=\"dz-success-mark\"><span>✔</span></div>\n        <div class=\"dz-error-mark\"><span>✘</span></div>\n        <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n    </div>\n</div>\n\n     <script type=\"text/javascript\">\n     \n        Dropzone.autoDiscover = false;//解决两次实例Dropzone错误，可在控制台看到该错误\n        $(\"#myId\").dropzone({ \n        url: \"{{ url_for('upload_file') }}\",\n        addRemoveLinks: true,        \n        method: 'post',\n        filesizeBase: 1024,\n        previewTemplate: $('#preview-template').html(),//如果去掉该选项就会使用默认的\n        autoQueue: true,\n        init: function() {\n                this.on(\"addedfile\", function(file) {\n                    $(\".start\").click (function() { \n                    this.enqueueFile(file);        \n                    })       \n                });\n            }\n        });  \n    \n     </script>\n     \n</body>\n</html>\n\ndemo文件\n如果是flask框架可进行测试 点击此处下载，如果是php或者其他就看看不必下载\n参考资料\n\nDropzone.js中文文档\nDropzoneJS 使用指南（文件拖拽上传）\n\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "5"}