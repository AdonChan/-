{"title": "开源评论系统 Isso 全攻略 - zhangnew ", "index": "hexo,python,javascript,github", "content": "博客评论系统现状：\n\n多说已经倒闭了，将于 2017.6.31 结束服务\nDisqus 国内非常不稳定，虽然用了一段时间，但是发现最近好像有广告了，有很多乱七八糟的请求。\n畅言估计和多说差不了多少，没看到赢利点。\n网易云跟帖，不能设置昵称，不能匿名评论，加了官方群，都是提问的，管理员不作为。\n然后就找到了这个开源的评论系统：Isso\n\n2017.5.1 update：新增微信审核评论的方法，见：微信审核开源评论系统 Isso 的评论\n官网 https://posativ.org/isso/ Github https://github.com/posativ/isso/\n安装\n节选并翻译自官方文档：https://posativ.org/isso/docs/install/\n使用 pip 安装\n要求：\n\nPython 2.6, 2.7 or 3.3+ (+ devel headers)\nSQLite 3.3.8 +\nC 编译器\n\n先安装 python 和依赖\nDebian/Ubuntu 系统:\n~> sudo apt-get install python-dev sqlite3 build-essential\n对于 Fedora/Centos 系统 :\n~> sudo yum install python-devel sqlite\n~> sudo yum groupinstall \"Development Tools\"\n注：这个 Development Tools 我没有安装成功，但是没影响\n安装 Isso\n~> pip install isso\nor\n~> easy_install isso  \n注：我是用 Python 2 安装的，在 Python 3 上面报 sqlite3 的错误，没法用。\n使用操作系统的包管理器安装\n\nDebian: https://packages.crapouillou.... – built from PyPi. Includes startup scripts and vhost configurations for Lighttpd, Apache and Nginx [source]. #729218 is an ITP for Debian.\nGentoo: http://eroen.eu/cgit/cgit.cgi... – not yet available in Portage, but you can use the ebuild to build Isso.\nArch Linux: https://aur.archlinux.org/pac... – install with yaourt isso.\nFedora: https://copr.fedoraproject.or... — copr repository. Built from Pypi, includes a systemctl unit script.\nDocker Image: https://registry.hub.docker.c...\n\n\n注：上述方法我没有实验\n从源码安装\n要求：\n\nPython 2.6, 2.7 or 3.3+ (+ devel headers)\nVirtualenv\nSQLite 3.3.8 or later\na working C compiler\nNode.js, NPM and Bower（安装 nodejs 后 可以使用 npm 安装 Bower）\n\n克隆仓库：\n~> git clone https://github.com/posativ/isso.git\n~> cd isso/\n注：截止2017.3.30，最新版为 0.10.7-dev ，经测试没法用，各种404。后来从 github Release 下载的 0.10.5 和 0.10.6 均正常。\n创建一个虚拟环境（推荐，我没用，我用的 pyenv）:\n~> virtualenv .\n~> source ./bin/activate\n安装  Isso 及其依赖:\n~> python setup.py develop  # or `install`\n~> isso run\n安装 JavaScript 模块:\n~> make init\n优化前的 js:\n<script src=\"/js/config.js\"></script>\n<script data-main=\"/js/embed\" src=\"/js/components/requirejs/require.js\"></script>\n压缩 js:\n~> npm install -g requirejs uglify-js jade\n~> make js\n配置\n服务端配置\n详情见文档 https://posativ.org/isso/docs/configuration/server/\n自己编写一个配置文件 : isso.conf\n[general]\n; 数据库位置，注意检查权限，如果没有会自动创建。\ndbpath = /var/lib/isso/comments.db\n; 博客的地址，可以添加多个，比如 http 和 https\nhost =\n    http://localhost:4000/\n    http://zhangnew.com/\n    https://zhangnew.com/\n; 评论通知，使用 smtp\nnotify = smtp\n\n[server]\n; 监听的地址和端口 ： 0.0.0.0 代表任何人可以访问\nlisten = http://0.0.0.0:8001/\n\n[smtp]\nusername = \npassword = \nhost = smtp.mxhichina.com\nport = 25\nsecurity = none\nto =\nfrom = \ntimeout = \n\n[guard]\nenabled = true\nratelimit = 2\n; 评论数量限制\ndirect-reply = 30\n; 是否允许回复自己\nreply-to-self = true\n; 是否必须填写作者\nrequire-author = false\n; 是否必须填写邮箱\nrequire-email = false\n客户端配置\n详情见文档 https://posativ.org/isso/docs/configuration/client/\n<script data-isso=\"/prefix/\"\n        data-isso-css=\"true\"\n        data-isso-lang=\"ru\"\n        data-isso-reply-to-self=\"false\"\n        data-isso-require-author=\"false\"\n        data-isso-require-email=\"false\"\n        data-isso-max-comments-top=\"10\"\n        data-isso-max-comments-nested=\"5\"\n        data-isso-reveal-on-click=\"5\"\n        data-isso-avatar=\"true\"\n        data-isso-avatar-bg=\"#f0f0f0\"\n        data-isso-avatar-fg=\"#9abf88 #5698c4 #e279a3 #9163b6 ...\"\n        data-isso-vote=\"true\"\n        data-vote-levels=\"\"\n        src=\"https://zhangnew.com/js/embed.js\"></script>\n使用\n导入 Disqus 或 Wordpress 的评论，这一点很好。可怜了多说用户。\nisso -c /path/to/isso.conf import disqus-or-wordpress.xml\n运行命令：\nisso -c /path/to/isso.conf run\n部署\n文档： https://posativ.org/isso/docs/extras/deployment/\ngevent\npip install gevent\nisso -c my.cfg run\nuWSGI\n安装 ：\n~> apt-get install build-essential python-dev\n~> pip install uwsgi\n配置文件：\n[uwsgi]\nhttp = :8080\nmaster = true\n; set to `nproc`\nprocesses = 4\ncache2 = name=hash,items=1024,blocksize=32\n; you may change this\nspooler = /tmp/isso/mail\nmodule = isso.run\n; uncomment if you use a virtual environment\n; virtualenv = /path/to/isso\nenv = ISSO_SETTINGS=/path/to/isso.cfg\n运行：\n~> mkdir /tmp/isso/mail\n~> uwsgi /path/to/uwsgi.ini\n注：该方法运行失败，有一个 status code 报错。\ngunicorn\n我现在用的是这种方式，支持 https\n$ pip install gunicorn\n运行：\n$ export ISSO_SETTINGS=\"/path/to/isso.cfg\"\n$ gunicorn -b 0.0.0.0:8001 -w 4 --certfile=certificate.crt --keyfile=private.key --preload isso.run\n其他部署方式\n见文档：\n\nmod_wsgi\nmod_fastcgi\nOpenshift\n\n优缺点\n优点\n自己对评论系统有完全的控制权。\n缺点\n\n不支持回复评论时通知评论作者， Isso 的作者在考虑要不要 merge 这个 pull request（我根据这个 pr 实现了该功能）。\navatar 头像不能关联 gravatar.com 的头像（自己实现了）。\n评论不好管理，常规方法可以通过邮件提醒里面的链接来删除评论。非常规方法就要修改数据库了，sqlite 进入命令行:\n\nATTACH 'comments.db' as isso;\nSELECT id,author,text from isso.comments;\nDELETE FROM isso.comments WHERE id=87;\n\n转载自我的博客 https://zhangnew.com\n\n                ", "mainLikeNum": ["2 "], "mainBookmarkNum": "0"}