{"title": "py脚本走ss代理科学上网 - quietin的代码碎碎念 ", "index": "python", "content": "描述\n目的: 实现脚本运行过程中的科学上网\n目前速度相当快且开源又方便便宜的代理方案就是shadowsocks了, 它属于socks5代理\nsocks5代理属于会话层的代理协议, 理论上只要是TCP/IP协议簇的协议都是可以代理, 因此自然可以代理http\n这里很非常有必要提一下http代理, http协议本身是可以实现http代理的功能, 弄个服务器, 实现http的CONNECT方法就能将其当代理使用了. 所以呢, 用socks5这个本质上是用下层协议(会话层)实现了http协议(应用层)的代理, 注意区分\n步骤\n前提: 提供ss服务的服务器, 自己搭或者买别人的都可以, 并确保服务端能正常工作\n首先去github上下一份ss的代码, 配好服务端的地址端口什么的, 然后以本地模式运行, 也就是本地监听转发, 默认端口1080\nsudo sslocal shadowsocks-master/debian/config.json\n接着就是让http通过ss连接到一些方校长不让你连的网站最早试了一下requests, 它有提供proxy\nimport requests\n\nproxies = {\"http\": \"127.0.0.1:1080\", \"https\": \"127.0.0.1:1080\"}\nm = requests.get('https://youtube.com', proxies=proxies)\nprint m\n可惜不work, 查看端口发现连接建立了, 但是一直像没响应那样卡着, 好像因为urllib3的问题不支持socks5, 有个支持socks5的分支requesocks\nimport requesocks as requests\n\nproxies = {\"http\": \"socks5://127.0.0.1:1080\", \"https\": \"socks5://127.0.0.1:1080\"}\nsession = requests.session()\nsession.proxies = proxies\nm = session.get('https://twitter.com')\nprint m.content\n用这个请求谷歌的时候会卡在握手阶段, 并且代码也很久没维护了, 不推荐\n或使用支持socks代理的PySocks就ok, 请求谷歌也ok\nimport urllib2\nimport socks\nfrom sockshandler import SocksiPyHandler\n\nopener = urllib2.build_opener(SocksiPyHandler(socks.SOCKS5, \"127.0.0.1\", 1080))\nx = opener.open(\"http://www.youtube.com/\")\nprint x.read()\n作用\n比如你有一个博客用了Google analytics或Disqus或者类似的, 需要连到外面. 如果你把这改成异步的, 让后端去发, 这样别人访问你博客的时候就不会那么慢了. 但是相关的数据还是得发到这些网站, 或者从它们那儿取数据, 这时我们就可以走ss代理实现自己想要的功能了, 撒花~\n\n                ", "mainLikeNum": ["3 "], "mainBookmarkNum": "6"}