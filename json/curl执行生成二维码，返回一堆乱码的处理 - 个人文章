{"title": "curl执行生成二维码，返回一堆乱码的处理 - 个人文章 ", "index": "php,python,java", "content": "前言\n最近在开发个微信小程序用到生成二维码的接口，curl执行生成二维码后，返回了一堆乱码，很是无奈，查遍资料最终得以解决。由于网上的资料过于散乱，不易查看，容易误导人等等原因，使我萌生了写下这篇文章的动机。文章主要分两部分讲解，接口和后端。\n接口\ncurl执行的时候加上这么个header：$header=header(\"Content-Type:image/jpg;charset=utf-8\");（注：这里是单个header值的写法。如果是多个header值的话就要改成$header=array(\"Authorization:Basic\",\"Content-Type:application/json\");这种写法。注意单个header值不能用多个header值的写法。）\n加好之后接口就可以正常返回二维码图片了。\n后端\n后端执行curl生成二维码的时候可不是像接口那样加个header就能正常返回二维码的图片了，需要用file_put_contents保存到文件夹，返回路径放到img才能正常展示。\n示例代码：\n              <?php $url=$_W['siteroot'].\"app/index.php?i=\".$_W['uniacid'].\"&t=0&v=1.1.1&from=wxapp&c=entry&a=wxapp&do=CreateTicket&m=hotmallstore\";\n                                    $scene_id=123;\n                                    $_data=array('data'=>json_encode(array(\n                                            'action_name'=>'QR_LIMIT_SCENE',\n                                            'action_info'=>array(\n                                                    'scene'=>array(\n                                                        'scene_id'=>$scene_id\n                                                    )\n                                            )\n                                    )));\n        \n                                    $response = json_decode(ihttp_request($url,$_data)['content'],true);\n\n                                    $ticket=!empty($response['ticket'])?$response['ticket']:\"\";\n                                     $_url=$_W['siteroot'].\"app/index.php?i=\".$_W['uniacid'].\"&t=0&v=1.1.1&from=wxapp&c=entry&a=wxapp&do=Showqrcode&m=hotmallstore&ticket=\".$ticket;\n\n                                     $code = ihttp_get($_url);\n\n                                    $file_path = ATTACHMENT_ROOT.'images/qrcode/';\n                                  \n                                    if(!is_dir($file_path)) {\n                                       $result = mkdir($file_path, 0777, true);\n                                        if($result) {\n                                            $path_arr = explode('/',$path);\n                                            $path_str = '';\n                                            foreach($path_arr as $val){\n                                                $path_str .= $val.'/';\n                                                $a = chmod($path_str,0777);\n                                            }\n                                        }\n                                        $file_path=$result;\n                                    }\n                                    $name=$scene_id.'.png';\n                                    $img_path='images/qrcode/'.$name;\n                                    $filename = $file_path.$name;\n                                    if(!file_exists($filename)){\n                                        file_put_contents($filename, !empty($code['content'])?$code['content']:\"\");\n                                    }\n\n               ?>\n\n           <img height=\"60px\" width=\"60px\" src=\"{media $img_path}\"/>\n相关资料\n微信小程序二维码获取和保存 PHP使用PHP进行微信开发时，生成二维码是乱码\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}