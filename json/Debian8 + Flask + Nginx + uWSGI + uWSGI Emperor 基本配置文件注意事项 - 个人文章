{"title": "Debian8 + Flask + Nginx + uWSGI + uWSGI Emperor 基本配置文件注意事项 - 个人文章 ", "index": "debian,flask,uwsgi,python", "content": "Debian8 + Flask + Nginx + uWSGI + uWSGI Emperor 基本配置文件注意事项\nDebian8 使用 uWSGI Emperor  和 Debina7 是不一样的。相关问题，可以直接查看本篇文章的第4步。\n注意：本篇文章是在服务器中用 root 账号执行的。文章主要讲相关配置文件，安装方法请自寻。-----更新------2017年9月8日更新：更正运行服务的代码\n\n1.uWSGI 配置文件 /home/luejiao.com/luejiao_uwsgi.ini\n\n[uwsgi]\n# 指向网站目录\nbase = /home/luejiao.com\n\n# 启动文件\nwsgi-file = run.py\n\nmodule = app\n\n# 虚拟目录\nhome = %(base)/flask\n\n# 按字面意思是python的环境变量路径，写的是网站根目录\npythonpath = %(base)\n\n#socket文件的路径 socket file's location\nsocket = /home/luejiao.com/tmp/%n.sock\n\n#pchmod-socket的权限 ermissions for the socket file\nchmod-socket = 644\n\n#the variable that holds a flask application inside the module imported at line #6\ncallable = app\n\n#日志文件的路径 location of log files\nlogto = /wwwlogs/uwsgi/%n.log \n\n# 处理器数\nprocesses = 4\n\n# 线程数\n1threads = 2\n\n# 修改代码时，自动重启uwsgi服务\npython-autoreload=1\n2.新建保存日志的文件夹，并赋权\nmkdir -p /wwwlogs/uwsgi\nchown -R www:www /wwwlogs/uwsgi\n3.在网站的 nginx conf 配置文件中，添加：\nlocation / {\n    try_files $uri @yourapplication;\n    }\n  location @yourapplication {\n        include uwsgi_params;\n        uwsgi_pass unix:/home/luejiao.com/tmp/luejiao_uwsgi.sock;# 这里注意替换成自己的socket文件路径\n    }\n下面是重头戏，debian8 和 debian7 在配置 uWSGI Emperor 是不一样的！！！debian7 是把配置文件放到 /etc/init/uwsgi.conf，而在 debian8 中，是放到 /etc/systemd/system/ 中的。本文章是讲 debian8 的环境下配置 uWSGI Emperor 。 官方对应文档\n4.新建/etc/systemd/system/emperor.uwsgi.service文件，代码如下：\n[Unit]\nDescription=uWSGI Emperor\nAfter=syslog.target\n\n[Service]\n#uwsgi 服务的路径，以及需要启动的 ini 文件路径，根据自己的实际情况进行修改\nExecStart=/usr/local/bin/uwsgi --ini /etc/uwsgi/emperor.ini\n# Requires systemd version 211 or newer\nRuntimeDirectory=uwsgi\nRestart=always\nKillSignal=SIGQUIT\nType=notify\nStandardError=syslog\nNotifyAccess=all\n\n[Install]\nWantedBy=multi-user.target\n5.上述代码中，/etc/uwsgi/emperor.ini 文件的代码如下：\n[uwsgi]\nemperor = /etc/uwsgi/vassals\nuid = www\ngid = www\n6.把网站的 uwsgi.ini 文件要给个软链，加到 /etc/uwsgi/vassals/ 文件夹中：\nmkdir /etc/uwsgi && mkdir /etc/uwsgi/vassals\nln -s /home/luejiao.com/luejiao_uwsgi.ini /etc/uwsgi/vassals\n7.在第5步中的文件夹中，设置了文件所有者是 www:www，我们要给对应的文件夹和文件做所有者权限修改（这一步根据实际情况来判断是否需要）：\nchown -R www:www /home/luejiao.com\nchown -R www:www /var/log/uwsgi/\n8.运行服务、停止服务、状态查询：\ndebian7 开启服务的代码是：service uwsgi startdebian8 的代码是\nsystemctl start emperor.uwsgi.service\nsystemctl stop emperor.uwsgi.service\nsystemctl status emperor.uwsgi.service \nEnd！\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "4"}