{"title": "Python 实现刷网页流量工具，并添加代理，报错处理功能 - 个人文章 ", "index": "后端研发,后端开发,scrapy,后端,python", "content": "个人博客：凌霄的博客\n准备\n\n必须环境：\nPython3\n\n开始\n先实现一个简单的版本，直接上代码：\nimport urllib.request\nimport urllib.error\n#创建get方法\ndef get(url):\n    code=urllib.request.urlopen(url).code\n    return code\nif __name__ == '__main__':\n  #设置一些基本属性\n    url = \"http://lx.nextdev.cn\"\n    user_agent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.63 Safari/537.36\"\n    headers = {'User-Agent':user_agent}\n    req = urllib.request.Request(url, headers=headers)\n    #记录次数\n    i = 1\n    while 1: \n        code = get(url)\n        print('访问:'+str(code))\n        i = i+1\n简单粗暴，刷的只是 pv,ip 没变，容易被搜索引擎发现，下面我们来改进一下\n增加代理功能\n给 get 方法添加以下代码：\nrandom_proxy = random.choice(proxies)\nproxy_support = urllib.request.ProxyHandler({\"http\":random_proxy})\nopener = urllib.request.build_opener(proxy_support)\nurllib.request.install_opener(opener)\n修改一下主方法：\nif __name__ == '__main__':\n    url = \"http://lx.nextdev.cn\"\n    #添加代理列表，可以自行去百度获取\n    proxies = [\"124.88.67.22:80\",\"124.88.67.82:80\",\"124.88.67.81:80\",\"124.88.67.31:80\",\"124.88.67.19:80\",\"58.23.16.240:80\"]\n    user_agent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.63 Safari/537.36\"\n    headers = {'User-Agent':user_agent}\n    req = urllib.request.Request(url, headers=headers)\n    i = 1\n    while 1:\n        #添加参数\n        code = get(url,proxies)\n        print('第'+str(i)+'次代理访问:'+str(code))\n        i = i+1\n这样差不多了，不过有个 bug ，如果页面打不开了或者代理失效了，程序就自动结束了，接下来我们添加异常处理功能\n异常处理\n定义 mail 方法 ，用来发邮件提醒\ndef mail(txt):\n    _user = \"你的账号\"\n    _pwd = \"你的密码\"\n    _to = \"收件账号\"\n    msg = MIMEText(txt, 'plain', 'utf-8')\n    #标题\n    msg[\"Subject\"] = \"代理失效！\"\n    msg[\"From\"] = _user\n    msg[\"To\"] = _to\n\n    try:\n        #这里我用的qq邮箱\n        s = smtplib.SMTP_SSL(\"smtp.qq.com\", 465)\n        s.login(_user, _pwd)\n        s.sendmail(_user, _to, msg.as_string())\n        s.quit()\n        print(\"Success!\")\n\n    except smtplib.SMTPException as e:\n        print(\"Falied,%s\" % e)\n然后我们修改一下主方法：\nif __name__ == '__main__':\n    url = \"http://lx.nextdev.cn\"\n    proxies = [\"124.88.67.22:80\",\"124.88.67.82:80\",\"124.88.67.81:80\",\"124.88.67.31:80\",\"124.88.67.19:80\",\"58.23.16.240:80\"]\n    user_agent = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.63 Safari/537.36\"\n    headers = {'User-Agent':user_agent}\n    req = urllib.request.Request(url, headers=headers)\n    i = 1\n    while 1:\n        try:\n            code = get(url,proxies)\n            print('第'+str(i)+'次代理访问:'+str(code))\n            i = i+1\n        except urllib.error.HTTPError as e:\n            print(e.code)\n              #添加mail方法\n            mail(e.code)\n        except urllib.error.URLError as err:\n            print(err.reason)\n              #添加mail方法\n            mail(err.reason)\n完成！\n结语\n代码只有短短的 50 行，程序还可以改进：例如：代理列表自动获取，添加界面\n欢迎评论\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "3"}