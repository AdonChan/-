{"title": "python检测图片是否存在脚本 - notnull ", "index": "vim,linux,python", "content": "python检测图片是否存在脚本\n使用(此为测试表结构,与公司立场无关)，查询结果写入当前目录的1.txt&2.txt中\n代码写的烂,大神别吐槽,python刚学2天,不容易\n./pycheck404url.py 0 100 1\n0:起始便宜量,100 查询总数 1:查询主表\n./pycheck404url.py 0 100 2\n0:起始便宜量,100 查询总数 2:查询图片表\n#!/usr/bin/env python\n#coding:utf-8\n\nfrom mysql import connector\nimport urllib2\nimport sys\nimport socket\n\nHOST = 'localhost'\nUSER = 'root'\nPASSWORD = ''\nDATABASE = 'pytest'\nImagePrefix = 'http://image.59store.com'\ndef pyconnect(**kwargs):\n    try:\n       connect =  connector.connect(host=kwargs.get('host'), user=kwargs.get('user'), passwd=kwargs.get('password'), db=kwargs.get('database'))\n       return connect\n    except Exception as e:\n        print(e)\n        return False\n\ndef queryData(start=0, limit=100, type=1):\n    connect = pyconnect(host=HOST, user=USER, password= PASSWORD, database= DATABASE)\n    if connect != False:\n       cursor = connect.cursor()\n       if type == 1:\n           sql = 'SELECT rid,default_image FROM prefix_repo limit %s,%s'\n           sql = sql % (start, limit)\n       else:\n           sql = 'SELECT rid,url FROM prefix_repoimage limit %s,%s'\n           sql = sql % (start, limit)\n\n       cursor.execute(sql)\n       data = cursor.fetchall()\n       return data\n    else:\n        return False\n\ndef check200(start, limit, type=1):\n    file = open('%s.txt' % (type),'a')\n    data = queryData(start, limit, type)\n    if data != False:\n        for row in data:\n            try:\n                url = ImagePrefix + row[1]\n                print url\n                response = urllib2.urlopen(url, timeout=3)\n                httpCode = response.getcode()\n                if httpCode != 200:\n                    file.write('%s\\t%s \\n' % (row[0], url))\n\n                else:\n                    print(row[0],'ok')\n\n            except urllib2.HTTPError as e:\n                file.write('%s\\t%s \\n' % (row[0], url))\n            except socket.timeout as e:\n                file.write('%s\\t%s \\n' % (row[0], url))\n    file.close()\n\nif __name__ == \"__main__\":\n    args = sys.argv\n    print args\n    check200(args[1],args[2],int(args[3]))\n\n\n\n\n数据库结构\n1.商品主表\nCREATE TABLE `prefix_repo` (\n`rid` int(10) unsigned NOT NULL AUTO_INCREMENT,\n`status` tinyint(3) NOT NULL DEFAULT '0',\n`default_image` varchar(100) NOT NULL DEFAULT '',\nPRIMARY KEY (`rid`),\nKEY `rid` (`rid`,`status`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;  \n\n2.图片表\nCREATE TABLE `prefix_repoimage` (\n  `item_id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `rid` int(10) unsigned NOT NULL,\n  `url` varchar(120) NOT NULL DEFAULT '',\n  PRIMARY KEY (`item_id`),\n  KEY `rid` (`rid`)\n) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT;\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "2"}