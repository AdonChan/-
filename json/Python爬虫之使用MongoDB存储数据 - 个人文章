{"title": "Python爬虫之使用MongoDB存储数据 - 个人文章 ", "index": "mongodb,python", "content": "1.MongoDB的安装\nMongoDB是一种非关系型数据库\nMongoDB官网\n\n选择你的系统对应的版本下载安装即可\n2.MongoDB配置\na.在C盘或者D盘建一个文件夹如图mongodb\n\nb.安装成功后里面会有bin文件然后再文件夹里面新建一个data文件夹，data文件里面新建db文件夹db文件夹用于存储MongoDB数据\nc.在bin文件路径下打开命令行工具执行下面的命令\nmongod --dbpath C:\\mongdb\\data\\db\n注意：文件夹路径以自己所建的为准\nd.此时在打开一个命令行在bin路径下执行下面的代码\nmongo\n\n3.安装第三方库pymongo(连接MongoDB)\npip3 install pymongo\n4.安装Mongodb可视化管理工具Robomongo\nRobomongo官网\n安装成功之后启动Robomongo，在空白处点击，然后选择Add命令，单击Save,最后点击Connect按钮连接到MongoDB数据库\n5.案例代码\n引入相应的模块\nimport requests\nfrom lxml import etree\nimport re\nimport pymongo\nimport time\n连接mongodb数据库\nclient = pymongo.MongoClient('localhost', 27017)\nmydb = client['mydb']\nmusictop = mydb['musictop']\n案例完整代码\nimport requests\nfrom lxml import etree\nimport re\nimport pymongo\nimport time\n\nclient = pymongo.MongoClient('localhost', 27017)\nmydb = client['mydb']\nmusictop = mydb['musictop']\n\nheaders = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36'\n}\n\ndef get_url_music(url):\n    html = requests.get(url, headers=headers)\n    selector = etree.HTML(html.text)\n    music_hrefs = selector.xpath('//a[@class=\"nbg\"]/@href')\n    for music_href in music_hrefs:\n        get_music_info(music_href)\n\ndef get_music_info(url):\n    html = requests.get(url, headers=headers)\n    selector = etree.HTML(html.text)\n    name = selector.xpath('//*[@id=\"wrapper\"]/h1/span/text()')[0]\n    author = re.findall('表演者:.*?>(.*?)</a>', html.text,re.S)[0]\n    styles = re.findall('<span class=\"pl\">流派:</span>&nbsp;(.*?)<br/>',html.text,re.S)\n    if len(styles) == 0:\n        style = '未知'\n    else:\n        style = styles[0].strip()\n    time = re.findall('发行时间:</span>&nbsp;(.*?)<br/>', html.text, re.S)[0].strip()\n    publishers = re.findall('出版者:.*?>(.*?)</a>', html.text, re.S)\n\n    if len(publishers) == 0:\n        publishers = '未知'\n    else:\n        publishers = publishers[0].strip()\n    score = selector.xpath('//*[@id=\"interest_sectl\"]/div/div[2]/strong/text()')[0]\n    print(name, author, style, time, publishers, score)\n    info = {\n        'name': name,\n        'author': author,\n        'style': style,\n        'time': time,\n        'publisher': publishers,\n        'score': score\n    }\n\n    musictop.insert_one(info)\n\nif __name__ == '__main__':\n    urls = ['https://music.douban.com/top250?start={}'.format(str(i)) for i in range(0, 250, 25)]\n    for url in urls:\n        get_url_music(url)\n        time.sleep(2)\n6.执行爬虫代码，然后到Robomongo刷新就会看到数据已经有啦\n\n7.本文只是入门级别，我分享出来希望和大家一起学习进步！ 我还写了Vue插件开发和抢红包的小游戏(欢迎Star)\nVue插件开发\n抢红包小游戏\nPython爬虫入门\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}