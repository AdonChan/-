{"title": "一次简陋的爬虫 - 个人文章 ", "index": "beautifulsoup,requests,python", "content": "最近因为支付宝送了我个红包，可以买基金，又看了一些基金的文章，想买点基金玩玩，在知乎上看到这样一篇文章:\n其实如果是长期定投，用简单的方法筛选即可：\n晨星近5年、近3年评级为五星；天天的业绩排名近3年、2年、1年、6个月的业绩都为优秀；基金经理人在近3年无更换。\n然后我就想及时知道我买的基金的经理人有没有换，并发邮件来用通知我。所以有了下面这段程序\nimport requests \nfrom bs4 import BeautifulSoup\n\nurl = 'http://fund.eastmoney.com/000311.html?spm=search'\nrequest = requests.get(url)\nrequest.encoding = 'utf-8' #有时会乱码\nresult = request.text\nhtml = BeautifulSoup(result,\"lxml\") #解析\ntitel = html.select_one(\"#body div.fundDetail-main > div.fundInfoItem > div.infoOfFund td:nth-of-type(3) a\")  #select返回的是一个列表\nname = titel.get_text().strip()\nprint(name)\n\nif name != \"黎海威\":\n    import smtplib\n    from email.mime.text import MIMEText\n    from email.header import Header\n    # 三个参数：第一个为文本内容，第二个 plain 设置文本格式，第三个 utf-8 设置编码\n    msg = MIMEText('景顺长城沪深300增强(000311)：基金经理有变动，已不是黎海威！请查收。', 'plain', 'utf-8')\n    # 输入Email地址和口令:\n    from_addr = 'XXX@163.com'\n    password = 'XXX'\n    # 输入SMTP服务器地址:\n    smtp_server = 'smtp.163.com'\n    # 输入收件人地址:\n    to_addr = 'XXX@qq.com,XXX@qq.com'\n     \n    msg['From'] = from_addr\n    msg['To'] = to_addr\n    msg['Subject'] = '基金经理变更'\n    \n    server = smtplib.SMTP(smtp_server, 25) # SMTP协议默认端口是25\n    server.set_debuglevel(1)\n    server.login(from_addr, password)\n    server.sendmail(from_addr, to_addr.split(','), msg.as_string())  ##发给多个人\n    server.quit()\n第二版：爬取多个基金\n#====================================第二版=========================================  \nimport requests \nfrom bs4 import BeautifulSoup\n#邮件\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.header import Header\n  \nnames_pc=[] #爬虫下来的名字\nfundnames = ['景顺长城沪深300增强(000311)','兴全沪深300指数(LOF)(163407)']\nnames_pass = ['黎海威', '申庆']\nstock_code = ['000311','163407']\n\nurls =[]\nfor i in stock_code:\n    url = 'http://fund.eastmoney.com/'+str(i)+'.html?spm=search'\n    urls.append(url)\n\n\nfor url in urls:\n    request = requests.get(url)\n    request.encoding = 'utf-8' #有时会乱码\n    result = request.text\n    html = BeautifulSoup(result,\"lxml\") #解析\n    titel = html.select_one(\"#body div.fundDetail-main > div.fundInfoItem > div.infoOfFund td:nth-of-type(3) a\")  #select返回的是一个列表,用select的话用[0]可以\n    name = titel.get_text().strip()\n    print(name)\n    names_pc.append(name)\n    \nprint(names_pc)   \n\nfrom_addr = 'XXXX@163.com'\npassword = 'XXXX'\nsmtp_server = 'smtp.163.com'  # 输入SMTP服务器地址:\nto_addr = 'XXX@qq.com,XXX@qq.com' # 输入收件人地址:\n\nfor name_pc,name_pass,fundname in zip(names_pc,names_pass,fundnames):\n    if name_pc != name_pass:\n        text = '{}：基金经理有变动，已不是{}！请查收'.format(fundname,name_pass)\n        msg = MIMEText(text, 'plain', 'utf-8')\n        msg['From'] = from_addr\n        msg['To'] = to_addr\n        msg['Subject'] = '基金经理变更'  ##主题\n        server = smtplib.SMTP(smtp_server, 25) # SMTP协议默认端口是25\n        server.set_debuglevel(1)\n        server.login(from_addr, password)\n        server.sendmail(from_addr, to_addr.split(','), msg.as_string())  ##发给多个人\n        server.quit()\n\n定时任务\n既然已经写好程序了，当然希望它每天能跑，然后我就去阿里云租了台服务器输入crontab -e来执行定时任务，注意上面的程序在阿里云上需要将smtplib.SMTP函数改成smtplib.SMTP_SSL来执行才能跑通\n0  10  *  *  *  /usr/bin/python3 /home/admin/fund/fundchange2email_v1.py > /home/admin/fund/fund.log\n再ctrl+x保存并退出\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "1"}