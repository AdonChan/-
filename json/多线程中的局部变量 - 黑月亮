{"title": "多线程中的局部变量 - 黑月亮 ", "index": "python", "content": "在实现多线程业务时，如果没有涉及到共享数据处理的业务，还是使用局部变量，必将，在处理共享数据时，还是需要加锁；线程与线程间的局部变量相互独立，变量的处理互补干扰。\n在多线程的场景下，针对线程中的局部变量，如果需要让其他业务操作此变量时，此时\n\n局部变量相对当前线程来讲，是全局变量；\n局部变量相对其他线程来讲，是局部变量；\n\n为了实现当前线程的局部变量被部分业务处理时，以两个小例子说明下\n示例 1：自定义全局变量，以当前线程做为 key\n# -*- coding: utf-8 -*-\nfrom __future__ import absolute_import, unicode_literals\n\nfrom threading import current_thread, Thread\n\nglobal_variable = {}\n\n\ndef handler():\n    std = global_variable[current_thread()]\n    print 'Hello {} and this thread\\'s name is {}'.format(std, current_thread().name)\n\n\ndef test_thread(name):\n    global_variable[current_thread()] = name\n    handler()\n\n\nt1 = Thread(target=test_thread, args=('Kobe', ), name='thread_kobe')\nt2 = Thread(target=test_thread, args=('TMC', ), name='thread_tmc')\n\nt1.start()\nt2.start()\n\nt1.join()\nt2.join()\n\nprint global_variable\nprint 'end......'\n\n运行结果：\nHello Kobe and this thread's name is thread_kobe\n Hello TMC and this thread's name is thread_tmc\n{<Thread(thread_kobe, stopped 123145306509312)>: u'Kobe', <Thread(thread_tmc, stopped 123145310715904)>: u'TMC'}\nend......\n这样，当前线程的数据不会被其他线程捕捉和处理，但是不建议这么做，毕竟 threading 模块提供了 local\n示例 2：使用 local\n# -*- coding: utf-8 -*-\nfrom __future__ import absolute_import, unicode_literals\n\nfrom threading import current_thread, Thread, local\n\nlocal_variable = local()\n\n\ndef handler():\n    std = local_variable.name\n    print 'Hello {} and this thread\\'s name is {}'.format(std, current_thread().name)\n\n\ndef test_thread(name):\n    local_variable.name = name\n    handler()\n\n\nt1 = Thread(target=test_thread, args=('Kobe', ), name='thread_kobe')\nt2 = Thread(target=test_thread, args=('TMC', ), name='thread_tmc')\n\nt1.start()\nt2.start()\n\nt1.join()\nt2.join()\n\nprint local_variable\nprint 'end......'\n\n运行结果如下：\nHello Kobe and this thread's name is thread_kobe\nHello TMC and this thread's name is thread_tmc\n<thread._local object at 0x10f3d36b0>\nend......\n参考\nhttp://yangcongchufang.com/%E...\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}