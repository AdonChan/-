{"title": "在 django 项目之外使用 django 项目的配置 settings 信息 - Hardy 试验田 ", "index": "django,python", "content": "简介\n最近在工作中使用 Django 和 django-rest-framework 来实现 API 开发功能，其中使用到 kafka 作为broker。\n实现功能如下：\n\nPOST 方法将数据发送到服务器，通过kafka写入指定的 topic；\n后台单独启动进程产生 消费者 将 broker 的数据写入到 MySQL\n\n此处的进程使用一个单独的 python 文件实现，此时需要配置中使用 django orm 的配置信息，包括一些其他的配置信息。\n方法一\n其实这些信息也可以使用包含上下文信息的工具：\npython manage.py shell\n\n此处特别推荐神器 ipython 安装如下：\npip install ipython \n如果在这个交互环境中，可以享用一切 django 的配置，我一般常用于测试 django 的 model。\n凡是都有个但是，但是我们还有 方法二。(都看到这里了，就忍忍看完)\n方法二\n方法一 中很方便，但是使用起来只能在指定的交互环境中使用，不够灵活。\n【我想要实现的是】：我在任意位置的代码、脚本中都可以很爽的使用 django 的配置\n代码如下：\nimport os,threading\nimport sys\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nsys.path.extend([BASE_DIR,])\nos.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"jrjidfa.settings\")\n\nimport django\n\ndjango.setup()\nfrom idfacollect.kafka_utils import Utils as kfk\nfrom idfacollect.kafka_utils import Config as cfg\n\n\nclass Consumer(threading.Thread):\n    def run(self):\n        kfk.consume_to_mysql(host=cfg.KFK_HOST,\n                             port=cfg.KFK_PORT,\n                             topic=cfg.KFK_TOPIC_IDFA_DEVICE_STARTUP,\n                             group_id=cfg.KFK_GP_TO_MYSQL)\n\n        kfk.consume_to_mysql(host=cfg.KFK_HOST,\n                             port=cfg.KFK_PORT,\n                             topic=cfg.KFK_TOPIC_IDFA_APP_CLICK,\n                             group_id=cfg.KFK_GP_TO_MYSQL)\n\n\nif __name__ == '__main__':\n    try:\n        for i in range(5): # create 5 thread  exectue Consumer\n            t = Consumer()\n            t.start()\n    except Exception as e:\n        print e\n说明一下：\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\n# 这个是想要使用的 `django` 工程的根目录；\n\n\nsys.path.extend([BASE_DIR,])\n# 将项目根目录加入到 python 搜索的 path 中\n\n\nos.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"jrjidfa.settings\")\n# 设置环境变量中的 DJANGO_SETTINGS_MODULE 设置为 django 配置\n\n\nimport django\ndjango.setup()\n# 启动 django 配置、注册 app 等等初始化操作\n\n总结：接下来就可以愉快的使用了，看上面代码就知道真的很愉快。\n以上です！ありがとうございました\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "1"}