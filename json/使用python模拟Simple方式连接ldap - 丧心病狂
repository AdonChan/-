{"title": "使用python模拟Simple方式连接ldap - 丧心病狂 ", "index": "python,ldap", "content": "#!/usr/bin/python\n# -*- coding: utf-8 -*-\n# filename: ldap_test.py\nimport ldap\n\n'''\n实现LDAP用户登录验证，首先获取用户的dn，然后再验证用户名和密码\n'''\n\n#获得用户的dn\ndef getLdapUserDN(user):\n    l = ldap.initialize(ldapPath)\n    # Set LDAP protocol version used\n    l.protocol_version = ldap.VERSION3\n    l.simple_bind_s(ldapUser,ldapPasswd)\n    # l.simple_bind_s(dn,ldapPasswd) \n\n    searchScope = ldap.SCOPE_SUBTREE\n    searchFiltername = \"sAMAccountName\"\n    retrieveAttributes = None\n    searchFilter = '(' + searchFiltername + \"=\" + user +')'\n    ldap_result_id = l.search(baseDN, searchScope, searchFilter, retrieveAttributes)\n    result_type, result_data = l.result(ldap_result_id,1)\n    if(not len(result_data) == 0):\n        r_a,r_b = result_data[0]\n        print r_b[\"distinguishedName\"]\n        return 1, r_b[\"distinguishedName\"][0]\n    else:\n        return 0, ''\n        \n\nif __name__ == '__main__':\n    ldapPath = \"ldap://x.x.x.x\"\n    baseDN = \"OU=demo,DC=AD,DC=xx,DC=com\"\n    # ldapUser = \"root\"\n    ldapUser = \"CN=admin,OU=demo,DC=AD,DC=xx,DC=com\"\n    ldapPasswd = \"demo\"\n    passwd = \"0\"\n    dn = getLdapUserDN(\"test1\")[1]\n    print dn\n    my_ldap = ldap.initialize(ldapPath)\n    print my_ldap.simple_bind_s(dn,passwd)\n\n\n参考文档：http://www.vpsee.com/2012/11/use-python-...http://www.linuxidc.com/Linux/2015-02/11...\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "0"}