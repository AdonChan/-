{"title": "scrapy简单学习4—西刺Ip的爬取 - 个人编程学习 ", "index": "scrapy,python", "content": "学习网站：麦子scrapy第九集\n1.item.py的定义\nimport scrapy\n\n\nclass XiciItem(scrapy.Item):\n    IP=scrapy.Field()\n    PORT=scrapy.Field()\n    POSITION=scrapy.Field()\n    TYPE=scrapy.Field()\n    SPEED=scrapy.Field()\n    LAST_CHECK_TIME=scrapy.Field()\n2.spider的编写\n# -*- coding: utf-8 -*-\nimport scrapy\nfrom XiCi.items import XiciItem\n\nclass XiciSpider(scrapy.Spider):\n    name = \"xici\"\n    allowed_domains = [\"xicidaili.com\"]\n    start_urls = (\n        'http://www.xicidaili.com',\n    )\n    \n    def start_requests(self):#作用：生成初始的request\n        reqs=[]#定义resqs(空集)\n        \n        for i in range(1,206):#设置变量：页码1到206\n            req=scrapy.Request(\"http://www.xicidaili.com/nn/%s\"%i)\n            reqs.append(req)#生成的request放到resqs中\n        \n        return reqs#返回reqs\n    \n    def parse(self, response):\n        #提取每一行的xpath位置\n        ip_list=response.xpath('//table[@id=\"ip_list\"]')#ip_list=xpath提取（table标签下的\"ip_list\"属性）\n        \n        trs = ip_list[0].xpath('tr')#变量trs=ip_list加入tr标签\n        \n        items=[]#定义items空集\n        \n        for ip in trs[1:]:#ip的tr从[1以后开始]\n            pre_item=XiciItem()#pre_item=加载XiCiItem()\n            \n            pre_item['IP'] = ip.xpath('td[3]/text()')[0].extract()#取文字\n            \n            pre_item['PORT'] = ip.xpath('td[4]/text()')[0].extract()#取文字\n            \n            pre_item['POSITION'] = ip.xpath('string(td[5])')[0].extract().strip()\n            \n            pre_item['TYPE'] = ip.xpath('td[7]/text()')[0].extract()\n            #speed取到td的title属性，再用正则（匹配到数字）\n            pre_item['SPEED'] = ip.xpath(\n                'td[8]/div[@class=\"bar\"]/@title').re('\\d{0,2}\\.\\d{0,}')[0]\n                \n            pre_item['LAST_CHECK_TIME'] = ip.xpath('td[10]/text()')[0].extract()\n            \n            items.append(pre_item)#把pre_item添加到项目\n            \n        return items#返回项目\n3.保存成csv\nscrapy crawl xici -o xici.csv\n4.结果输出\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "4"}