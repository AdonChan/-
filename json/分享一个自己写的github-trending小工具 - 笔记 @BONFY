{"title": "分享一个自己写的github-trending小工具 - 笔记 @BONFY ", "index": "github,python", "content": "缘起\nGithub Trending基本上是我每天都会浏览的网页，上面会及时发布一些GIthub上比较有潜力的项目，或者说每日Star数增量排行榜。\n不过由于Github Trending经常会实时更新，即使你访问得再勤，难免还是会错过一些你感兴趣的项目，为此不少人都想出了自己的解决办法，例如josephyzhou ，他的 github-trending 项目得到了众多人的青睐，我仔细阅读了他的源码 (Go)，发现实现也较为简单, 就用Python 重写了一下，发现代码少了好多,详见 我的 github-trending。\n步骤\n主要是建立一个Job，然后分三步：\n\n创建一个以 日期.md 的文件\n访问Github-Trending 页面 然后抓取关注语言的Trending List 写入 md文件\nGit Add + Commit + Push\n\nJob\ndef job():\n\n    strdate = datetime.datetime.now().strftime('%Y-%m-%d')\n    filename = '{date}.md'.format(date=strdate)\n\n    # create markdown file\n    createMarkdown(strdate, filename)\n\n    # write markdown\n    scrape('python', filename)\n    scrape('swift', filename)\n    scrape('javascript', filename)\n    scrape('go', filename)\n\n    # git add commit push\n    git_add_commit_push(strdate, filename)\ncreate markdown\ndef createMarkdown(date, filename):\n    with open(filename, 'w') as f:\n        f.write(\"###\" + date + \"\\n\")\nwrite markdown\ndef scrape(language, filename):\n\n    HEADERS = {\n        'User-Agent'        : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:11.0) Gecko/20100101 Firefox/11.0',\n        'Accept'            : 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n        'Accept-Encoding'    : 'gzip,deflate,sdch',\n        'Accept-Language'    : 'zh-CN,zh;q=0.8'\n    }\n\n    url = 'https://github.com/trending/{language}'.format(language=language)\n    r = requests.get(url, headers=HEADERS)\n    assert r.status_code == 200\n\n    d = pq(r.content)\n    items = d('ol.repo-list li')\n\n    # codecs to solve the problem utf-8 codec like chinese\n    with codecs.open(filename, \"a\", \"utf-8\") as f:\n        f.write('\\n####{language}\\n'.format(language=language))\n\n        for item in items:\n            i = pq(item)\n            title = i(\"h3 a\").text()\n            owner = i(\"span.prefix\").text()\n            description = i(\"p.col-9\").text()\n            url = i(\"h3 a\").attr(\"href\")\n            url = \"https://github.com\" + url\n            f.write(u\"* [{title}]({url}):{description}\\n\".format(title=title, url=url, description=description))\ngit operations\ndef git_add_commit_push(date, filename):\n    cmd_git_add = 'git add {filename}'.format(filename=filename)\n    cmd_git_commit = 'git commit -m \"{date}\"'.format(date=date)\n    cmd_git_push = 'git push -u origin master'\n\n    os.system(cmd_git_add)\n    os.system(cmd_git_commit)\n    os.system(cmd_git_push)\n部署\n代码写完了，然后就可以部署了，当然你可以放在自己的电脑上跑。但是这是个每天的定时任务，所以不能关机比较尴尬。比较好的办法是部署到VPS,具体主机商就不推荐了，反正就这几家，大家随意。部署之前记得先将VPS 的 SSH key 添加到Github 的信任列表，这样这个代码就可以顺利跑起来啦！\n  $ git clone https://github.com/bonfy/github-trending.git\n  $ cd github-trending\n  $ pip install -r requirements.txt\n  $ python scraper.py\n一般人我不告诉\n还有个好处，偷偷告诉你们，这代码是每天定时跑的，所以每天都会Commit 到Github上，想象一下吧，一年之后你的Github下面的Commit 一栏将是多么的美观啊！所以赶快去Star 我的项目，行动起来吧，少年！\n项目地址： https://github.com/bonfy/github-trending欢迎大家Star\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "0"}