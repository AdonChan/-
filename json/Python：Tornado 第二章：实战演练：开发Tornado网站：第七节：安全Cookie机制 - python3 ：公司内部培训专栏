{"title": "Python：Tornado 第二章：实战演练：开发Tornado网站：第七节：安全Cookie机制 - python3 ：公司内部培训专栏 ", "index": "python", "content": "上一篇文章：Python：Tornado 第二章：实战演练：开发Tornado网站：第六节：异步与协程化下一篇文章：Python：Tornado 第二章：实战演练：开发Tornado网站：第八节：用户身份认证\n\nCookie是很多网站为了辨别用户的身份而存储在用户本地终端(Client Side)d的数据，在Tornado中使用RequestHandler.get_cookie()、RequestHandler.set_cookie()可以方便地对Cookie进行读写。\n实例：Cookie的简单读写\nimport tornado.web\n\nsession_id = 1\nclass MainHandler(tornado.web.RequestHandler):\n    def get(self):\n        global session_id\n        if not self.get_cookie(\"session\"):\n            self.set_cookie(\"session\",str(session_id))\n            session_id+=1\n            self.write(\"设置新的session\")\n        else:\n            self.write(\"已经具有session\")\n\nif __name__ == '__main__':\n    app=tornado.web.Application([\n        (\"/\",MainHandler)\n    ])\n    app.listen(\"8888\")\n    tornado.ioloop.IOLoop.current().start()\n本例中用get_cookie()函数判断Cookie名【session】是否存在，如果不存在则为其赋予新的session_id.\n在实际应用中，Cookie经常像本例这样用于保存session信息。因为Cookie总是被保存在客户端，所以如何保存其不被篡改是服务器端程序必须解决的问题。Tornado为Cookie提供了信息加密机制，使得客户端无法随意解析和修改Cookie的键值。\n实例：安全的Cookie\n代码：\nimport tornado.web\n\nsession_id = 1\nclass MainHandler(tornado.web.RequestHandler):\n    def get(self):\n        global session_id\n        #get_secure_cookie代替get_cookie\n        if not self.get_secure_cookie(\"session\"):\n            #set_secure_cookie代替set_cookie\n            self.set_secure_cookie(\"session\",str(session_id))\n            session_id+=1\n            self.write(\"设置新的session\")\n        else:\n            self.write(\"已经具有session\")\n\nif __name__ == '__main__':\n    app=tornado.web.Application([\n        (\"/\",MainHandler)\n    ],cookie_secret=\"JIA_MI_MI_YAO\")\n    app.listen(\"8888\")\n    tornado.ioloop.IOLoop.current().start()\n对比上面的简单Cookie实例可以发现不同之处：\n\n在tornado.web.Application对象初始化时赋予cookie_secret参数，该参数值时一个字符串，用于保存本网站Cookie加密时的密钥。\n在需要读取cookie的地方使用RequestHandler.get_secure_cookie代替原来的RequestHandler.get_cookie调用。\n在需要写入Cookie的地方用RequestHandler.set_secure_cookie替换原来的RequestHandler.set_cookie调用，\n\n这样，就不需要担心Cookie伪造的问题了，但是cookie_secret参数值作为加密密钥，需要好好保护，不能泄露。\n\n                ", "mainLikeNum": ["1 "], "mainBookmarkNum": "1"}