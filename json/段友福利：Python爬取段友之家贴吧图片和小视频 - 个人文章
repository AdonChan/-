{"title": "段友福利：Python爬取段友之家贴吧图片和小视频 - 个人文章 ", "index": "beautifulsoup,requests,python", "content": "由于最新的视频整顿风波，内涵段子APP被迫关闭，广大段友无家可归，但是最近发现了一个“段友”的app，版本更新也挺快，正在号召广大段友回家，如下图，有兴趣的可以下载看看（ps：我不是打广告的，没收广告费的）\n同时，之前同事也发了一个贴吧的段子聚居地，客官稍等，马上奉上连接：段友之家   https://tieba.baidu.com/f?ie=...\n然后呢，看到上面，确实好多段友在上面，于是乎，我就想爬取他们的图片和小视频，就有了这篇文章的主题：\n其实吧，用Python爬取网站数据是最基础的东西，也不难，但是我还想分享给大家，一起学习和交流。\n爬取这些网站里的数据主要用的模块是bs4、requests以及os，都是常用模块\n大概思路就是通过requests模块请求网页html数据，然后通过bs4模块下的BeautifulSoup分析请求的网页，然后通过css查找器查找内涵段子的图片以及小视频的地址，主要实现代码如下：\ndef download_file(web_url):\n    \"\"\"获取资源的url\"\"\"\n    # 下载网页\n    print('正在下载网页： %s...' % web_url)\n    result = requests.get(web_url)\n    soup = bs4.BeautifulSoup(result.text, \"html.parser\")\n    # 查找图片资源\n    img_list = soup.select('.vpic_wrap img')\n    if img_list == []:\n        print('未发现图片资源！')\n    else:\n        # 找到资源，开始写入\n        for img_info in img_list:\n            file_url = img_info.get('bpic')\n            write_file(file_url, 1)\n    # 查找视频资源\n    video_list = soup.select('.threadlist_video a')\n    if video_list == []:\n        print('未发现视频资源！')\n    else:\n        # 找到资源，开始写入\n        for video_info in video_list:\n            file_url = video_info.get('data-video')\n            write_file(file_url, 2)\n    print('下载资源结束：', web_url)\n    next_link = soup.select('#frs_list_pager .next')\n    if next_link == []:\n        print('下载资料结束！')\n    else:\n        url = next_link[0].get('href')\n        download_file('https:' + url)\n得到图片以及视频的地址之后，肯定还不够，还得把这些资源写入到本地，方式是通过二进制的方式来读取远程文件资源，然后分类写入到本地，实现的主要代码如下：\ndef write_file(file_url, file_type):\n    \"\"\"写入文件\"\"\"\n    res = requests.get(file_url)\n    res.raise_for_status()\n    # 文件类型分文件夹写入\n    if file_type == 1:\n        file_folder = 'nhdz\\\\jpg'\n    elif file_type == 2:\n        file_folder = 'nhdz\\\\mp4'\n    else:\n        file_folder = 'nhdz\\\\other'\n    folder = os.path.exists(file_folder)\n    # 文件夹不存在，则创建文件夹\n    if not folder:\n        os.makedirs(file_folder)\n    # 打开文件资源，并写入\n    file_name = os.path.basename(file_url)\n    str_index = file_name.find('?')\n    if str_index > 0:\n        file_name = file_name[:str_index]\n    file_path = os.path.join(file_folder, file_name)\n    print('正在写入资源文件：', file_path)\n    image_file = open(file_path, 'wb')\n    for chunk in res.iter_content(100000):\n        image_file.write(chunk)\n    image_file.close()\n    print('写入完成！')\n最后，再奉上完整的代码吧。要不然，会被人说的，说话说一半，说福利，也不给全，这就太不够意思了。客官别急，马上奉上……\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\n\"\"\"\n爬取百度贴吧，段友之家的图片和视频\nauthor: cuizy\ntime：2018-05-19\n\"\"\"\n\nimport requests\nimport bs4\nimport os\n\n\ndef write_file(file_url, file_type):\n    \"\"\"写入文件\"\"\"\n    res = requests.get(file_url)\n    res.raise_for_status()\n    # 文件类型分文件夹写入\n    if file_type == 1:\n        file_folder = 'nhdz\\\\jpg'\n    elif file_type == 2:\n        file_folder = 'nhdz\\\\mp4'\n    else:\n        file_folder = 'nhdz\\\\other'\n    folder = os.path.exists(file_folder)\n    # 文件夹不存在，则创建文件夹\n    if not folder:\n        os.makedirs(file_folder)\n    # 打开文件资源，并写入\n    file_name = os.path.basename(file_url)\n    str_index = file_name.find('?')\n    if str_index > 0:\n        file_name = file_name[:str_index]\n    file_path = os.path.join(file_folder, file_name)\n    print('正在写入资源文件：', file_path)\n    image_file = open(file_path, 'wb')\n    for chunk in res.iter_content(100000):\n        image_file.write(chunk)\n    image_file.close()\n    print('写入完成！')\n\n\ndef download_file(web_url):\n    \"\"\"获取资源的url\"\"\"\n    # 下载网页\n    print('正在下载网页： %s...' % web_url)\n    result = requests.get(web_url)\n    soup = bs4.BeautifulSoup(result.text, \"html.parser\")\n    # 查找图片资源\n    img_list = soup.select('.vpic_wrap img')\n    if img_list == []:\n        print('未发现图片资源！')\n    else:\n        # 找到资源，开始写入\n        for img_info in img_list:\n            file_url = img_info.get('bpic')\n            write_file(file_url, 1)\n    # 查找视频资源\n    video_list = soup.select('.threadlist_video a')\n    if video_list == []:\n        print('未发现视频资源！')\n    else:\n        # 找到资源，开始写入\n        for video_info in video_list:\n            file_url = video_info.get('data-video')\n            write_file(file_url, 2)\n    print('下载资源结束：', web_url)\n    next_link = soup.select('#frs_list_pager .next')\n    if next_link == []:\n        print('下载资料结束！')\n    else:\n        url = next_link[0].get('href')\n        download_file('https:' + url)\n\n\n# 主程序入口\nif __name__ == '__main__':\n    web_url = 'https://tieba.baidu.com/f?ie=utf-8&kw=段友之家'\n    download_file(web_url)\n\n\n                ", "mainLikeNum": ["0 "], "mainBookmarkNum": "2"}